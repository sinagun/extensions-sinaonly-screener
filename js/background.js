chrome.runtime.onInstalled.addListener(function(a){api.queue.push({type:"action",action:a.reason}),api.queueProcessorReady&&api.processQueue()});var api={stop:!1,actionUrl:"https://screen-cap.com/api/action/",uninstallUrl:"https://screen-cap.com/uninstall/",config:{},queue:[],queueProcessorReady:!1,uid:"",version:chrome.runtime.getManifest().version,init:function(){api.initStorage().then(()=>{api.queueProcessorReady=!0,api.setUninstallUrl(),api.processQueue(),api.initListeners(),api.setDefaultSettings()})},initStorage:function(){return new Promise(a=>{chrome.storage.local.get(b=>{b&&b.config&&(api.config=b.config),api.config.uid?api.uid=api.config.uid:(api.uid=api.config.uid=api.generateUID(),api.saveConfig()),a()})})},setUninstallUrl:function(){var a="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:api.version,action:"uninstall",uid:api.uid,t:Date.now()})));chrome.runtime.setUninstallURL(api.uninstallUrl+"?"+a)},processQueue(){for(;0<api.queue.length;){var a=api.queue.shift();if(!a.type||"action"!=a.type)return!0;var b="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:api.version,action:a.action,uid:api.uid,t:Date.now()})));fetch(api.actionUrl+"?"+b).then(a=>a.json()).then(function(a){a.url&&chrome.tabs.create({url:a.url})})}},initListeners:function(){api.listenMessages()},handleInstall:function(a){api.queue.push({type:"action",action:a.reason}),api.queueProcessorReady&&api.processQueue()},saveConfig:function(){chrome.storage.local.set({config:api.config})},generateUID(){return"xxxxxxxx-xxxx-2xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})},setDefaultSettings:function(){var a={pngjpg:"png",delay:0,rnd:Math.random(),options:Date.now().toString(),speed:400,shortcut_full:90,shortcut_visible:88,shortcut_region:82,enableshortcuts:"yes",button_size:14,sb_opacity:.7,created:new Date,color:"#FF0000"};for(var b in a)a.hasOwnProperty(b)&&!localStorage.hasOwnProperty(b)&&(localStorage[b]=a[b]);chrome.i18n.getAcceptLanguages(function(){try{localStorage.primaryLanguage=arguments[0][0]}catch(a){localStorage.primaryLanguage=""}})},callPopup:function(a){for(var b=chrome.extension.getViews({type:"popup"}),c=0;c<b.length;c++)b[c].popup.exec(a)},listenMessages:function(){chrome.runtime.onMessage.addListener(function(a){switch(api.stop=!1,a.data){case"captureVisible":screenshot.captureVisible();break;case"captureAll":screenshot.captureAll(a);break;case"stopNow":api.stop=!0;break;default:console.warn("Invalid message",a);}return!0})}};api.init();