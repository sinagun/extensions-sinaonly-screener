var hideTheScrollBars,cropData,$window=$(window);function exchangeElementStyle(a,b,c){Array.isArray(b)||(b=[b]),b.forEach(function(b){a.hasOwnProperty("style_"+b)||(a["style_"+b]=a.style.getPropertyValue(b)||null,a["style_"+b+"_priority"]=a.style.getPropertyPriority(b)||null),a.style.setProperty(b,c,"important")})}function restoreElementStyle(a,b){Array.isArray(b)||(b=[b]),b.forEach(function(b){a.hasOwnProperty("style_"+b)&&(a.style.removeProperty(b),a.style.setProperty(b,a["style_"+b],a["style_"+b+"_priority"]))})}var page={isWidthScroll:!1,isHeightScroll:!1,scrollLeft:0,scrollTop:0,windowWidth:0,windowHeight:0,documentWidth:0,documentHeight:0,currentX:0,cropData:null,currentY:0,scrollBarWidth:0,iframe:null,elm:null,fixedTopElements:[],fixedBottomElements:[],setVars:function(a){a.y2>document.height&&(a.y2=document.height),a.x2>document.width&&(a.x2=document.width),page.isWidthScroll=page.checkWidthScroll(),page.isHeightScroll=page.checkHeightScroll(),page.windowWidth=window.innerWidth,page.documentWidth=document.body.scrollWidth,page.documentHeight=document.body.scrollHeight||document.documentElement.scrollHeight,page.windowHeight=window.innerHeight,page.currentX=0,page.currentY=0,a&&a.y1>$window.scrollTop()&&a.x1>document.body.scrollLeft?(page.currentY=$window.scrollTop(),page.currentX=document.body.scrollLeft):(page.currentX=a.x1,page.currentY=a.y1)},scrollToCurrent:function(){$window.scrollTop(page.currentY),$window.scrollLeft(page.currentX)},saveScrollPos:function(){page.scrollLeft=$window.scrollLeft(),page.scrollTop=$window.scrollTop()},restoreScrollPos:function(){page.currentX=page.scrollLeft,page.currentY=page.scrollTop,page.scrollToCurrent()},computeNextScreen:function(){return!(cropData&&page.currentX+page.windowWidth>cropData.x2&&page.currentY+page.windowHeight>cropData.y2)&&(page.currentX+page.windowWidth<page.documentWidth?(page.currentX+=page.windowWidth,!0):(page.currentX=0,!(page.currentY+page.windowHeight>=page.documentHeight)&&(page.currentY+=page.windowHeight,!0)))},checkWidthScroll:function(){return document.body.clientWidth<document.body.scrollWidth},checkHeightScroll:function(){return document.body.clientHeight<document.body.scrollHeight},enableScrollbar:function(a){a&&hideTheScrollBars?restoreElementStyle(document.body,["overflow-x","overflow-y"]):(exchangeElementStyle(document.body,["overflow-x","overflow-y"],"hidden"),hideTheScrollBars=!0)},fixedElementCheck:function(){"fixed"===document.defaultView.getComputedStyle(document.body)["background-attachment"]&&exchangeElementStyle(document.body,["background-attachment"],"initial");for(var a,b=document.createNodeIterator(document.documentElement,NodeFilter.SHOW_ELEMENT,null,!1),c=$window.height();a=b.nextNode();){var d=document.defaultView.getComputedStyle(a,"");if(!d)return;var e=d.getPropertyValue("position");"fixed"===e&&($(a).position().top<c/2?(0>page.fixedTopElements.indexOf(a)&&page.fixedTopElements.push(a),document.body.scrollHeight<2*c&&exchangeElementStyle(a,["position"],"absolute")):0>page.fixedBottomElements.indexOf(a)&&page.fixedBottomElements.push(a)),"sticky"===e&&(0>page.fixedTopElements.indexOf(a)&&page.fixedTopElements.push(a),document.body.scrollHeight<2*c&&exchangeElementStyle(a,["position"],"absolute"))}},hideFixedElement:function(a){const b="top"===a?page.fixedTopElements:page.fixedBottomElements;b.forEach(function(a){exchangeElementStyle(a,["display"],"none")})},showFixedElement:function(a){const b="top"===a?page.fixedTopElements:page.fixedBottomElements;b.forEach(function(a){restoreElementStyle(a,["display"])})},restore:function(){page.enableScrollbar(!0),page.restoreScrollPos(),setTimeout(()=>{page.fixedTopElements.forEach(function(a){restoreElementStyle(a,["display","position"])}),page.fixedBottomElements.forEach(function(a){restoreElementStyle(a,["display","position"])}),restoreElementStyle(document.body,["background-attachment"]),page.fixedTopElements.length=0,page.fixedBottomElements.length=0},1e3)},onRequest:function(a,b,c){var d=Math.pow;if("checkExist"===a.type)return void c();if(a.start){page.saveScrollPos();var e={x1:0,x2:32768,y1:0,y2:32765,scrollTop:$window.scrollTop(),scrollLeft:document.body.scrollLeft};a.scroll||(e.x1=window.scrollX,e.y1=window.scrollY,e.x2=window.innerWidth+e.x1,e.y2=window.innerHeight+e.y1),cropData=$.extend(e,a.cropData);d(2,15)-100;32668<cropData.y2-cropData.y1&&(cropData.y2=cropData.y1+32668),32668<cropData.x2-cropData.x1&&(cropData.x2=cropData.x1+32668)}if("takeCapture"===a.type){var f={};a.start&&(detect_zoom(),page.setVars(cropData),a.scroll&&!a.showScrollBar&&page.enableScrollbar(!1),a.scroll&&a.processFixedElements&&page.fixedElementCheck()),page.scrollToCurrent(),a.scroll&&a.processFixedElements&&setTimeout(function(){page.fixedElementCheck(),page.hideFixedElement(a.start?"bottom":"top"),f.finish&&(page.showFixedElement("bottom"),$window.scrollTop()<$window.height()&&page.showFixedElement("top"))},50),f.top=parseInt($window.scrollTop()-cropData.y1,10),f.left=parseInt(document.body.scrollLeft-cropData.x1,10),f.finish=!a.scroll||!page.computeNextScreen(),f.finish&&document.location.toString().includes("facebook")&&!0===a.scroll&&null===a.cropData?(f.width=parseInt(cropData.x2-cropData.x1,10),f.height=cropData.y2-cropData.y1-page.windowHeight-70,f.url=document.location.toString(),f.title=document.title):f.finish&&(f.height=parseInt(cropData.y2-cropData.y1,10),f.width=parseInt(cropData.x2-cropData.x1,10),f.url=document.location.toString(),f.title=document.title),f._devicePixelRatio=devicePixelRatio,c(f)}"finish"===a.type&&page.restore(),"captureRegion"===a.data?load_cropper_without_selection():"editContent"===a.data&&(alert("Now you can edit this page"),document.designMode="on")}};chrome.runtime.onMessage.addListener(page.onRequest);