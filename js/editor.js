let canvasToDataURL,screenshot=chrome.extension.getBackgroundPage().screenshot;localStorage.lastTool||(localStorage.lastTool="house");function Editor_obj(){function c(){v&&(v.discardActiveObject(),v.requestRenderAll(),v.set({selection:!1}),v.getObjects().forEach(c=>{c.set("selectable",!1),c.set("hoverCursor","default")}))}function d(){fabric.Canvas.prototype.__historySaveResize=function(c){this.historyProcessing||(this.historyUndo.push(c),this.fire("history:append:size",{size:c}))},fabric.Canvas.prototype._historyEvents=function(){return{"object:added":this._historySaveAction,"object:removed":this._historySaveAction,"object:modified":this._historySaveAction,"object:skewing":this._historySaveAction,"canvas:crop":this.__historySaveResize}},fabric.Canvas.prototype.redo=function(c){this.historyProcessing=!0;const d=this.historyRedo.pop();if(!d)this.historyProcessing=!1;else if(d.size){const{before:c,after:e}=d.size;this.historyUndo.push({size:{before:c,after:e}}),this.fire("history:redo:size",{...e}),this.historyProcessing=!1}else this.historyUndo.push(this._historyNext()),this.historyNextState=d,this._loadHistory(d,"history:redo",c)},fabric.Canvas.prototype.undo=function(c){this.historyProcessing=!0;const d=this.historyUndo.pop();if(!d)this.historyProcessing=!1;else if(d.size){const{before:c,after:e}=d.size;this.historyRedo.push({size:{before:c,after:e}}),this.fire("history:undo:size",{...c}),this.historyProcessing=!1}else this.historyRedo.push(this._historyNext()),this.historyNextState=d,this._loadHistory(d,"history:undo",c)}}function e(){if(!v){d(),$(`<div id="fabricWrapper"><canvas id="fabricCanvas"></canvas></div>`).appendTo($("#clipper")),$("#fabricWrapper").css({position:"absolute",width:C.width(),height:C.height(),top:0,left:0}),v=new fabric.Canvas("fabricCanvas",{isDrawingMode:!1,renderOnAddRemove:!0,selection:!1,cornerColor:"blue",cornerStyle:"circle",transparentCorners:!1}),v.setWidth(C.width()),v.setHeight(C.height()),fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.cornerColor="blue",fabric.Object.prototype.cornerStyle="circle";const c=c=>{F={...c},m(),n()};v.on("history:redo:size",c),v.on("history:undo:size",c),v.on("history:append",n),v.on("history:append:size",n),v.on("history:redo",n),v.on("history:undo",n),v.on("selection:cleared",()=>{E.status="ready"}),v.on("object:modified",()=>{E.status="selected"}),v.on("object:selected",()=>{E.status="selected"}),v.on("object:moving",()=>{E.status="selected"}),v.on("object:scaling",()=>{E.status="selected"}),v.on("object:rotating",()=>{E.status="selected"}),$("body").keydown(function(c){if(46===c.keyCode||8===c.keyCode){const c=v.getActiveObject();c&&!c._objects&&(v.remove(c),v.renderAll()),c._objects.forEach(c=>{v.remove(c)}),v.discardActiveObject(),v.remove(c),v.renderAll()}})}}function f(){F.rx1=0,F.rx2=r.width,F.ry1=0,F.ry2=r.height}function g(c){var d=Math.sin,e=Math.PI,f=Math.cos;const g=c[0],h=c[1],j=c[2],k=c[3],l=Math.atan2(k-h,j-g),m=j-15*f(l),n=k-15*f(l);let o=[{x:g,y:h},{x:g-15/4*f(l-e/2),y:h-15/4*d(l-e/2)},{x:m-15/4*f(l-e/2),y:n-15/4*d(l-e/2)},{x:m-15*f(l-e/2),y:n-15*d(l-e/2)},{x:m+15*f(l),y:n+15*d(l)},{x:m-15*f(l+e/2),y:n-15*d(l+e/2)},{x:m-15/4*f(l+e/2),y:n-15/4*d(l+e/2)},{x:g-15/4*f(l+e/2),y:h-15/4*d(l+e/2)},{x:g,y:h}],p=new fabric.Polyline(o,{fill:D,stroke:D,opacity:1,strokeWidth:q||2,originX:"left",originY:"top",selectable:!1,objectCaching:!1,mtype:"arrow"});return p}function h(c){return ans={x:F.rx1+c.pageX-$("#canvasWrapper").offset().left+$("#canvasWrapper").scrollLeft(),y:F.ry1+c.pageY-$("#canvasWrapper").offset().top+$("#canvasWrapper").scrollTop()},!(0>ans.x||0>ans.y)&&!(c.pageX>$("#canvasWrapper").offset().left+$("#canvasWrapper").width()-x)&&!(c.pageY>$("#canvasWrapper").offset().top+$("#canvasWrapper").height()-y)&&!(c.pageX<$("#canvasWrapper").offset().left)&&!(c.pageY<$("#canvasWrapper").offset().top)&&ans}function j(){"started"===E.status&&(l(E[E.current].up),l(E[E.current].finish))}function k(d){"undo"===d.type&&"redo"===d.type&&"crop"===d.type||(localStorage.lastTool=d),j(),$(".button [tag="+d+"]").trigger("mousedown"),E.current=d,E.status="ready",c()}function l(c){$.isFunction(c)&&c()}function m(){const{rx1:c,rx2:d,ry1:e,ry2:f}=F;canvasWidth=F.rx2-F.rx1,canvasHeight=F.ry2-F.ry1,$("#clipper").css({height:canvasHeight,overflow:"hidden",width:canvasWidth,position:"absolute"}),B&&s.attr("height",canvasHeight),s.css({clip:`clip.rect(${e} ${d} ${f} ${c})`,position:"absolute"}),$("#cborder").add("#clipper img").add("#fabricWrapper").each(function(){$(this).css({"margin-left":-c,"margin-top":-e})}),maxWidth=window.innerWidth,maxHeight=window.innerHeight-$("#header").height(),$("#header").width(maxWidth),canvasWrapper=$("#canvasWrapper");let g=canvasHeight;g>maxHeight&&(g=maxHeight),[canvasWrapper].forEach(c=>{c.css({left:canvasWidth>maxWidth?0:maxWidth/2-canvasWidth/2,width:canvasWidth>maxWidth?maxWidth:canvasWidth,height:g,"overflow-x":canvasWidth+16<maxWidth?"hidden":"auto","overflow-Y":canvasHeight<maxHeight?"hidden":"auto",top:"50%","margin-top":$("#header").height()/2-g/2+"px"})}),y=canvasWidth<maxWidth?0:16,x=canvasHeight<maxHeight?0:16,o()}function n(){const c=v&&v.historyRedo.length,d=v&&v.historyUndo.length;$(".button[tag=undo]").attr("status",d?"on":"Disable"),$(".button[tag=undo]")[d?"removeClass":"addClass"]("disable"),$(".button[tag=redo]").attr("status",c?"on":"Disable"),$(".button[tag=redo]")[c?"removeClass":"addClass"]("disable"),$("#toolbar .button").each(function(){$(this).attr("title",$(this).attr("tag")),"on"===$(this).attr("status")?($(this).attr({src:"images/drawing/"+$(this).attr("tag")+($(this).attr("tag")===E.current?"On":"Off")+".png"}).css({cursor:"pointer"}),$(this)[$(this).attr("tag")===E.current?"addClass":"removeClass"]("on")):$(this).attr({src:"images/drawing/"+$(this).attr("tag")+"Disable.png"}).css({cursor:"not-allowed"})})}function o(){z=$("#canvasWrapper").scrollLeft(),A=$("#canvasWrapper").scrollTop()}function p(){$(".linePickerOverlay hr").click(function(){q=parseInt(this.style.height),E.status="ready",$(".linePickerOverlay").slideUp(),v&&v.isDrawingMode&&v.freeDrawingBrush&&(v.freeDrawingBrush.width=q)}),$("#LineWidthPicker").mouseenter(function(){let c=$(".linePickerOverlay");c.is(":visible")||(E.status="changingWidth",c.slideDown())}).mouseleave(function(){E.status="ready",$(".linePickerOverlay").slideUp()}),$(document.body).bind("mousedown",function(c){if(0===c.button){let d=h(c);if(d||j(),d&&"text"===E.current&&j(),d&&"ready"===E.status){if(v&&v.getActiveObject())return;E[E.current].begin(d,c)}else"function"==typeof E[E.current].end&&E[E.current].end(d,c);if("page-editor"===c.delegateTarget.id)return!1}}),$(document.body).bind("mousemove",function(c){dime=h(c),$("#canvasWrapper").css("default"),$("#canvasWrapper").css("cursor","default"),dime&&(("ready"===E.status||"started"===E.status)&&$("#canvasWrapper").css("cursor","crosshair"),"started"===E.status&&$.isFunction(E[E.current].move)&&E[E.current].move(dime))}),$(window).resize(m),$(document.body).bind("mouseup",function(c){dime=h(c),E.current&&l(E[E.current].up)}),$("#toolbar .button").click(function(){$this=$(this);"on"!==$this.attr("status")||(e(),k($this.attr("tag")),v.isDrawingMode=$(this).data("free-drawing"),$.isFunction(E[$this.attr("tag")].click)&&E[$this.attr("tag")].click(),$this.attr({src:"images/drawing/"+$this.attr("tag")+"On.png"}),$this.addClass("on"),n())}),$("#canvasWrapper").bind("scroll",o)}let q,r,s,t,u,v,w,x,y,z,A,B,C,D="#ff0000",E={current:"line",status:"ready"},F={rx1:0,rx2:0,ry1:0,ry2:0};E.house={},E.ellipsis={},E.crop={},E.undo={},E.redo={},E.line={},E.free={},E.rectangle={},E.full={},E.arrow={},E.move={},E.highlight={},E.text={},E.spray={};const G={hasBorders:!1,hasControls:!0,selectable:!1,hoverCursor:"default"};E.undo.click=function(){v&&v.undo()},E.redo.click=function(){v&&v.redo()},E.move.click=function(){v.set({selection:!0}),v.hoverCursor="grabbing";let c=v.getObjects(),d=new fabric.ActiveSelection(c);v.setActiveObject(d),c.forEach(c=>{c.set("selectable",!0),c.set("hoverCursor","grabbing")}),v.add(d),v.remove(d)},E.move.begin=()=>{},this.createLastCanvas=function(c=()=>{}){let d=document.createElement("canvas");d.width=F.rx2-F.rx1,d.height=F.ry2-F.ry1;let e=d.getContext("2d");e.drawImage(B,F.rx1,F.ry1,F.rx2-F.rx1,F.ry2-F.ry1,0,0,F.rx2-F.rx1,F.ry2-F.ry1),0!==$(".lower-canvas").length&&e.drawImage($(".lower-canvas")[0],F.rx1,F.ry1,F.rx2-F.rx1,F.ry2-F.ry1,0,0,F.rx2-F.rx1,F.ry2-F.ry1),canvasToDataURL=d.toDataURL(),c(canvasToDataURL)},this.reloadCanvas=function(){screenshot.url&&$("title").html(screenshot.url),f(),m(),n(),$("#toolbar .button[tag="+localStorage.lastTool+"]").trigger("click")},this.init=function(){if($("#wColorPicker2_3").wColorPicker({theme:"blue",mode:"hover",showSpeed:300,hideSpeed:300,buttonSize:26,initColor:localStorage.color||"#FF0000",onSelect:function(c){localStorage.color=c,D=c,v&&v.isDrawingMode&&v.freeDrawingBrush&&(v.freeDrawingBrush.color=D)}}).on("mousedown",function(c){return c.stopPropagation(),!1}),s=$("#canvasId"),r=s[0],p(),n(),screenshot.canvas){w=$("canvas")[1],C=$("#imgFixForLong"),B=C[0],B.onload=function(){w.width=this.width,w.height=this.height,B=this,w.getContext("2d").drawImage(this,0,75,w.width,w.height),e(),editor.reloadCanvas()};try{B.src=screenshot.canvas.toDataURL()}catch(c){}screenshot.canvas.width=screenshot.canvas.height=1,screenshot.canvas.remove(),screenshot.canvas=null,delete screenshot.canvas}},E.line.begin=function(c,d){function e(c){if(k&&j){const{x:d,y:e}=v.getPointer(c.e);j.set({x2:d,y2:e}),v.renderAll()}}function f(c){if(j){const{x:d,y:g}=v.getPointer(c.e);j.set({x2:d,y2:g}),v.renderAll(),k=!1,v.off("mouse:move",e),v.off("mouse:up",f),j=null,E.status="ready"}}if("ready"!==E.status)return;E.status="started";const{x:g,y:h}=v.getPointer(d);let j=new fabric.Line([g,h,g+100,h+100],{stroke:D,fill:D,strokeWidth:q||2,selectable:!0,...G});v.add(j);let k=!0;v.on("mouse:move",e),v.on("mouse:up",f)},E.rectangle.begin=function(c,d){function e(c){if(!m||!l)return;const{x:d,y:e}=v.getPointer(c.e);l.set({width:d-j,height:e-k}),v.renderAll()}function f(c){if(!l)return;const{x:d,y:g}=v.getPointer(c.e);l.set({width:d-j,height:g-k}),v.renderAll(),m=!1,v.off("mouse:move",e),v.off("mouse:up",f),l=null,E.status="ready"}if("ready"!==E.status)return;E.status="started";const{x:g,y:h}=v.getPointer(d);let j=g,k=h,l=new fabric.Rect({left:j,top:k,fill:"transparent",width:150,height:150,objectCaching:!1,stroke:D,strokeWidth:q||2,...G});v.add(l);let m=!0;v.on("mouse:move",e),v.on("mouse:up",f)},E.full.begin=function(){function c(c){if(!k||!j)return;const{x:d,y:e}=v.getPointer(c.e);j.set({width:d-g,height:e-h}),v.renderAll()}function d(e){if(!j)return;const{x:f,y:l}=v.getPointer(e.e);j.set({width:f-g,height:l-h}),v.renderAll(),k=!1,v.off("mouse:move",c),v.off("mouse:up",d),j=null,E.status="ready"}if("ready"!==E.status)return;E.status="started";const{x:e,y:f}=v.getPointer(event);let g=e,h=f,j=new fabric.Rect({left:g,top:h,fill:D,width:150,height:150,objectCaching:!1,stroke:D,...G});v.add(j);let k=!0;v.on("mouse:move",c),v.on("mouse:up",d)},E.ellipsis.begin=function(){var e=Math.abs;function c(){if(!l||!k)return;let{x:c,y:d}=v.getPointer(event),f=e(h-c)/2,g=e(j-d)/2;f>k.strokeWidth&&(f-=k.strokeWidth/2),g>k.strokeWidth&&(g-=k.strokeWidth/2),k.set({rx:f,ry:g}),h>c?k.set({originX:"right"}):k.set({originX:"left"}),j>d?k.set({originY:"bottom"}):k.set({originY:"top"}),v.renderAll()}function d(){if(!k)return;let{x:f,y:g}=v.getPointer(event),m=e(h-f)/2,n=e(j-g)/2;m>k.strokeWidth&&(m-=k.strokeWidth/2),n>k.strokeWidth&&(n-=k.strokeWidth/2),k.set({rx:m,ry:n}),h>f?k.set({originX:"right"}):k.set({originX:"left"}),j>g?k.set({originY:"bottom"}):k.set({originY:"top"}),v.renderAll(),l=!1,v.off("mouse:move",c),v.off("mouse:up",d),k=null,E.status="ready"}if("ready"!==E.status)return;E.status="started",E.ellipsis.data={};const{x:f,y:g}=v.getPointer(event);let h=f,j=g,k=new fabric.Ellipse({left:h,top:j,originX:"left",originY:"top",rx:f-h,ry:g-j,angle:0,fill:"transparent",stroke:D,strokeWidth:q||2,...G});v.add(k);let l=!0;v.on("mouse:move",c),v.on("mouse:up",d)},E.arrow.begin=function(){function c(c){if(l){const{x:d,y:f}=v.getPointer(c.e);if(!e)e=g([j,k,d,f]),v.add(e);else{const{points:c}=g([j,k,d,f]);c.forEach((c,d)=>{e.points[d]=c}),v.renderAll()}}}function d(f){const{x:h,y:m}=v.getPointer(f.e);l=!1,v.off("mouse:move",c),v.off("mouse:up",d),E.status="ready",e&&(v.remove(e),e=null),v.add(g([j,k,h,m])),v.renderAll(),v.isDrawingMode=!1,v.hoverCursor="",v.selection=!1}v.isDrawingMode=!1,v.selection=!1;let e=null;if("ready"!==E.status)return;E.status="started";const{x:f,y:h}=v.getPointer(event);let j=f,k=h,l=!0;v.on("mouse:move",c),v.on("mouse:up",d)},E.highlight.click=function(){v.isDrawingMode=!0;const c=new fabric.PencilBrush(v);c.color=D,c.width=q||20,v.freeDrawingBrush=c},E.highlight.begin=()=>{},E.free.click=function(){v.isDrawingMode=!0;const c=new fabric.PencilBrush(v);c.color=D,c.width=q||2,v.freeDrawingBrush=c},E.free.begin=()=>{},E.spray.click=function(){v.isDrawingMode=!0;const c=new fabric.SprayBrush(v);c.color=D,c.width=q||20,v.freeDrawingBrush=c},E.spray.begin=()=>{},E.text.begin=function(c,d){if("ready"!==E.status)return E.text.end();d.stopImmediatePropagation(),E.status="started",t=c.x,u=c.y,$("#text_helper").remove(),$("<div id=text_helper style=\"position:absolute;border:none\">adf</div>").appendTo("#canvasWrapper"),x1=t,y1=u,x2=c.x,y2=c.y,x1<x2?(rx1=x1,rx2=x2):(rx1=x2,rx2=x1),y1<y2?(ry1=y1,ry2=y2):(ry1=y2,ry2=y1),$("#text_helper").css({"z-index":1e4,left:-F.rx1+rx1-8,top:-F.ry1+ry1-8,height:100,width:200}),b=["left","top","z-index","width","height","position","font-weight","width","fontWeight"];let e=$("<textarea class=\"textareaHelper\"></textarea>");for(i in b)e.css(b[i],$("#text_helper").css(b[i]));e.css({"background-color":"transparent",padding:0,margin:0,border:"none",color:D,"font-size":"15pt","font-weight":"400"}),e.mousedown(function(c){c.stopImmediatePropagation()}),e.appendTo("#canvasWrapper").focus(),$("#text_helper").remove()},E.text.end=function(){if($("textarea").length){a={text:$("textarea").val(),fontSize:$("textarea").css("font-size").substr(0,2),fontWeight:$("textarea").css("font-weight"),fontFamily:$("textarea").css("font-family"),lineHeight:1,width:$("textarea").css("width"),x:t,y:u};let c=new fabric.Text(a.text,{fontSize:a.fontSize,fill:D,left:a.x-8,top:a.y-8,lineHeight:1,originX:"left",fontFamily:a.fontFamily,...G});$(".textareaHelper").remove(),E.status="ready",v.add(c)}},E.crop.begin=function(c){E.crop.size={before:{...F},after:null},E.status="started",t=c.x,u=c.y},E.crop.click=function(){m()},E.crop.up=function(){if(100>ry2-ry1+rx2-rx1)return;const c={x:F.rx2-F.rx1,y:F.ry2-F.ry1},d={x:rx2-rx1,y:ry2-y1};10>c.x-d.x&&10>c.y-d.y||(F.rx1=rx1,F.rx2=rx2,F.ry1=ry1,F.ry2=ry2,E.crop.size.after={...F},E.crop.draw())},E.crop.draw=function(){$("#crop_helper").remove(),m(),v.fire("canvas:crop",{size:{...E.crop.size}}),$("#canvasWrapper").scrollTop(0).scrollLeft(0),$(".lower-canvas").scrollTop(0).scrollLeft(0),E.status="ready",n()},E.crop.move=function(c){x1=t,y1=u,x2=c.x,y2=c.y;let{rx1Origin:d,ry1Origin:e,rx2Origin:f,ry2Origin:g}=E.crop.size.before;35>$("#canvasWrapper").scrollTop()+$("#canvasWrapper").height()-c.y&&F.ry2<g&&($("#canvasWrapper")[0].scrollTop+=30,c.y+=30),35>$("#canvasWrapper").scrollLeft()+$("#canvasWrapper").width()-c.x&&F.rx2<f&&($("#canvasWrapper")[0].scrollLeft+=30,c.x+=30),35>c.y-$("#canvasWrapper").scrollTop()&&F.ry2<g&&($("#canvasWrapper")[0].scrollTop-=30,c.y-=30),35>c.x-$("#canvasWrapper").scrollLeft()&&F.rx2<f&&($("#canvasWrapper")[0].scrollLeft-=30,c.x-=30),0!==$(".lower-canvas").length&&(35>$(".lower-canvas").scrollTop()+$(".lower-canvas").height()-c.y&&F.ry2<g&&($(".lower-canvas")[0].scrollTop+=30,c.y+=30),35>$(".lower-canvas").scrollLeft()+$(".lower-canvas").width()-c.x&&F.rx2<f&&($(".lower-canvas")[0].scrollLeft+=30,c.x+=30),35>c.y-$(".lower-canvas").scrollTop()&&F.ry2<g&&($(".lower-canvas")[0].scrollTop-=30,c.y-=30),35>c.x-$(".lower-canvas").scrollLeft()&&F.rx2<f&&($(".lower-canvas")[0].scrollLeft-=30,c.x-=30)),x1<x2?(rx1=x1,rx2=x2):(rx1=x2,rx2=x1),y1<y2?(ry1=y1,ry2=y2):(ry1=y2,ry2=y1),$("#crop_helper").remove(),$("<div id=crop_helper><div id=crop_helper_bottom></div><div id=crop_helper_left></div><div id=crop_helper_top></div><div id=crop_helper_right></div></div>").appendTo("#canvasWrapper"),$("#crop_helper *").css({"background-color":"blue",opacity:"0.6",position:"absolute","z-index":1e4}),$("#crop_helper_left").css({"ackground-color":"blue",left:0,top:s.position().top,top:0,width:rx1-F.rx1,height:s.height()+A}),$("#crop_helper_top").css({"ackground-color":"red",left:rx1-F.rx1,top:0,width:F.rx2-(rx1-F.rx1),height:ry1-F.ry1}),$("#crop_helper_bottom").css({"ackground-color":"yellow",left:rx1-F.rx1,top:ry2-F.ry1,width:F.rx2-(rx1-F.rx1),height:F.ry2-ry2}),$("#crop_helper_right").css({"ackground-color":"green",left:rx2-F.rx1,top:ry1-F.ry1,width:F.rx2-(rx2-F.rx1),height:ry2-ry1})},E.house.begin=function(){},E.house.move=function(){},E.house.draw=function(){},E.house.up=function(){},window.changeTool=k}let editor=new Editor_obj;editor.window=window,editor.close=window.close,$(function(){editor.init(),editor.appick||editor.intent||setTimeout(screenshot.createScreenShot,0)});let multiFillText=function(c,d,e,f,g,h){let j=c.getContext("2d"),k=null!==e&&null!==f;d=d.replace(/(\r\n|\n\r|\r|\n)/g,"\n"),sections=d.split("\n");let l,m,n,o,p=0,q=0,r=function(c){k&&j.fillText(c,e,f+g*p),p++,n=j.measureText(c).width,n>q&&(q=n)};for(l=0;l<sections.length;l++){for(o=sections[l].split(" "),index=1;0<o.length&&index<=o.length;)m=o.slice(0,index).join(" "),n=j.measureText(m).width,n>h?(1===index?(m=o.slice(0,1).join(" "),o=o.splice(1)):(m=o.slice(0,index-1).join(" "),o=o.splice(index-1)),r(m),index=1):index++;0<index&&r(o.join(" "))}if(maxHeight=g*p,!k)return{height:maxHeight,width:q}};function saveFile(c,d,e=()=>{},f=()=>{}){function g(){let c="filesystem:chrome-extension://"+chrome.runtime.id+"/temporary/"+d;e(c)}const h=function(c){let d=atob(c.split(",")[1]),e=c.split(",")[0].split(":")[1].split(";")[0],f=new ArrayBuffer(d.length),g=new Uint8Array(f);for(let e=0;e<d.length;e++)g[e]=d.charCodeAt(e);return new Blob([f],{type:e})}(c);let j=h.size+512,k=window.requestFileSystem||window.webkitRequestFileSystem;k(window.TEMPORARY,j,function(c){c.root.getFile(d,{create:!0},function(c){c.createWriter(function(c){c.onwriteend=g,c.write(h)},f)},f)},f)}setTimeout(()=>{const c=new Date().toISOString().replace(/\.\w+/,"").replace(/:/g,"-")+".png";editor.createLastCanvas(d=>saveFile(d,c))},2e3),$(function(){new Toolbar({plugins:[],element:document.getElementById("toolbarContainer"),namespace:"editor",enlargable:!1,page_title:screenshot.title,page_url:screenshot.url,doNotRenderDefaults:!0,whiteIcons:!0,button_size:20,icon_base:"images/",position:"static",type:"image",theme:!0,request:function(c){editor.createLastCanvas(function(d){c(d)})}}),changeTool("house"),$(".save").on("click",function(){editor.createLastCanvas(),chrome.downloads.download({url:canvasToDataURL,filename:Date.now()+".png",saveAs:!0})}),$(".save-to-pdf").on("click",function(){editor.createLastCanvas();const c=new Image,d=595.28,e=841.89;let f=.5,g=d,h=e,j="p";c.src=canvasToDataURL,c.onload=()=>{c.width*f>g-40&&(j="l",g=e,h=d,f=(g-40)/c.width);let k=0,l=document.createElement("canvas");const m=new jsPDF(j,"pt");for(;k<c.height;){0!==k&&m.addPage();const d=l.getContext("2d");l.width=c.width,l.height=(h-20)/f,d.rect(0,0,l.width,l.height),d.fillStyle="white",d.fill(),d.drawImage(c,0,k,c.width,c.height-k,0,0,c.width,c.height-k);const e=l.toDataURL("image/jpeg",1);m.addImage(e,"JPEG",10,10,l.width*f,l.height*f),k+=l.height}chrome.downloads.download({url:m.output("datauristring"),filename:Date.now()+".pdf",saveAs:!0})}}),$(".buttons .copy").on("click",function(){changeTool("house"),$(".button[tag]").removeClass("on"),editor.createLastCanvas(),$(".copy-modal").remove(),$(`
            <div class="copy-modal">
                <div class="copy-modal-box">
                    <div class="copy-modal-close">✕</div>
                    <h2>Right click the image and choose "Copy Image" for copying the image to the clipboard (buffer).</h2>
                    <img src="${canvasToDataURL}">
                </div>
            </div>`).appendTo(document.body)}),$(document.body).on("click",".copy-modal",c=>{c.target.closest(".copy-modal-box")||$(".copy-modal").remove()}),$(document.body).on("click",".copy-modal-close",()=>$(".copy-modal").remove()),$(document.body).on("keyup",c=>{27===c.keyCode&&$(".copy-modal").remove()})});