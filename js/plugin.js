const buttons_colors=["#F3B200","#77B900","#2572EB","#AA4344","#7F6E94","#199900","#FF981D","#AA40FF","#91D100","#E1B700","#FF76BC","#56C5FF","#00C13F","#FE7C22"];function createPluginFromObject(a){if(window.extStorageGet||(window.extStorageGet=function(a){return localStorage[a]},window.extStorageSet=function(a,b){return localStorage[a]=b}),!a.key)return{error:"You Don't have a \"key\" key",id:4};if(!a.onclick&&!a.url)return{error:"You don't have a onclick function or url key",id:1};if(!a.name)return{error:"You must add a \"name\" key",id:2};let b=a.dataType||"";return(b=b.replace(/text/g,""),b=b.replace(/image_url/g,""),b=b.replace(/image/g,""),b=b.replace(/page/g,""),b=b.replace(/image_base64/g,""),b=b.trim(),0<b.length)?{error:"Cannot recognize dataType: "+b}:(a=$.extend({dataType:"text image_url",isDataType:function(a){return-1<this.dataType.toLowerCase().indexOf(a.toLowerCase())},dataTypes:function(){return this.dataType.split(" ")},run:function(b,c){if(this.toolbar){var d=this.toolbar.namespace+"_"+this.key+"_run";extStorageGet(d)||extStorageSet(d,0),extStorageSet(d,parseInt(extStorageGet(d),10)+1)}for(var e in sb)this[e]=sb[e];var f=a;if(f.event=c,f.page_title=this.toolbar&&this.toolbar.page_title||$("title").text()||"no title",f.page_description=this.toolbar&&this.toolbar.page_description||$("meta[name=description]").attr("content")||"",f.page_url=this.toolbar&&this.toolbar.page_url||location.toString(),this.isDataType("text"))f.text=b,f.dataType="text",this.onclick?this.onclick(f):this.url&&this.createTabWithParams(this.url,b,f);else if(this.isDataType("image")){f.image_url=function(a){var b=this.image_data();if(this.toolbar&&b===this.toolbar.last_image_data)return void a(this.toolbar.last_image_url)},f.image_base64=function(a){var b=this.image_data(),c=b.slice(b.indexOf(",")+1);return a&&a(c),c};var g=function(a){for(var b=atob(a),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/png"})};if(f.image_blob=function(){return g(f.image_base64())},(Array.isArray(b)||b.jquery)&&(b=b[0]),"string"==typeof b&&"data"===b.slice(0,4))f.image_data=function(a){return a&&a(b),b};else if(b.nodeType){var h;"IMG"===b.tagName&&(h=document.createElement("canvas"),h.width=b.width,h.height=b.height,h.getContext("2d").drawImage(b,0,0)),"CANVAS"===b.tagName&&(h=b),"CANVAS"===b.tagName||"IMG"===b.tagName?f.image_data=function(a){var b=h.toDataURL();return a&&a(b),b}:alert("plugin tag get no supported:"+b.tagName)}this.url&&f.image_url(function(a){f.createTabWithParams(f.url,a,f)}),this.onclick&&("image"===this.dataType&&(f.dataType="image"),this.onclick(f))}else this.onclick&&this.onclick(f)}},a),{plugin:a})}sb={createTabWithParams:function(a,b,c){var d=this.url;d=d.replace(/{image_url}/g,"%c"),d=d.replace(/{page_url}/g,encodeURIComponent(this.page_url)),d=d.replace(/{page_title}/g,encodeURIComponent(this.page_title)),d=d.replace(/{page_description}/g,encodeURIComponent(this.page_description)),d=d.replace(/{text}/g,encodeURIComponent(this.text)),d=d.replace(/%s/g,b).replace("%c",encodeURIComponent(b.replace("img","i3"))).replace(/%t/g,encodeURIComponent(c.title)),this.createTab(d)},createTab:function(a){window.open(a,"_blank")},dialog:function(a,b){a=$(a),$("input",a).not("[type=password]").inputLoadAndRemember(this);var c=$.extend({},b,{element:a,ui:"dialog",title:this.name}),d=new Dialog(c);return d.show(),$("input",d.contentDocument).first().focus(),d},storageGet:function(a,b){var c,d=(this.toolbar&&this.toolbar.namespace)+"_"+this.key+"_"+a;return c=extStorageGet?extStorageGet(d):localStorage[d],void 0===c&&(c=b),isNumber(c)?parseFloat(c):c},storageSet:function(a,b){var c=(this.toolbar&&this.toolbar.namespace)+"_"+this.key+"_"+a;return extStorageSet?extStorageSet(c,b):localStorage[c]=b}};function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function Toolbar(a){function b(){var b;c.html(""),c.css("z-index",h.zIndex);var e=0,j=0;$.each(h.obj_plugins,function(){for(var a in this.dataTypes=this.dataType.split(" "),d)for(var b in this.dataTypes)d[a]===this.dataTypes[b]&&j++});var k=-1;$.each(h.obj_plugins,function(){var f=Math.round;if(!(a.doNotRenderDefaults&&this.editorDefault)){var g=!1;for(var i in d)for(var l in this.dataTypes)d[i]===this.dataTypes[l]&&(g=!0);if(g){if(a.theme)b=$("<div class=\"tb_button\" plugin-key=\""+this.key+"\"><img src="+h.icon_base+(this.key+".png ></div>"));else{var m=a.whiteIcons&&"padding: 4px 3px;margin-bottom: 3px;margin-left: 3px;margin-right: 2px;background: #777;float: left;border: none;color: #fff;height: 20px;line-height: 20px;border-radius: 3px;cursor: pointer;box-sizing: content-box;float:left;"||"float:left";b=$("<div style=\""+m+"\"><div style=display:none;font-size:10px;font-family:arial;text-align:center>"+this.name+"</div><img class=tb_button plugin-key=\""+this.key+"\"src="+h.icon_base+(this.key+".png ></div>"))}e++,$("img,div",b).attr("width",a.button_size+"px"),$("img,div",b).attr("height",a.button_size+"px"),$("img,div",b).css({width:a.button_size+"px",height:a.button_size+"px","border-right":"none","border-left":"none","border-bottom":"none","box-sizing":"content-box",padding:a.whiteIcons?"0":"5px",float:"left"}),b.attr("title",this.name);var n=this;n.$=b;var o=$("img",b).on({error:function(){},mouseenter:function(){},mouseleave:function(){"down"!==n.state&&$(this).removeClass("hover")},"mousedown mouseup":function(a){a.stopPropagation()},click:function(a){"Range"===window.getSelection().type&&(text=window.getSelection().getRangeAt(0).toString()),h.keepDown&&"down"!==n.state?($.each(h.obj_plugins,function(a,b){"down"===b.state&&(b.state="up")}),c.find("img").css("background","#fff"),o.css("background","#4BBAFF"),n.state="down",h.active=n):h.keepDown&&"down"===n.state&&(n.state="up",h.active=null,o.css("background","#fff")),h.request(function(b){!1===n.closeOnClick&&a.stopPropagation(),n.run(b,a)},n)}});k++,!0===a.colors&&(thisColorIndex=k,thisColorIndex>=buttons_colors.length&&(thisColorIndex=0),$("img",b).css("backgroundColor",buttons_colors[thisColorIndex])),c.append(b),f(j/this.toolbar.lines+1)===e&&b.css("clear","both")}}}),a.enlargable&&(f=$("<div style=cursor:pointer;float:left><img style=\"margin:-5px\"  src="+h.icon_base+"right.png></div>"),g=$("<div style=cursor:pointer;float:left><img style=\"width:15px; height:15px;padding: 5px; box-sizing: content-box;float: left\" src="+h.icon_base+"left.png></div>"),c.append(f).append(g),i(),f.add(g).find("img").css("height",a.button_size).on("mousedown",function(a){a.stopPropagation()}),f.on("click",function(){return h.storageSet("isMax","yes"),i(),!1}),g.on("click",function(){return h.storageSet("isMax","no"),i(),!1}))}this.obj_plugins={};var c="",d=[];if(c=$("<div class=\"plugin-toolbar\"></div>"),!a.theme){var e="background: #fff;box-shadow: 0 2px 2px rgba(0,0,0,0.15);border: 1px #aaaaab solid;border-radius: 4px;display:inline-block;";a.whiteIcons&&(e+="padding-top:3px;"),c.attr("style",e)}var f,g,h=this,i=function(){h.isMax()?(g.show(),f.hide(),$(".tb_button",c).parent().show()):(g.hide(),f.show(),$(".tb_button",c).parent().hide().slice(0,a.min_buttons_num).show())};this.isMax=function(){return"yes"===h.storageGet("isMax")},this.addPlugins=function(a){Array.isArray(a)||(a=[a]),$.each(a,function(a,b){var c=createPluginFromObject(b);c.error||(c=c.plugin,c.toolbar=h,h.obj_plugins[c.key]=c)})},this.removeToolbar=function(){$(a.element).html(""),$(document).off("click",h.removeToolbar)};var j=function(){setTimeout(function(){$(document).on("click",h.removeToolbar)},0)},k=function(){for(var e in d=a.type.split(" "),a=$.extend({},{icon_base:"icons/",lines:1,min_buttons_num:2,zIndex:2e4,button_size:15},a),a)this[e]=a[e];if(this.addPlugins(a.plugins),"static"===this.position&&(b(),$(a.element).append(c),a.pushDown)){c.css({position:"fixed",top:"0px",left:"0px",borderTop:"none",borderLeft:"none",borderTopRightRadius:"0px"});var f=$(c).height()+5;(function(){return $("*").filter(function(){return"fixed"===$(this).css("position")})})().not(c).css("margin-top",function(a,b){return parseInt(b)+f});var g=(parseInt($("tml").css("margin-top"))||0)+f;try{s=document.createElement("style"),document.getElementsByTagName("html")[0].appendChild(s),s.innerText="@media print {.ws_toolbar_top {display:none}} @media screen {html {margin-top:"+g+"px;position:relative}"}catch(a){}}a.closeOnClick&&j()};this.storageGet=function(a,b){var c,d=(this.namespace&&"toolbarnonamespace")+"_"+a;return c=extStorageGet?extStorageGet(d):localStorage[d],void 0===c&&(c=b),isNumber(c)?parseFloat(c):c},this.storageSet=function(a,b){var c=(this.namespace&&"toolbarnonamespace")+"_"+a;return extStorageSet?extStorageSet(c,b):localStorage[c]=b},k.call(this)}function appendFirstStyle(){const a=document.createElement("style");var b="";b+=".tb_button {padding:1px;cursor:pointer;border-right: 1px solid #8b8b8b;border-left: 1px solid #FFF;border-bottom: 1px solid #fff;}",b+=".tb_button.hover {borer:2px outset #def; background-color: #f8f8f8 !important;}",b+=".ws_toolbar {z-index:100000} .ws_toolbar .ws_tb_btn {cursor:pointer;border:1px solid #555;padding:3px}   .tb_highlight{background-color:yellow} .tb_hide {visibility:hidden} .ws_toolbar img {padding:2px;margin:0px}",a.innerText=b,document.body.appendChild(a)}"complete"===document.readyState?appendFirstStyle():window.addEventListener("load",appendFirstStyle);