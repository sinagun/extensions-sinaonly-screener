/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var fabric=fabric||{version:"3.6.4"};if("undefined"==typeof exports?"function"==typeof define&&define.amd&&define([],function(){return fabric}):exports.fabric=fabric,"undefined"!=typeof document&&"undefined"!=typeof window)fabric.document=document instanceof("undefined"==typeof HTMLDocument?Document:HTMLDocument)?document:document.implementation.createHTMLDocument(""),fabric.window=window;else{var jsdom=require("jsdom"),virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;fabric.document=virtualWindow.document,fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=virtualWindow,DOMParser=fabric.window.DOMParser}fabric.isTouchSupported="ontouchstart"in fabric.window||"ontouchstart"in fabric.document||fabric.window&&fabric.window.navigator&&0<fabric.window.navigator.maxTouchPoints,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,fabric.reNonWord=/[ \n\.,;!\?\-]/,fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.svgNS="http://www.w3.org/2000/svg",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.disableStyleCopyPaste=!1,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.arcToSegmentsCache={},fabric.boundsOfCurveCache={},fabric.cachesBoundsOfCurve=!0,fabric.forceGLPutImageData=!1,fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize))return new fabric.WebglFilterBackend({tileSize:fabric.textureSize});return fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),function(){function e(e,t){if(this.__eventListeners[e]){var r=this.__eventListeners[e];t?r[r.indexOf(t)]=!1:fabric.util.array.fill(r,!1)}}function t(e,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var r in e)this.on(r,e[r]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this}function r(t,r){if(!this.__eventListeners)return this;if(0===arguments.length)for(t in this.__eventListeners)e.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var o in t)e.call(this,o,t[o]);else e.call(this,t,r);return this}function o(e,t){if(!this.__eventListeners)return this;var r=this.__eventListeners[e];if(!r)return this;for(var o=0,n=r.length;o<n;o++)r[o]&&r[o].call(this,t||{});return this.__eventListeners[e]=r.filter(function(e){return!1!==e}),this}fabric.Observable={observe:t,stopObserving:r,fire:o,on:t,off:r,trigger:o}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,r){var o=this._objects;return r?o[t]=e:o.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e=this._objects,t=!1,r=0,o=arguments.length,n;r<o;r++)n=e.indexOf(arguments[r]),-1!==n&&(t=!0,e.splice(n,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[r]));return this.renderOnAddRemove&&t&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var r=this.getObjects(),o=0,n=r.length;o<n;o++)e.call(t,r[o],o,r);return this},getObjects:function(e){return"undefined"==typeof e?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(e){return-1<this._objects.indexOf(e)},complexity:function(){return this._objects.reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}},fabric.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){e&&e.colorStops&&!(e instanceof fabric.Gradient)&&this.set(t,new fabric.Gradient(e))},_initPattern:function(e,t,r){e&&e.source&&!(e instanceof fabric.Pattern)?this.set(t,new fabric.Pattern(e,r)):r&&r()},_initClipping:function(e){if(e.clipTo&&"string"==typeof e.clipTo){var t=fabric.util.getFunctionBody(e.clipTo);"undefined"!=typeof t&&(this.clipTo=new Function("ctx",t))}},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return"object"==typeof e?this._setObject(e):"function"==typeof t&&"clipTo"!==e?this._set(e,t(this.get(e))):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this},get:function(e){return this[e]}},function(e){var t=Math.max,r=Math.min,o=Math.tan,i=Math.floor,n=Math.sin,a=Math.PI,s=Math.sqrt,l=s,c=Math.atan2,d=Math.pow,g=a/180,u=a/2;fabric.util={cos:function(e){if(0===e)return 1;0>e&&(e=-e);var t=e/u;return 1==t||3===t?0:2===t?-1:Math.cos(e)},sin:function(e){if(0===e)return 0;var t=e/u,r=1;return 0>e&&(r=-1),1==t?r:2===t?0:3===t?-r:n(e)},removeFromArray:function(e,t){var r=e.indexOf(t);return-1!==r&&e.splice(r,1),e},getRandomInt:function(e,t){return i(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*g},radiansToDegrees:function(e){return e/g},rotatePoint:function(e,t,r){e.subtractEquals(t);var o=fabric.util.rotateVector(e,r);return new fabric.Point(o.x,o.y).addEquals(t)},rotateVector:function(e,t){var r=fabric.util.sin(t),o=fabric.util.cos(t),i=e.x*o-e.y*r,n=e.x*r+e.y*o;return{x:i,y:n}},transformPoint:function(e,r,t){return t?new fabric.Point(r[0]*e.x+r[2]*e.y,r[1]*e.x+r[3]*e.y):new fabric.Point(r[0]*e.x+r[2]*e.y+r[4],r[1]*e.x+r[3]*e.y+r[5])},makeBoundingBoxFromPoints:function(e,t){if(t)for(var r=0;r<e.length;r++)e[r]=fabric.util.transformPoint(e[r],t);var o=[e[0].x,e[1].x,e[2].x,e[3].x],n=fabric.util.array.min(o),a=fabric.util.array.max(o),s=[e[0].y,e[1].y,e[2].y,e[3].y],l=fabric.util.array.min(s),c=fabric.util.array.max(s);return{left:n,top:l,width:a-n,height:c-l}},invertTransform:function(e){var t=1/(e[0]*e[3]-e[1]*e[2]),i=[t*e[3],-t*e[1],-t*e[2],t*e[0]],r=fabric.util.transformPoint({x:e[4],y:e[5]},i,!0);return i[4]=-r.x,i[5]=-r.y,i},toFixed:function(e,t){return parseFloat((+e).toFixed(t))},parseUnit:function(e,t){var r=/\D{0,2}$/.exec(e),o=parseFloat(e);switch(t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE),r[0]){case"mm":return o*fabric.DPI/25.4;case"cm":return o*fabric.DPI/2.54;case"in":return o*fabric.DPI;case"pt":return o*fabric.DPI/72;case"pc":return 12*(o*fabric.DPI/72);case"em":return o*t;default:return o;}},falseFunction:function(){return!1},getKlass:function(e,t){return e=fabric.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),fabric.util.resolveNamespace(t)[e]},getSvgAttributes:function(e){var t=["instantiated_by_use","style","id","class"];return"linearGradient"===e?t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]):"radialGradient"===e?t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]):"stop"===e?t=t.concat(["offset","stop-color","stop-opacity"]):void 0,t},resolveNamespace:function(t){if(!t)return fabric;var r=t.split("."),o=r.length,n=e||fabric.window,a;for(a=0;a<o;++a)n=n[r[a]];return n},loadImage:function(e,t,r,o){if(!e)return void(t&&t.call(r,e));var i=fabric.util.createImage(),n=function(){t&&t.call(r,i),i=i.onload=i.onerror=null};i.onload=n,i.onerror=function(){fabric.log("Error loading "+i.src),t&&t.call(r,null,!0),i=i.onload=i.onerror=null},0!==e.indexOf("data")&&o&&(i.crossOrigin=o),"data:image/svg"===e.substring(0,14)&&(i.onload=null,fabric.util.loadImageInDom(i,n)),i.src=e},loadImageInDom:function(e,t){var r=fabric.document.createElement("div");r.style.width=r.style.height="1px",r.style.left=r.style.top="-100%",r.style.position="absolute",r.appendChild(e),fabric.document.querySelector("body").appendChild(r),e.onload=function(){t(),r.parentNode.removeChild(r),r=null}},enlivenObjects:function(e,t,r,i){function n(){++s===l&&t&&t(a.filter(function(e){return e}))}e=e||[];var a=[],s=0,l=e.length;return l?void e.forEach(function(e,t){if(!e||!e.type)return void n();var o=fabric.util.getKlass(e.type,r);o.fromObject(e,function(r,o){o||(a[t]=r),i&&i(e,r,o),n()})}):void(t&&t(a))},enlivenPatterns:function(e,t){function r(){++i===n&&t&&t(o)}e=e||[];var o=[],i=0,n=e.length;return n?void e.forEach(function(e,t){e&&e.source?new fabric.Pattern(e,function(e){o[t]=e,r()}):(o[t]=e,r())}):void(t&&t(o))},groupSVGElements:function(e,t,r){var o;return e&&1===e.length?e[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),o=new fabric.Group(e,t),"undefined"!=typeof r&&(o.sourcePath=r),o)},populateWithProperties:function(e,t,r){if(r&&"[object Array]"===Object.prototype.toString.call(r))for(var o=0,n=r.length;o<n;o++)r[o]in e&&(t[r[o]]=e[r[o]])},drawDashedLine:function(e,t,r,o,i,n){var a=o-t,s=i-r,d=l(a*a+s*s),g=c(s,a),u=n.length,p=0,h=!0;for(e.save(),e.translate(t,r),e.moveTo(0,0),e.rotate(g),t=0;d>t;)t+=n[p++%u],t>d&&(t=d),e[h?"lineTo":"moveTo"](t,0),h=!h;e.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(e){var t=fabric.util.createCanvasElement();return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},toDataURL:function(e,t,r){return e.toDataURL("image/"+t,r)},createImage:function(){return fabric.document.createElement("img")},clipContext:function(e,t){t.save(),t.beginPath(),e.clipTo(t),t.clip()},multiplyTransformMatrices:function(e,t,r){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],r?0:e[0]*t[4]+e[2]*t[5]+e[4],r?0:e[1]*t[4]+e[3]*t[5]+e[5]]},qrDecompose:function(e){var t=c(e[1],e[0]),r=d(e[0],2)+d(e[1],2),o=l(r),i=(e[0]*e[3]-e[2]*e[1])/o,n=c(e[0]*e[2]+e[1]*e[3],r);return{angle:t/g,scaleX:o,scaleY:i,skewX:n/g,skewY:0,translateX:e[4],translateY:e[5]}},calcRotateMatrix:function(e){if(!e.angle)return fabric.iMatrix.concat();var t=fabric.util.degreesToRadians(e.angle),r=fabric.util.cos(t),o=fabric.util.sin(t);return[r,o,-o,r,0,0]},calcDimensionsMatrix:function(e){var t="undefined"==typeof e.scaleX?1:e.scaleX,r="undefined"==typeof e.scaleY?1:e.scaleY,i=[e.flipX?-t:t,0,0,e.flipY?-r:r,0,0],n=fabric.util.multiplyTransformMatrices,a=fabric.util.degreesToRadians;return e.skewX&&(i=n(i,[1,0,o(a(e.skewX)),1],!0)),e.skewY&&(i=n(i,[1,o(a(e.skewY)),0,1],!0)),i},composeMatrix:function(e){var t=[1,0,0,1,e.translateX||0,e.translateY||0],r=fabric.util.multiplyTransformMatrices;return e.angle&&(t=r(t,fabric.util.calcRotateMatrix(e))),(e.scaleX||e.scaleY||e.skewX||e.skewY||e.flipX||e.flipY)&&(t=r(t,fabric.util.calcDimensionsMatrix(e))),t},customTransformMatrix:function(e,t,r){return fabric.util.composeMatrix({scaleX:e,scaleY:t,skewX:r})},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},getFunctionBody:function(e){return((e+"").match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(e,t,r,o){0<o&&(t>o?t-=o:t=0,r>o?r-=o:r=0);var n=!0,a=e.getImageData(t,r,2*o||1,2*o||1),s=a.data.length,l,c;for(l=3;l<s&&(c=a.data[l],n=0>=c,!1!==n);l+=4);return a=null,n},parsePreserveAspectRatioAttribute:function(e){var t="meet",r="Mid",o="Mid",i=e.split(" "),n;return i&&i.length&&(t=i.pop(),"meet"!==t&&"slice"!==t?(n=t,t="meet"):i.length&&(n=i.pop())),r="none"===n?"none":n.slice(1,4),o="none"===n?"none":n.slice(5,8),{meetOrSlice:t,alignX:r,alignY:o}},clearFabricFontCache:function(e){e=(e||"").toLowerCase(),e?fabric.charWidthsCache[e]&&delete fabric.charWidthsCache[e]:fabric.charWidthsCache={}},limitDimsByArea:function(e,t){var r=s(t*e),o=i(t/r);return{x:i(r),y:o}},capValue:function(e,o,i){return t(e,r(o,i))},findScaleToFit:function(e,t){return r(t.width/e.width,t.height/e.height)},findScaleToCover:function(e,r){return t(r.width/e.width,r.height/e.height)},matrixToSVG:function(e){return"matrix("+e.map(function(e){return fabric.util.toFixed(e,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}}("undefined"==typeof exports?this:exports),function(){var n=Math.ceil,l=Math.abs,d=Math.max,g=Math.min,u=Math.sin,p=Math.PI,h=Math.atan2,f=Math.sqrt;function e(e,o,a,c,d,g,h){var _=m.call(arguments);if(fabric.arcToSegmentsCache[_])return fabric.arcToSegmentsCache[_];var y=p,x=h*y/180,v=fabric.util.sin(x),C=fabric.util.cos(x),b=0,S=0;a=l(a),c=l(c);var T=.5*(-C*e)-.5*(v*o),O=.5*(-C*o)+.5*(v*e),w=a*a,P=c*c,k=O*O,D=T*T,j=w*P-w*k-P*D,E=0;if(0>j){var A=f(1-j/(w*P));a*=A,c*=A}else E=(d===g?-1:1)*f(j/(w*k+P*D));var s=E*a*O/c,F=-E*c*T/a,I=r(1,0,(T-s)/a,(O-F)/c),L=r((T-s)/a,(O-F)/c,(-T-s)/a,(-O-F)/c);0===g&&0<L?L-=2*y:1==g&&0>L&&(L+=2*y);for(var R=n(l(2*(L/y))),M=[],B=L/R,X=8/3*u(B/4)*u(B/4)/u(B/2),Y=I+B,W=0;W<R;W++)M[W]=t(I,Y,C,v,a,c,C*s-v*F+.5*e,v*s+C*F+.5*o,X,b,S),b=M[W][4],S=M[W][5],I=Y,Y+=B;return fabric.arcToSegmentsCache[_]=M,M}function t(e,t,r,o,i,n,a,s,l,c,d){var g=fabric.util.cos(e),u=fabric.util.sin(e),p=fabric.util.cos(t),h=fabric.util.sin(t),f=r*i*p-o*n*h+a,m=o*i*p+r*n*h+s;return[c+l*(-r*i*u-o*n*g),d+l*(-o*i*u+r*n*g),f+l*(r*i*h+o*n*p),m+l*(o*i*h-r*n*p),f,m]}function r(e,t,r,o){var i=h(t,e),n=h(o,r);return n>=i?n-i:2*p-(i-n)}function o(e,r,o,n,s,u,p,h){var _;if(fabric.cachesBoundsOfCurve&&(_=m.call(arguments),fabric.boundsOfCurveCache[_]))return fabric.boundsOfCurveCache[_];var v=g,C=d,S=l,T=[],O=[[],[]],w,P,k,D,E,A,F,I;P=6*e-12*o+6*s,w=-3*e+9*o-9*s+3*p,k=3*o-3*e;for(var L=0;2>L;++L){if(0<L&&(P=6*r-12*n+6*u,w=-3*r+9*n-9*u+3*h,k=3*n-3*r),1e-12>S(w)){if(1e-12>S(P))continue;D=-k/P,0<D&&1>D&&T.push(D);continue}(F=P*P-4*k*w,!(0>F))&&(I=f(F),E=(-P+I)/(2*w),0<E&&1>E&&T.push(E),A=(-P-I)/(2*w),0<A&&1>A&&T.push(A))}for(var R=T.length,M=R,B,X,Y;R--;)D=T[R],Y=1-D,B=Y*Y*Y*e+3*Y*Y*D*o+3*Y*D*D*s+D*D*D*p,O[0][R]=B,X=Y*Y*Y*r+3*Y*Y*D*n+3*Y*D*D*u+D*D*D*h,O[1][R]=X;O[0][M]=e,O[1][M]=r,O[0][M+1]=p,O[1][M+1]=h;var W=[{x:v.apply(null,O[0]),y:v.apply(null,O[1])},{x:C.apply(null,O[0]),y:C.apply(null,O[1])}];return fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[_]=W),W}var m=Array.prototype.join;fabric.util.drawArc=function(t,r,o,n){for(var a=n[0],s=n[1],l=n[2],c=n[3],d=n[4],g=n[5],u=n[6],p=[[],[],[],[]],h=e(g-r,u-o,a,s,c,d,l),f=0,m=h.length;f<m;f++)p[f][0]=h[f][0]+r,p[f][1]=h[f][1]+o,p[f][2]=h[f][2]+r,p[f][3]=h[f][3]+o,p[f][4]=h[f][4]+r,p[f][5]=h[f][5]+o,t.bezierCurveTo.apply(t,p[f])},fabric.util.getBoundsOfArc=function(t,r,n,a,s,l,c,d,g){for(var u=0,p=0,h=[],f=e(d-t,g-r,n,a,l,c,s),m=0,_=f.length,y;m<_;m++)y=o(u,p,f[m][0],f[m][1],f[m][2],f[m][3],f[m][4],f[m][5]),h.push({x:y[0].x+t,y:y[0].y+r}),h.push({x:y[1].x+t,y:y[1].y+r}),u=f[m][4],p=f[m][5];return h},fabric.util.getBoundsOfCurve=o}(),function(){function e(e,t,r){if(e&&0!==e.length){var o=e.length-1,n=t?e[o][t]:e[o];if(t)for(;o--;)r(e[o][t],n)&&(n=e[o][t]);else for(;o--;)r(e[o],n)&&(n=e[o]);return n}}var t=Array.prototype.slice;fabric.util.array={fill:function(e,t){for(var r=e.length;r--;)e[r]=t;return e},invoke:function(e,r){for(var o=t.call(arguments,2),n=[],a=0,s=e.length;a<s;a++)n[a]=o.length?e[a][r].apply(e[a],o):e[a][r].call(e[a]);return n},min:function(t,r){return e(t,r,function(e,t){return e<t})},max:function(t,r){return e(t,r,function(e,t){return e>=t})}}}(),function(){function e(t,r,o){if(!o)for(var n in r)t[n]=r[n];else if(!fabric.isLikelyNode&&r instanceof Element)t=r;else if(r instanceof Array){t=[];for(var a=0,s=r.length;a<s;a++)t[a]=e({},r[a],o)}else if(r&&"object"==typeof r)for(var n in r)"canvas"==n?t[n]=e({},r[n]):r.hasOwnProperty(n)&&(t[n]=e({},r[n],o));else t=r;return t}fabric.util.object={extend:e,clone:function(t,r){return e({},t,r)}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function e(e,t){var r=e.charCodeAt(t);if(isNaN(r))return"";if(55296>r||57343<r)return e.charAt(t);if(55296<=r&&56319>=r){if(e.length<=t+1)throw"High surrogate without following low surrogate";var o=e.charCodeAt(t+1);if(56320>o||57343<o)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";var i=e.charCodeAt(t-1);if(55296>i||56319<i)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var r=0,o=[],n;for(r=0,n;r<t.length;r++)!1!==(n=e(t,r))&&o.push(n);return o}}}(),function(){function e(){}function t(e){for(var t=null,o=this;o.constructor.superclass;){var i=o.constructor.superclass.prototype[e];if(o[e]!==i){t=i;break}o=o.constructor.superclass.prototype}return t?1<arguments.length?t.apply(this,r.call(arguments,1)):t.call(this):console.log("tried to callSuper "+e+", method not found in prototype chain",this)}var r=Array.prototype.slice,o=function(){},i=function(){for(var e in{toString:1})if("toString"==e)return!1;return!0}(),n=function(e,t,r){for(var o in t)e.prototype[o]=o in e.prototype&&"function"==typeof e.prototype[o]&&-1<(t[o]+"").indexOf("callSuper")?function(e){return function(){var o=this.constructor.superclass;this.constructor.superclass=r;var i=t[e].apply(this,arguments);if(this.constructor.superclass=o,"initialize"!==e)return i}}(o):t[o],i&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};fabric.util.createClass=function(){function a(){this.initialize.apply(this,arguments)}var s=null,l=r.call(arguments,0);"function"==typeof l[0]&&(s=l.shift()),a.superclass=s,a.subclasses=[],s&&(e.prototype=s.prototype,a.prototype=new e,s.subclasses.push(a));for(var c=0,d=l.length;c<d;c++)n(a,l[c],s);return a.prototype.initialize||(a.prototype.initialize=o),a.prototype.constructor=a,a.prototype.callSuper=t,a}}(),function(){function e(e){var t=e.changedTouches;return t&&t[0]?t[0]:e}var t=!!fabric.document.createElement("div").attachEvent;fabric.util.addListener=function(e,r,o,i){e&&e.addEventListener(r,o,!t&&i)},fabric.util.removeListener=function(e,r,o,i){e&&e.removeEventListener(r,o,!t&&i)},fabric.util.getPointer=function(t){var r=t.target,o=fabric.util.getScrollLeftTop(r),i=e(t);return{x:i.clientX+o.left,y:i.clientY+o.top}}}(),function(){function e(e,t){var r=e.style;if(!r)return e;if("string"==typeof t)return e.style.cssText+=";"+t,-1<t.indexOf("opacity")?n(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var o in t)if("opacity"==o)n(e,t[o]);else{var i="float"===o||"cssFloat"===o?"undefined"==typeof r.styleFloat?"cssFloat":"styleFloat":o;r[i]=t[o]}return e}var t=fabric.document.createElement("div"),r="string"==typeof t.style.opacity,o="string"==typeof t.style.filter,i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(e){return e};r?n=function(e,t){return e.style.opacity=t,e}:o&&(n=function(e,t){var r=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=.9999<=t?"":"alpha(opacity="+100*t+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+100*t+")",e}),fabric.util.setStyle=e}(),function(){function e(e,t){var r=fabric.document.createElement(e);for(var o in t)"class"==o?r.className=t[o]:"for"===o?r.htmlFor=t[o]:r.setAttribute(o,t[o]);return r}function t(e){for(var t=0,r=0,o=fabric.document.documentElement,i=fabric.document.body||{scrollLeft:0,scrollTop:0};e&&(e.parentNode||e.host)&&(e=e.parentNode||e.host,e===fabric.document?(t=i.scrollLeft||o.scrollLeft||0,r=i.scrollTop||o.scrollTop||0):(t+=e.scrollLeft||0,r+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:t,top:r}}function r(e){var r=e&&e.ownerDocument,o={left:0,top:0},i={left:0,top:0},n={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},s,l;if(!r)return i;for(var c in n)i[n[c]]+=parseInt(a(e,c),10)||0;return s=r.documentElement,"undefined"!=typeof e.getBoundingClientRect&&(o=e.getBoundingClientRect()),l=t(e),{left:o.left+l.left-(s.clientLeft||0)+i.left,top:o.top+l.top-(s.clientTop||0)+i.top}}var o=Array.prototype.slice,i=function(e){return o.call(e,0)},n;try{n=i(fabric.document.childNodes)instanceof Array}catch(e){}n||(i=function(e){for(var t=Array(e.length),r=e.length;r--;)t[r]=e[r];return t});var a;a=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(e,t){var r=fabric.document.defaultView.getComputedStyle(e,null);return r?r[t]:void 0}:function(e,t){var r=e.style[t];return!r&&e.currentStyle&&(r=e.currentStyle[t]),r},function(){var e=fabric.document.documentElement.style,t="userSelect"in e?"userSelect":"MozUserSelect"in e?"MozUserSelect":"WebkitUserSelect"in e?"WebkitUserSelect":"KhtmlUserSelect"in e?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(e){return"undefined"!=typeof e.onselectstart&&(e.onselectstart=fabric.util.falseFunction),t?e.style[t]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e},fabric.util.makeElementSelectable=function(e){return"undefined"!=typeof e.onselectstart&&(e.onselectstart=null),t?e.style[t]="":"string"==typeof e.unselectable&&(e.unselectable=""),e}}(),function(){fabric.util.getScript=function(e,t){var r=fabric.document.getElementsByTagName("head")[0],o=fabric.document.createElement("script"),i=!0;o.onload=o.onreadystatechange=function(r){if(i){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;i=!1,t(r||fabric.window.event),o=o.onload=o.onreadystatechange=null}},o.src=e,r.appendChild(o)}}();fabric.util.getById=function(e){return"string"==typeof e?fabric.document.getElementById(e):e},fabric.util.toArray=i,fabric.util.makeElement=e,fabric.util.addClass=function(e,t){e&&-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=(e.className?" ":"")+t)},fabric.util.wrapElement=function(t,r,o){return"string"==typeof r&&(r=e(r,o)),t.parentNode&&t.parentNode.replaceChild(r,t),r.appendChild(t),r},fabric.util.getScrollLeftTop=t,fabric.util.getElementOffset=r,fabric.util.getElementStyle=a,fabric.util.getNodeCanvas=function(e){var t=fabric.jsdomImplForWrapper(e);return t._canvas||t._image},fabric.util.cleanUpJsdomNode=function(e){if(fabric.isLikelyNode){var t=fabric.jsdomImplForWrapper(e);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}}}(),function(){function e(e,t){return e+(/\?/.test(e)?"&":"?")+t}function t(){}fabric.util.request=function(r,o){o||(o={});var i=o.method?o.method.toUpperCase():"GET",n=o.onComplete||function(){},a=new fabric.window.XMLHttpRequest,s=o.body||o.parameters;return a.onreadystatechange=function(){4===a.readyState&&(n(a),a.onreadystatechange=t)},"GET"===i&&(s=null,"string"==typeof o.parameters&&(r=e(r,o.parameters))),a.open(i,r,!0),("POST"===i||"PUT"===i)&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(s),a}}(),fabric.log=console.log,fabric.warn=console.warn,function(){function e(){return!1}function t(e,t,r,o){return-r*Math.cos(e/o*(Math.PI/2))+r+t}function r(){return o.apply(fabric.window,arguments)}var o=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){return fabric.window.setTimeout(e,1e3/60)},i=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=function(o){r(function(i){o||(o={});var n=i||+new Date,a=o.duration||500,s=n+a,l=o.onChange||e,c=o.abort||e,d=o.onComplete||e,g=o.easing||t,u="startValue"in o?o.startValue:0,p="endValue"in o?o.endValue:100,h=o.byValue||p-u,f;o.onStart&&o.onStart(),function e(t){f=t||+new Date;var o=f>s?a:f-n,i=g(o,u,h,a),m=Math.abs((i-u)/h);return c()?void d(p,1,1):f>s?(l(p,1,1),void d(p,1,1)):void(l(i,m,o/a),r(e))}(n)})},fabric.util.requestAnimFrame=r,fabric.util.cancelAnimFrame=function(){return i.apply(fabric.window,arguments)}}(),function(){function e(e,t,r){var o="rgba("+parseInt(e[0]+r*(t[0]-e[0]),10)+","+parseInt(e[1]+r*(t[1]-e[1]),10)+","+parseInt(e[2]+r*(t[2]-e[2]),10);return o+=","+(e&&t?parseFloat(e[3]+r*(t[3]-e[3])):1),o+=")",o}fabric.util.animateColor=function(t,r,o,i){var n=new fabric.Color(t).getSource(),a=new fabric.Color(r).getSource();i=i||{},fabric.util.animate(fabric.util.object.extend(i,{duration:o||500,startValue:n,endValue:a,byValue:a,easing:function(t,r,o,n){var a=i.colorEasing?i.colorEasing(t,n):1-Math.cos(t/n*(Math.PI/2));return e(r,o,a)}}))}}(),function(){var n=Math.abs,a=Math.sin,s=Math.cos,l=Math.PI,g=Math.pow,u=Math.sqrt;function e(e,t,r,o){var i=Math.asin;return e<n(t)?(e=t,o=r/4):0===t&&0===e?o=r/(2*l)*i(1):o=r/(2*l)*i(t/e),{a:e,c:t,p:r,s:o}}function r(e,r,o){return e.a*g(2,10*(r-=1))*a((r*o-e.s)*(2*l)/e.p)}function o(e,t,r,o){return r-i(o-e,0,r,o)+t}function i(e,r,o,i){return(e/=i)<1/2.75?o*(7.5625*e*e)+r:e<2/2.75?o*(7.5625*(e-=1.5/2.75)*e+.75)+r:e<2.5/2.75?o*(7.5625*(e-=2.25/2.75)*e+.9375)+r:o*(7.5625*(e-=2.625/2.75)*e+.984375)+r}fabric.util.ease={easeInQuad:function(e,r,o,i){return o*(e/=i)*e+r},easeOutQuad:function(e,r,o,i){return-o*(e/=i)*(e-2)+r},easeInOutQuad:function(e,r,o,i){return e/=i/2,1>e?o/2*e*e+r:-o/2*(--e*(e-2)-1)+r},easeInCubic:function(e,r,o,i){return o*(e/=i)*e*e+r},easeOutCubic:function(e,r,o,i){return o*((e=e/i-1)*e*e+1)+r},easeInOutCubic:function(e,r,o,i){return e/=i/2,1>e?o/2*e*e*e+r:o/2*((e-=2)*e*e+2)+r},easeInQuart:function(e,r,o,i){return o*(e/=i)*e*e*e+r},easeOutQuart:function(e,r,o,i){return-o*((e=e/i-1)*e*e*e-1)+r},easeInOutQuart:function(e,r,o,i){return e/=i/2,1>e?o/2*e*e*e*e+r:-o/2*((e-=2)*e*e*e-2)+r},easeInQuint:function(e,r,o,i){return o*(e/=i)*e*e*e*e+r},easeOutQuint:function(e,r,o,i){return o*((e=e/i-1)*e*e*e*e+1)+r},easeInOutQuint:function(e,r,o,i){return e/=i/2,1>e?o/2*e*e*e*e*e+r:o/2*((e-=2)*e*e*e*e+2)+r},easeInSine:function(e,t,r,o){return-r*s(e/o*(l/2))+r+t},easeOutSine:function(e,t,r,o){return r*a(e/o*(l/2))+t},easeInOutSine:function(e,t,r,o){return-r/2*(s(l*e/o)-1)+t},easeInExpo:function(e,t,r,o){return 0===e?t:r*g(2,10*(e/o-1))+t},easeOutExpo:function(e,t,r,o){return e===o?t+r:r*(-g(2,-10*e/o)+1)+t},easeInOutExpo:function(e,r,o,i){return 0===e?r:e===i?r+o:(e/=i/2,1>e?o/2*g(2,10*(e-1))+r:o/2*(-g(2,-10*--e)+2)+r)},easeInCirc:function(e,r,o,i){return-o*(u(1-(e/=i)*e)-1)+r},easeOutCirc:function(e,r,o,i){return o*u(1-(e=e/i-1)*e)+r},easeInOutCirc:function(e,r,o,i){return e/=i/2,1>e?-o/2*(u(1-e*e)-1)+r:o/2*(u(1-(e-=2)*e)+1)+r},easeInElastic:function(o,i,n,a){var s=0;if(0===o)return i;if(o/=a,1===o)return i+n;s||(s=.3*a);var l=e(n,n,s,1.70158);return-r(l,o,a)+i},easeOutElastic:function(r,o,i,n){var s=0;if(0===r)return o;if(r/=n,1===r)return o+i;s||(s=.3*n);var c=e(i,i,s,1.70158);return c.a*g(2,-10*r)*a((r*n-c.s)*(2*l)/c.p)+c.c+o},easeInOutElastic:function(o,i,n,s){var c=0;if(0===o)return i;if(o/=s/2,2===o)return i+n;c||(c=s*(.3*1.5));var d=e(n,n,c,1.70158);return 1>o?-.5*r(d,o,s)+i:.5*(d.a*g(2,-10*(o-=1))*a((o*s-d.s)*(2*l)/d.p))+d.c+i},easeInBack:function(e,r,o,i,n){return void 0===n&&(n=1.70158),o*(e/=i)*e*((n+1)*e-n)+r},easeOutBack:function(e,r,o,i,n){return void 0===n&&(n=1.70158),o*((e=e/i-1)*e*((n+1)*e+n)+1)+r},easeInOutBack:function(e,r,o,i,n){return void 0===n&&(n=1.70158),e/=i/2,1>e?o/2*(e*e*(((n*=1.525)+1)*e-n))+r:o/2*((e-=2)*e*(((n*=1.525)+1)*e+n)+2)+r},easeInBounce:o,easeOutBounce:i,easeInOutBounce:function(e,t,r,n){return e<n/2?.5*o(2*e,0,r,n)+t:.5*i(2*e-n,0,r,n)+.5*r+t}}}(),function(e){'use strict';function t(e){return e in S?S[e]:e}function r(e,t,r,o){var i="[object Array]"===Object.prototype.toString.call(t),n;if(("fill"===e||"stroke"===e)&&"none"===t)t="";else if("vector-effect"===e)t="non-scaling-stroke"===t;else if("strokeDashArray"===e)t="none"===t?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===e)t=r&&r.transformMatrix?b(r.transformMatrix,_.parseTransformAttribute(t)):_.parseTransformAttribute(t);else if("visible"===e)t="none"!==t&&"hidden"!==t,r&&!1===r.visible&&(t=!1);else if("opacity"===e)t=parseFloat(t),r&&"undefined"!=typeof r.opacity&&(t*=r.opacity);else if("textAnchor"===e)t="start"===t?"left":"end"===t?"right":"center";else if("charSpacing"===e)n=1e3*(C(t,o)/o);else if("paintFirst"===e){var a=t.indexOf("fill"),s=t.indexOf("stroke"),t="fill";-1<a&&-1<s&&s<a?t="stroke":-1===a&&-1<s&&(t="stroke")}else{if("href"===e||"xlink:href"===e)return t;n=i?t.map(C):C(t,o)}return!i&&isNaN(n)?t:n}function o(e){return new RegExp("^("+e.join("|")+")\\b","i")}function i(e){for(var t in T)if("undefined"!=typeof e[T[t]]&&""!==e[t]){if("undefined"==typeof e[t]){if(!_.Object.prototype[t])continue;e[t]=_.Object.prototype[t]}if(0!==e[t].indexOf("url(")){var r=new _.Color(e[t]);e[t]=r.setAlpha(v(r.getAlpha()*e[T[t]],2)).toRgba()}}return e}function n(e,t){var r=[],o,n,a,s;for(a=0,s=t.length;a<s;a++)o=t[a],n=e.getElementsByTagName(o),r=r.concat(Array.prototype.slice.call(n));return r}function a(e,t){var r,o;e.replace(/;\s*$/,"").split(";").forEach(function(e){var i=e.split(":");r=i[0].trim().toLowerCase(),o=i[1].trim(),t[r]=o})}function s(e,t){var r,o;for(var i in e)"undefined"!=typeof e[i]&&(r=i.toLowerCase(),o=e[i],t[r]=o)}function l(e,t){var r={};for(var o in _.cssRules[t])if(c(e,o.split(" ")))for(var i in _.cssRules[t][o])r[i]=_.cssRules[t][o][i];return r}function c(e,t){var r=!0,o;return o=g(e,t.pop()),o&&t.length&&(r=d(e,t)),o&&r&&0===t.length}function d(e,t){for(var r=!0,o;e.parentNode&&1===e.parentNode.nodeType&&t.length;)r&&(o=t.pop()),e=e.parentNode,r=g(e,o);return 0===t.length}function g(e,t){var r=e.nodeName,o=e.getAttribute("class"),n=e.getAttribute("id"),a,s;if(a=new RegExp("^"+r,"i"),t=t.replace(a,""),n&&t.length&&(a=new RegExp("#"+n+"(?![a-zA-Z\\-]+)","i"),t=t.replace(a,"")),o&&t.length)for(o=o.split(" "),s=o.length;s--;)a=new RegExp("\\."+o[s]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(a,"");return 0===t.length}function u(e,t){var r;if(e.getElementById&&(r=e.getElementById(t)),r)return r;var o=e.getElementsByTagName("*"),n,a,s;for(a=0,s=o.length;a<s;a++)if(n=o[a],t===n.getAttribute("id"))return n}function p(e){for(var t=n(e,["use","svg:use"]),r=0;t.length&&r<t.length;){var o=t[r],a=(o.getAttribute("xlink:href")||o.getAttribute("href")).substr(1),s=o.getAttribute("x")||0,l=o.getAttribute("y")||0,c=u(e,a).cloneNode(!0),d=(c.getAttribute("transform")||"")+" translate("+s+", "+l+")",g=t.length,p=_.svgNS,f,m,y,x,v;if(h(c),/^svg$/i.test(c.nodeName)){var C=c.ownerDocument.createElementNS(p,"g");for(y=0,x=c.attributes,v=x.length;y<v;y++)m=x.item(y),C.setAttributeNS(p,m.nodeName,m.nodeValue);for(;c.firstChild;)C.appendChild(c.firstChild);c=C}for(y=0,x=o.attributes,v=x.length;y<v;y++)(m=x.item(y),"x"!==m.nodeName&&"y"!==m.nodeName&&"xlink:href"!==m.nodeName&&"href"!==m.nodeName)&&("transform"===m.nodeName?d=m.nodeValue+" "+d:c.setAttribute(m.nodeName,m.nodeValue));c.setAttribute("transform",d),c.setAttribute("instantiated_by_use","1"),c.removeAttribute("id"),f=o.parentNode,f.replaceChild(c,o),t.length===g&&r++}}function h(e){var t=e.getAttribute("viewBox"),r=1,o=1,i=0,n=0,a=e.getAttribute("width"),s=e.getAttribute("height"),l=e.getAttribute("x")||0,c=e.getAttribute("y")||0,d=e.getAttribute("preserveAspectRatio")||"",g=!t||!_.svgViewBoxElementsRegEx.test(e.nodeName)||!(t=t.match(O)),u=!a||!s||"100%"===a||"100%"===s,p=g&&u,h={},f="",m=0,y=0,x,v,b,S;if(h.width=0,h.height=0,h.toBeParsed=p,p)return h;if(g)return h.width=C(a),h.height=C(s),h;if(i=-parseFloat(t[1]),n=-parseFloat(t[2]),x=parseFloat(t[3]),v=parseFloat(t[4]),h.minX=i,h.minY=n,h.viewBoxWidth=x,h.viewBoxHeight=v,u?(h.width=x,h.height=v):(h.width=C(a),h.height=C(s),r=h.width/x,o=h.height/v),d=_.util.parsePreserveAspectRatioAttribute(d),"none"!==d.alignX&&("meet"===d.meetOrSlice&&(o=r=r>o?o:r),"slice"===d.meetOrSlice&&(o=r=r>o?r:o),m=h.width-x*r,y=h.height-v*r,"Mid"===d.alignX&&(m/=2),"Mid"===d.alignY&&(y/=2),"Min"===d.alignX&&(m=0),"Min"===d.alignY&&(y=0)),1==r&&1===o&&0===i&&0===n&&0===l&&0===c)return h;if((l||c)&&(f=" translate("+C(l)+" "+C(c)+") "),b=f+" matrix("+r+" 0 0 "+o+" "+(i*r+m)+" "+(n*o+y)+") ",h.viewboxTransform=_.parseTransformAttribute(b),"svg"===e.nodeName){for(S=e.ownerDocument.createElementNS(_.svgNS,"g");e.firstChild;)S.appendChild(e.firstChild);e.appendChild(S)}else S=e,b=S.getAttribute("transform")+b;return S.setAttribute("transform",b),h}function f(e,t){for(;e&&(e=e.parentNode);)if(e.nodeName&&t.test(e.nodeName.replace("svg:",""))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}function m(e,t){var r=t.getAttribute("xlink:href").substr(1),o=u(e,r);if(o&&o.getAttribute("xlink:href")&&m(e,o),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(e){o&&!t.hasAttribute(e)&&o.hasAttribute(e)&&t.setAttribute(e,o.getAttribute(e))}),!t.children.length)for(var i=o.cloneNode(!0);i.firstChild;)t.appendChild(i.firstChild);t.removeAttribute("xlink:href")}var _=e.fabric||(e.fabric={}),y=_.util.object.extend,x=_.util.object.clone,v=_.util.toFixed,C=_.util.parseUnit,b=_.util.multiplyTransformMatrices,S={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},T={stroke:"strokeOpacity",fill:"fillOpacity"};_.svgValidTagNamesRegEx=o(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),_.svgViewBoxElementsRegEx=o(["symbol","image","marker","pattern","view","svg"]),_.svgInvalidAncestorsRegEx=o(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),_.svgValidParentsRegEx=o(["symbol","g","a","svg","clipPath","defs"]),_.cssRules={},_.gradientDefs={},_.clipPaths={},_.parseTransformAttribute=function(){function e(e,t){var r=_.util.cos(t[0]),o=_.util.sin(t[0]),i=0,n=0;3===t.length&&(i=t[1],n=t[2]),e[0]=r,e[1]=o,e[2]=-o,e[3]=r,e[4]=i-(r*i-o*n),e[5]=n-(o*i+r*n)}function t(e,t){var r=t[0],o=2===t.length?t[1]:t[0];e[0]=r,e[3]=o}function r(e,t,r){e[r]=Math.tan(_.util.degreesToRadians(t[0]))}function o(e,t){e[4]=t[0],2===t.length&&(e[5]=t[1])}var i=_.iMatrix,n=_.reNum,a="(?:"+("(?:(matrix)\\s*\\(\\s*("+n+")"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+")"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+")"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+")"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+")"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+n+")(?:"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+n+")(?:"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+n+")(?:"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+")"+"(?:\\s+,?\\s*|,\\s*)"+"("+n+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))")+")",s=new RegExp("^\\s*(?:"+("(?:"+a+"(?:"+"(?:\\s+,?\\s*|,\\s*)"+"*"+a+")*)")+"?)\\s*$"),l=new RegExp(a,"g");return function(n){var c=i.concat(),d=[];if(!n||n&&!s.test(n))return c;n.replace(l,function(n){var s=new RegExp(a).exec(n).filter(function(e){return!!e}),l=s[1],g=s.slice(2).map(parseFloat);"translate"===l?o(c,g):"rotate"===l?(g[0]=_.util.degreesToRadians(g[0]),e(c,g)):"scale"===l?t(c,g):"skewX"===l?r(c,g,2):"skewY"===l?r(c,g,1):"matrix"===l?c=g:void 0;d.push(c.concat()),c=i.concat()});for(var g=d[0];1<d.length;)d.shift(),g=_.util.multiplyTransformMatrices(g,d[0]);return g}}();var O=new RegExp("^\\s*("+_.reNum+"+)\\s*,?\\s*("+_.reNum+"+)\\s*,?\\s*("+_.reNum+"+)\\s*,?\\s*("+_.reNum+"+)\\s*$");_.parseSVGDocument=function(e,t,r,o){if(e){p(e);var n=_.Object.__uid++,a=h(e),s=_.util.toArray(e.getElementsByTagName("*")),l,c;if(a.crossOrigin=o&&o.crossOrigin,a.svgUid=n,0===s.length&&_.isLikelyNode){s=e.selectNodes("//*[name(.)!=\"svg\"]");var d=[];for(l=0,c=s.length;l<c;l++)d[l]=s[l];s=d}var g=s.filter(function(e){return h(e),_.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))&&!f(e,_.svgInvalidAncestorsRegEx)});if(!g||g&&!g.length)return void(t&&t([],{}));var u={};s.filter(function(e){return"clipPath"===e.nodeName.replace("svg:","")}).forEach(function(e){var t=e.getAttribute("id");u[t]=_.util.toArray(e.getElementsByTagName("*")).filter(function(e){return _.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))})}),_.gradientDefs[n]=_.getGradientDefs(e),_.cssRules[n]=_.getCSSRules(e),_.clipPaths[n]=u,_.parseElements(g,function(e,r){t&&(t(e,a,r,s),delete _.gradientDefs[n],delete _.cssRules[n],delete _.clipPaths[n])},x(a),r,o)}};var w=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+_.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+_.reNum+"))?\\s+(.*)");y(_,{parseFontDeclaration:function(e,t){var r=e.match(w);if(r){var o=r[1],i=r[3],n=r[4],a=r[5],s=r[6];o&&(t.fontStyle=o),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),n&&(t.fontSize=C(n)),s&&(t.fontFamily=s),a&&(t.lineHeight="normal"===a?1:a)}},getGradientDefs:function(e){var t=n(e,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),r=0,o={},i;for(r=t.length;r--;)i=t[r],i.getAttribute("xlink:href")&&m(e,i),o[i.getAttribute("id")]=i;return o},parseAttributes:function(e,o,n){if(e){var a={},s,c,d;"undefined"==typeof n&&(n=e.getAttribute("svgUid")),e.parentNode&&_.svgValidParentsRegEx.test(e.parentNode.nodeName)&&(a=_.parseAttributes(e.parentNode,o,n));var g=o.reduce(function(t,r){return s=e.getAttribute(r),s&&(t[r]=s),t},{}),u=y(l(e,n),_.parseStyleAttribute(e));g=y(g,u),u["clip-path"]&&e.setAttribute("clip-path",u["clip-path"]),c=d=a.fontSize||_.Text.DEFAULT_SVG_FONT_SIZE,g["font-size"]&&(g["font-size"]=c=C(g["font-size"],d));var p={},h,f;for(var m in g)h=t(m),f=r(h,g[m],a,c),p[h]=f;p.font&&_.parseFontDeclaration(p.font,p);var x=y(a,p);return _.svgValidParentsRegEx.test(e.nodeName)?x:i(x)}},parseElements:function(e,t,r,o,i){new _.ElementsParser(e,t,r,o,i).parse()},parseStyleAttribute:function(e){var t={},r=e.getAttribute("style");return r?("string"==typeof r?a(r,t):s(r,t),t):t},parsePointsAttribute:function(e){if(!e)return null;e=e.replace(/,/g," ").trim(),e=e.split(/\s+/);var t=[],r,o;for(r=0,o=e.length;r<o;r+=2)t.push({x:parseFloat(e[r]),y:parseFloat(e[r+1])});return t},getCSSRules:function(e){var t=e.getElementsByTagName("style"),r={},o,n,a;for(o=0,n=t.length;o<n;o++){var s=t[o].textContent||"";(s=s.replace(/\/\*[\s\S]*?\*\//g,""),""!==s.trim())&&(a=s.match(/[^{]*\{[\s\S]*?\}/g),a=a.map(function(e){return e.trim()}),a.forEach(function(e){var t=e.match(/([\s\S]*?)\s*\{([^}]*)\}/),i={},a=t[2].trim(),s=a.replace(/;$/,"").split(/\s*;\s*/);for(o=0,n=s.length;o<n;o++){var l=s[o].split(/\s*:\s*/),c=l[0],d=l[1];i[c]=d}e=t[1],e.split(",").forEach(function(e){e=e.replace(/^svg/i,"").trim(),""===e||(r[e]?_.util.object.extend(r[e],i):r[e]=_.util.object.clone(i))})}))}return r},loadSVGFromURL:function(e,t,o,i){e=e.replace(/^\n\s*/,"").trim(),new _.util.request(e,{method:"get",onComplete:function(e){var r=e.responseXML;return r&&!r.documentElement&&_.window.ActiveXObject&&e.responseText&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),r&&r.documentElement?void _.parseSVGDocument(r.documentElement,function(e,r,o,i){t&&t(e,r,o,i)},o,i):(t&&t(null),!1)}})},loadSVGFromString:function(e,t,r,o){e=e.trim();var i;if("undefined"!=typeof _.window.DOMParser){var n=new _.window.DOMParser;n&&n.parseFromString&&(i=n.parseFromString(e,"text/xml"))}else _.window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));_.parseSVGDocument(i.documentElement,function(e,r,o,i){t(e,r,o,i)},r,o)}})}("undefined"==typeof exports?this:exports),fabric.ElementsParser=function(e,t,r,o,i,n){this.elements=e,this.callback=t,this.options=r,this.reviver=o,this.svgUid=r&&r.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n},function(e){e.parse=function(){this.instances=Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},e.createObjects=function(){var e=this;this.elements.forEach(function(t,r){t.setAttribute("svgUid",e.svgUid),e.createObject(t,r)})},e.findTag=function(e){return fabric[fabric.util.string.capitalize(e.tagName.replace("svg:",""))]},e.createObject=function(e,t){var r=this.findTag(e);if(r&&r.fromElement)try{r.fromElement(e,this.createCallback(t,e),this.options)}catch(e){fabric.log(e)}else this.checkIfDone()},e.createCallback=function(e,t){var r=this;return function(o){var i;r.resolveGradient(o,t,"fill"),r.resolveGradient(o,t,"stroke"),o instanceof fabric.Image&&o._originalElement&&(i=o.parsePreserveAspectRatioAttribute(t)),o._removeTransformMatrix(i),r.resolveClipPath(o,t),r.reviver&&r.reviver(t,o),r.instances[e]=o,r.checkIfDone()}},e.extractPropertyDefinition=function(e,t,r){var o=e[t],i=this.regexUrl;if(i.test(o)){i.lastIndex=0;var n=i.exec(o)[1];return i.lastIndex=0,fabric[r][this.svgUid][n]}},e.resolveGradient=function(e,t,r){var o=this.extractPropertyDefinition(e,r,"gradientDefs");if(o){var i=t.getAttribute(r+"-opacity"),n=fabric.Gradient.fromElement(o,e,i,this.options);e.set(r,n)}},e.createClipPathCallback=function(e,t){return function(e){e._removeTransformMatrix(),e.fillRule=e.clipRule,t.push(e)}},e.resolveClipPath=function(e,t){var r=this.extractPropertyDefinition(e,"clipPath","clipPaths"),o,n,a,s,l,c;if(r){s=[],a=fabric.util.invertTransform(e.calcTransformMatrix());for(var d=r[0].parentNode,g=t;g.parentNode&&g.getAttribute("clip-path")!==e.clipPath;)g=g.parentNode;g.parentNode.appendChild(d);for(var u=0;u<r.length;u++)o=r[u],n=this.findTag(o),n.fromElement(o,this.createClipPathCallback(e,s),this.options);r=1===s.length?s[0]:new fabric.Group(s),l=fabric.util.multiplyTransformMatrices(a,r.calcTransformMatrix()),r.clipPath&&this.resolveClipPath(r,g);var c=fabric.util.qrDecompose(l);r.flipX=!1,r.flipY=!1,r.set("scaleX",c.scaleX),r.set("scaleY",c.scaleY),r.angle=c.angle,r.skewX=c.skewX,r.skewY=0,r.setPositionByOrigin({x:c.translateX,y:c.translateY},"center","center"),e.clipPath=r}else delete e.clipPath},e.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),this.callback(this.instances,this.elements))}}(fabric.ElementsParser.prototype),function(e){'use strict';var o=Math.max,i=Math.min;function r(e,t){this.x=e,this.y=t}var n=e.fabric||(e.fabric={});return n.Point?void n.warn("fabric.Point is already defined"):void(n.Point=r,r.prototype={type:"point",constructor:r,add:function(e){return new r(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new r(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new r(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new r(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new r(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new r(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,n){return"undefined"==typeof n&&(n=.5),n=o(i(1,n),0),new r(this.x+(e.x-this.x)*n,this.y+(e.y-this.y)*n)},distanceFrom:function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new r(i(this.x,e.x),i(this.y,e.y))},max:function(e){return new r(o(this.x,e.x),o(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,r=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=r},clone:function(){return new r(this.x,this.y)}})}("undefined"==typeof exports?this:exports),function(e){'use strict';function t(e){this.status=e,this.points=[]}var r=e.fabric||(e.fabric={});return r.Intersection?void r.warn("fabric.Intersection is already defined"):void(r.Intersection=t,r.Intersection.prototype={constructor:t,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},r.Intersection.intersectLineLine=function(e,o,i,n){var a=(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x),s=(o.x-e.x)*(e.y-i.y)-(o.y-e.y)*(e.x-i.x),l=(n.y-i.y)*(o.x-e.x)-(n.x-i.x)*(o.y-e.y),c;if(0!=l){var d=a/l,g=s/l;0<=d&&1>=d&&0<=g&&1>=g?(c=new t("Intersection"),c.appendPoint(new r.Point(e.x+d*(o.x-e.x),e.y+d*(o.y-e.y)))):c=new t}else c=0===a||0===s?new t("Coincident"):new t("Parallel");return c},r.Intersection.intersectLinePolygon=function(e,r,o){var n=new t,a=o.length,s,l,c,d;for(d=0;d<a;d++)s=o[d],l=o[(d+1)%a],c=t.intersectLineLine(e,r,s,l),n.appendPoints(c.points);return 0<n.points.length&&(n.status="Intersection"),n},r.Intersection.intersectPolygonPolygon=function(e,r){var o=new t,n=e.length,a;for(a=0;a<n;a++){var s=e[a],l=e[(a+1)%n],c=t.intersectLinePolygon(s,l,r);o.appendPoints(c.points)}return 0<o.points.length&&(o.status="Intersection"),o},r.Intersection.intersectPolygonRectangle=function(e,o,i){var n=o.min(i),a=o.max(i),s=new r.Point(a.x,n.y),l=new r.Point(n.x,a.y),c=t.intersectLinePolygon(n,s,e),d=t.intersectLinePolygon(s,a,e),g=t.intersectLinePolygon(a,l,e),u=t.intersectLinePolygon(l,n,e),p=new t;return p.appendPoints(c.points),p.appendPoints(d.points),p.appendPoints(g.points),p.appendPoints(u.points),0<p.points.length&&(p.status="Intersection"),p})}("undefined"==typeof exports?this:exports),function(e){'use strict';var o=Math.round;function t(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function r(e,r,o){return 0>o&&(o+=1),1<o&&(o-=1),o<1/6?e+6*(r-e)*o:o<1/2?r:o<2/3?e+6*((r-e)*(2/3-o)):e}var i=e.fabric||(e.fabric={});return i.Color?void i.warn("fabric.Color is already defined."):void(i.Color=t,i.Color.prototype={_tryParsingColor:function(e){var r;e in t.colorNameMap&&(e=t.colorNameMap[e]),"transparent"===e&&(r=[255,255,255,0]),r||(r=t.sourceFromHex(e)),r||(r=t.sourceFromRgb(e)),r||(r=t.sourceFromHsl(e)),r||(r=[0,0,0,1]),r&&this.setSource(r)},_rgbToHsl:function(e,t,n){e/=255,t/=255,n/=255;var a=i.util.array.max([e,t,n]),c=i.util.array.min([e,t,n]),u,p,f;if(f=(a+c)/2,a===c)u=p=0;else{var m=a-c;p=.5<f?m/(2-a-c):m/(a+c),a===e?u=(t-n)/m+(t<n?6:0):a===t?u=(n-e)/m+2:a===n?u=(e-t)/m+4:void 0,u/=6}return[o(360*u),o(100*p),o(100*f)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e=this.getSource(),t,o,i;return t=e[0].toString(16),t=1===t.length?"0"+t:t,o=e[1].toString(16),o=1===o.length?"0"+o:o,i=e[2].toString(16),i=1===i.length?"0"+i:i,t.toUpperCase()+o.toUpperCase()+i.toUpperCase()},toHexa:function(){var e=this.getSource(),t;return t=o(255*e[3]),t=t.toString(16),t=1===t.length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10),r=e[3];return this.setSource([t,t,t,r]),this},toBlackWhite:function(e){var t=this.getSource(),r=(.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),o=t[3];return e=e||127,r=+r<+e?0:255,this.setSource([r,r,r,o]),this},overlayWith:function(e){e instanceof t||(e=new t(e));var r=[],n=this.getAlpha(),a=.5,s=this.getSource(),l=e.getSource(),c;for(c=0;3>c;c++)r.push(o(s[c]*(1-a)+l[c]*a));return r[3]=n,this.setSource(r),this}},i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,i.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,i.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},i.Color.fromRgb=function(e){return t.fromSource(t.sourceFromRgb(e))},i.Color.sourceFromRgb=function(e){var o=e.match(t.reRGBa);if(o){var i=parseInt(o[1],10)/(/%$/.test(o[1])?100:1)*(/%$/.test(o[1])?255:1),r=parseInt(o[2],10)/(/%$/.test(o[2])?100:1)*(/%$/.test(o[2])?255:1),n=parseInt(o[3],10)/(/%$/.test(o[3])?100:1)*(/%$/.test(o[3])?255:1);return[parseInt(i,10),parseInt(r,10),parseInt(n,10),o[4]?parseFloat(o[4]):1]}},i.Color.fromRgba=t.fromRgb,i.Color.fromHsl=function(e){return t.fromSource(t.sourceFromHsl(e))},i.Color.sourceFromHsl=function(e){var i=e.match(t.reHSLa);if(i){var n=(parseFloat(i[1])%360+360)%360/360,a=parseFloat(i[2])/(/%$/.test(i[2])?100:1),s=parseFloat(i[3])/(/%$/.test(i[3])?100:1),l,c,d;if(0==a)l=c=d=s;else{var u=.5>=s?s*(a+1):s+a-s*a,h=2*s-u;l=r(h,u,n+1/3),c=r(h,u,n),d=r(h,u,n-1/3)}return[o(255*l),o(255*c),o(255*d),i[4]?parseFloat(i[4]):1]}},i.Color.fromHsla=t.fromHsl,i.Color.fromHex=function(e){return t.fromSource(t.sourceFromHex(e))},i.Color.sourceFromHex=function(e){if(e.match(t.reHex)){var o=e.slice(e.indexOf("#")+1),i=3===o.length||4===o.length,n=8===o.length||4===o.length,s=i?o.charAt(0)+o.charAt(0):o.substring(0,2),r=i?o.charAt(1)+o.charAt(1):o.substring(2,4),l=i?o.charAt(2)+o.charAt(2):o.substring(4,6),c=n?i?o.charAt(3)+o.charAt(3):o.substring(6,8):"FF";return[parseInt(s,16),parseInt(r,16),parseInt(l,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},i.Color.fromSource=function(e){var r=new t;return r.setSource(e),r})}("undefined"==typeof exports?this:exports),function(){var n=Math.max,a=Math.min;function e(e,t){var r=e.getAttribute("style"),o=e.getAttribute("offset")||0,n,a,s,l;if(o=parseFloat(o)/(/%$/.test(o)?100:1),o=0>o?0:1<o?1:o,r){var c=r.split(/\s*;\s*/);for(""===c[c.length-1]&&c.pop(),l=c.length;l--;){var d=c[l].split(/\s*:\s*/),g=d[0].trim(),u=d[1].trim();"stop-color"===g?n=u:"stop-opacity"===g&&(s=u)}}return n||(n=e.getAttribute("stop-color")||"rgb(0,0,0)"),s||(s=e.getAttribute("stop-opacity")),n=new fabric.Color(n),a=n.getAlpha(),s=isNaN(parseFloat(s))?1:parseFloat(s),s*=a*t,{offset:o,color:n.toRgb(),opacity:s}}function t(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}function r(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}function o(e,t,r,o){var i,n;Object.keys(t).forEach(function(e){i=t[e],"Infinity"===i?n=1:"-Infinity"===i?n=0:(n=parseFloat(t[e],10),"string"==typeof i&&/^(\d+\.\d+)%|(\d+)%$/.test(i)&&(n*=.01,"pixels"===o&&(("x1"===e||"x2"===e||"r2"===e)&&(n*=r.viewBoxWidth||r.width),("y1"===e||"y2"===e)&&(n*=r.viewBoxHeight||r.height)))),t[e]=n})}var s=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(e){e||(e={}),e.coords||(e.coords={});var t=this,r;Object.keys(e).forEach(function(r){t[r]=e[r]}),this.id?this.id+="_"+fabric.Object.__uid++:this.id=fabric.Object.__uid++,r={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},"radial"===this.type&&(r.r1=e.coords.r1||0,r.r2=e.coords.r2||0),this.coords=r,this.colorStops=e.colorStops.slice()},addColorStop:function(e){for(var t in e){var r=new fabric.Color(e[t]);this.colorStops.push({offset:parseFloat(t),color:r.toRgb(),opacity:r.getAlpha()})}return this},toObject:function(e){var t={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,t,e),t},toSVG:function(e,t){var r=s(this.coords,!0),t=t||{},o=s(this.colorStops,!0),l=r.r1>r.r2,c=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),d=-this.offsetX,g=-this.offsetY,u=!!t.additionalTransform,p="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",h,f,m,_;if(o.sort(function(e,t){return e.offset-t.offset}),"objectBoundingBox"==p?(d/=e.width,g/=e.height):(d+=e.width/2,g+=e.height/2),"path"===e.type&&(d-=e.pathOffset.x,g-=e.pathOffset.y),c[4]-=d,c[5]-=g,_="id=\"SVGID_"+this.id+"\" gradientUnits=\""+p+"\"",_+=" gradientTransform=\""+(u?t.additionalTransform+" ":"")+fabric.util.matrixToSVG(c)+"\" ","linear"===this.type?m=["<linearGradient ",_," x1=\"",r.x1,"\" y1=\"",r.y1,"\" x2=\"",r.x2,"\" y2=\"",r.y2,"\">\n"]:"radial"===this.type&&(m=["<radialGradient ",_," cx=\"",l?r.x1:r.x2,"\" cy=\"",l?r.y1:r.y2,"\" r=\"",l?r.r1:r.r2,"\" fx=\"",l?r.x2:r.x1,"\" fy=\"",l?r.y2:r.y1,"\">\n"]),"radial"===this.type){if(l)for(o=o.concat(),o.reverse(),(h=0,f=o.length);h<f;h++)o[h].offset=1-o[h].offset;var y=a(r.r1,r.r2);if(0<y){var x=n(r.r1,r.r2);for(h=0,f=o.length;h<f;h++)o[h].offset+=y/x*(1-o[h].offset)}}for(h=0,f=o.length;h<f;h++){var v=o[h];m.push("<stop ","offset=\"",100*v.offset+"%","\" style=\"stop-color:",v.color,"undefined"==typeof v.opacity?";":";stop-opacity: "+v.opacity,"\"/>\n")}return m.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),m.join("")},toLive:function(e,t){var r=fabric.util.object.clone(this.coords),o=r.x1,n=r.y1,a=r.x2,s=r.y2,l=this.colorStops,c,d,g;if(this.type){for(t instanceof fabric.Text&&"percentage"===this.gradientUnits&&(o*=t.width,n*=t.height,a*=t.width,s*=t.height),"linear"===this.type?c=e.createLinearGradient(o,n,a,s):"radial"===this.type&&(c=e.createRadialGradient(o,n,r.r1,a,s,r.r2)),(d=0,g=l.length);d<g;d++){var u=l[d].color,p=l[d].opacity,h=l[d].offset;"undefined"!=typeof p&&(u=new fabric.Color(u).setAlpha(p).toRgba()),c.addColorStop(h,u)}return c}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(n,a,s,l){var c=parseFloat(s)/(/%$/.test(s)?100:1);c=0>c?0:1<c?1:c,isNaN(c)&&(c=1);var d=n.getElementsByTagName("stop"),g="userSpaceOnUse"===n.getAttribute("gradientUnits")?"pixels":"percentage",u=n.getAttribute("gradientTransform")||"",p=[],h=0,f=0,m,_,y,x;for("linearGradient"===n.nodeName||"LINEARGRADIENT"===n.nodeName?(m="linear",_=t(n)):(m="radial",_=r(n)),y=d.length;y--;)p.push(e(d[y],c));x=fabric.parseTransformAttribute(u),o(a,_,l,g),"pixels"==g&&(h=-a.left,f=-a.top);var v=new fabric.Gradient({id:n.getAttribute("id"),type:m,coords:_,colorStops:p,gradientUnits:g,gradientTransform:x,offsetX:h,offsetY:f});return v},forObject:function(e,t){return t||(t={}),o(e,t.coords,t.gradientUnits,{viewBoxWidth:100,viewBoxHeight:100}),new fabric.Gradient(t)}})}(),function(){'use strict';var e=Math.abs,t=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,t){if(e||(e={}),this.id=fabric.Object.__uid++,this.setOptions(e),!e.source||e.source&&"string"!=typeof e.source)return void(t&&t(this));if("undefined"!=typeof fabric.util.getFunctionBody(e.source))this.source=new Function(fabric.util.getFunctionBody(e.source)),t&&t(this);else{var r=this;this.source=fabric.util.createImage(),fabric.util.loadImage(e.source,function(e){r.source=e,t&&t(r)},null,this.crossOrigin)}},toObject:function(e){var r=fabric.Object.NUM_FRACTION_DIGITS,o,i;return"function"==typeof this.source?o=this.source+"":"string"==typeof this.source.src?o=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(o=this.source.toDataURL()),i={type:"pattern",source:o,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:t(this.offsetX,r),offsetY:t(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},fabric.util.populateWithProperties(this,i,e),i},toSVG:function(t){var r="function"==typeof this.source?this.source():this.source,o=r.width/t.width,i=r.height/t.height,n=this.offsetX/t.width,a=this.offsetY/t.height,s="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(i=1,a&&(i+=e(a))),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(o=1,n&&(o+=e(n))),r.src?s=r.src:r.toDataURL&&(s=r.toDataURL()),"<pattern id=\"SVGID_"+this.id+"\" x=\""+n+"\" y=\""+a+"\" width=\""+o+"\" height=\""+i+"\">\n<image x=\"0\" y=\"0\" width=\""+r.width+"\" height=\""+r.height+"\" xlink:href=\""+s+"\"></image>\n</pattern>\n"},setOptions:function(e){for(var t in e)this[t]=e[t]},toLive:function(e){var t="function"==typeof this.source?this.source():this.source;if(!t)return"";if("undefined"!=typeof t.src){if(!t.complete)return"";if(0===t.naturalWidth||0===t.naturalHeight)return""}return e.createPattern(t,this.repeat)}})}(),function(e){'use strict';var t=Math.abs,r=e.fabric||(e.fabric={}),o=r.util.toFixed;return r.Shadow?void r.warn("fabric.Shadow is already defined."):void(r.Shadow=r.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(e){for(var t in"string"==typeof e&&(e=this._parseShadow(e)),e)this[t]=e[t];this.id=r.Object.__uid++},_parseShadow:function(e){var t=e.trim(),o=r.Shadow.reOffsetsAndBlur.exec(t)||[],i=t.replace(r.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseInt(o[1],10)||0,offsetY:parseInt(o[2],10)||0,blur:parseInt(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var i=40,n=40,a=r.Object.NUM_FRACTION_DIGITS,s=r.util.rotateVector({x:this.offsetX,y:this.offsetY},r.util.degreesToRadians(-e.angle)),l=new r.Color(this.color);return e.width&&e.height&&(i=100*o((t(s.x)+this.blur)/e.width,a)+20,n=100*o((t(s.y)+this.blur)/e.height,a)+20),e.flipX&&(s.x*=-1),e.flipY&&(s.y*=-1),"<filter id=\"SVGID_"+this.id+"\" y=\"-"+n+"%\" height=\""+(100+2*n)+"%\" x=\"-"+i+"%\" width=\""+(100+2*i)+"%\" >\n\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\""+o(this.blur?this.blur/2:0,a)+"\"></feGaussianBlur>\n\t<feOffset dx=\""+o(s.x,a)+"\" dy=\""+o(s.y,a)+"\" result=\"oBlur\" ></feOffset>\n\t<feFlood flood-color=\""+l.toRgb()+"\" flood-opacity=\""+l.getAlpha()+"\"/>\n\t<feComposite in2=\"oBlur\" operator=\"in\" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\n\t</feMerge>\n</filter>\n"},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var e={},t=r.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(r){this[r]!==t[r]&&(e[r]=this[r])},this),e}}),r.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"==typeof exports?this:exports),function(){'use strict';if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var e=fabric.util.object.extend,t=fabric.util.getElementOffset,r=fabric.util.removeFromArray,o=fabric.util.toFixed,i=fabric.util.transformPoint,n=fabric.util.invertTransform,a=fabric.util.getNodeCanvas,s=fabric.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(e,t){var r=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,r),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,r),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,r),t.overlayColor&&this.setOverlayColor(t.overlayColor,r),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var e=fabric.devicePixelRatio;this.__initRetinaScaling(e,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(e,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(e,t,r){t.setAttribute("width",this.width*e),t.setAttribute("height",this.height*e),r.scale(e,e)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,r){return this.__setBgOverlayImage("overlayImage",e,t,r)},setBackgroundImage:function(e,t,r){return this.__setBgOverlayImage("backgroundImage",e,t,r)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,r,o){return"string"==typeof t?fabric.util.loadImage(t,function(t){if(t){var i=new fabric.Image(t,o);this[e]=i,i.canvas=this}r&&r(t)},this,o&&o.crossOrigin):(o&&t.setOptions(o),this[e]=t,t&&(t.canvas=this),r&&r(t)),this},__setBgOverlayColor:function(e,t,r){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,r),this},_createCanvasElement:function(){var e=s();if(!e)throw l;if(e.style||(e.style={}),"undefined"==typeof e.getContext)throw l;return e},_initOptions:function(e){var t=this.lowerCanvasEl;this._setOptions(e),this.width=this.width||parseInt(t.width,10)||0,this.height=this.height||parseInt(t.height,10)||0;this.lowerCanvasEl.style&&(t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){this.lowerCanvasEl=e&&e.getContext?e:fabric.util.getById(e)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var r;for(var o in t=t||{},e)r=e[o],t.cssOnly||(this._setBackstoreDimension(o,e[o]),r+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(o,r);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t=this._activeObject,r,o,n;for(this.viewportTransform=e,o=0,n=this._objects.length;o<n;o++)r=this._objects[o],r.group||r.setCoords(!1,!0);return t&&"activeSelection"===t.type&&t.setCoords(!1,!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var r=e,o=this.viewportTransform.slice(0);e=i(e,n(this.viewportTransform)),o[0]=t,o[3]=t;var a=i(e,o);return o[4]+=r.x-a.x,o[5]+=r.y-a.y,this.setViewportTransform(o)},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,r=this.height,o=n(this.viewportTransform);return e.tl=i({x:0,y:0},o),e.br=i({x:t,y:r},o),e.tr=new fabric.Point(e.br.x,e.tl.y),e.bl=new fabric.Point(e.tl.x,e.br.y),this.vptCoords=e,e},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(e,t){var r=this.viewportTransform,o=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(e),this.fire("before:render",{ctx:e}),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),e.save(),e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.clipTo&&e.restore(),o&&(o.canvas=this,o.shouldCache(),o._transformDone=!0,o.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e)),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render",{ctx:e})},drawClipPathOnCanvas:function(e){var t=this.viewportTransform,r=this.clipPath;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.globalCompositeOperation="destination-in",r.transform(e),e.scale(1/r.zoomX,1/r.zoomY),e.drawImage(r._cacheCanvas,-r.cacheTranslationX,-r.cacheTranslationY),e.restore()},_renderObjects:function(e,t){var r,o;for(r=0,o=t.length;r<o;++r)t[r]&&t[r].render(e)},_renderBackgroundOrOverlay:function(e,t){var r=this[t+"Color"],o=this[t+"Image"],i=this.viewportTransform,n=this[t+"Vpt"];if(r||o){if(r){e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=r.toLive?r.toLive(e,this):r,n&&e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.transform(1,0,0,1,r.offsetX||0,r.offsetY||0);var a=r.gradientTransform||r.patternTransform;a&&e.transform(a[0],a[1],a[2],a[3],a[4],a[5]),e.fill(),e.restore()}o&&(e.save(),n&&e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),o.render(e),e.restore())}},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top))},centerObject:function(e){var t=this.getCenter();return this._centerObject(e,new fabric.Point(t.left,t.top))},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenter(),t=n(this.viewportTransform);return i({x:e.left,y:e.top},t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,r){var o=this.clipPath,i={version:fabric.version,objects:this._toObjects(t,r)};return o&&(i.clipPath=this._toObject(this.clipPath,t,r)),e(i,this.__serializeBgOverlay(t,r)),fabric.util.populateWithProperties(this,i,r),i},_toObjects:function(e,t){return this._objects.filter(function(e){return!e.excludeFromExport}).map(function(r){return this._toObject(r,e,t)},this)},_toObject:function(e,t,r){var o;this.includeDefaultValues||(o=e.includeDefaultValues,e.includeDefaultValues=!1);var i=e[t](r);return this.includeDefaultValues||(e.includeDefaultValues=o),i},__serializeBgOverlay:function(e,t){var r={},o=this.backgroundImage,i=this.overlayImage;return this.backgroundColor&&(r.background=this.backgroundColor.toObject?this.backgroundColor.toObject(t):this.backgroundColor),this.overlayColor&&(r.overlay=this.overlayColor.toObject?this.overlayColor.toObject(t):this.overlayColor),o&&!o.excludeFromExport&&(r.backgroundImage=this._toObject(o,e,t)),i&&!i.excludeFromExport&&(r.overlayImage=this._toObject(i,e,t)),r},svgViewportTransformation:!0,toSVG:function(e,t){e||(e={}),e.reviver=t;var r=[];return this._setSVGPreamble(r,e),this._setSVGHeader(r,e),this.clipPath&&r.push("<g clip-path=\"url(#"+this.clipPath.clipPathId+")\" >\n"),this._setSVGBgOverlayColor(r,"background"),this._setSVGBgOverlayImage(r,"backgroundImage",t),this._setSVGObjects(r,t),this.clipPath&&r.push("</g>\n"),this._setSVGBgOverlayColor(r,"overlay"),this._setSVGBgOverlayImage(r,"overlayImage",t),r.push("</svg>"),r.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push("<?xml version=\"1.0\" encoding=\"",t.encoding||"UTF-8","\" standalone=\"no\" ?>\n","<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ","\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n")},_setSVGHeader:function(e,t){var r=t.width||this.width,i=t.height||this.height,n="viewBox=\"0 0 "+this.width+" "+this.height+"\" ",a=fabric.Object.NUM_FRACTION_DIGITS,s;t.viewBox?n="viewBox=\""+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+"\" ":this.svgViewportTransformation&&(s=this.viewportTransform,n="viewBox=\""+o(-s[4]/s[0],a)+" "+o(-s[5]/s[3],a)+" "+o(this.width/s[0],a)+" "+o(this.height/s[3],a)+"\" "),e.push("<svg ","xmlns=\"http://www.w3.org/2000/svg\" ","xmlns:xlink=\"http://www.w3.org/1999/xlink\" ","version=\"1.1\" ","width=\"",r,"\" ","height=\"",i,"\" ",n,"xml:space=\"preserve\">\n","<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"</defs>\n")},createSVGClipPathMarkup:function(e){var t=this.clipPath;return t?(t.clipPathId="CLIPPATH_"+fabric.Object.__uid++,"<clipPath id=\""+t.clipPathId+"\" >\n"+this.clipPath.toClipPathSVG(e.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var e=this,t=["background","overlay"].map(function(t){var r=e[t+"Color"];if(r&&r.toLive){var o=e[t+"Vpt"],i=e.viewportTransform,n={width:e.width/(o?i[0]:1),height:e.height/(o?i[3]:1)};return r.toSVG(n,{additionalTransform:o?fabric.util.matrixToSVG(i):""})}});return t.join("")},createSVGFontFacesMarkup:function(){var e="",t={},r=fabric.fontPaths,o=[],n,a,s,l,c,d,g,u,p;for(this._objects.forEach(function e(t){o.push(t),t._objects&&t._objects.forEach(e)}),u=0,p=o.length;u<p;u++)if((n=o[u],a=n.fontFamily,-1!==n.type.indexOf("text")&&!t[a]&&r[a])&&(t[a]=!0,!!n.styles))for(c in s=n.styles,s)for(g in l=s[c],l)d=l[g],a=d.fontFamily,!t[a]&&r[a]&&(t[a]=!0);for(var h in t)e+=["\t\t@font-face {\n","\t\t\tfont-family: '",h,"';\n","\t\t\tsrc: url('",r[h],"');\n","\t\t}\n"].join("");return e&&(e=["\t<style type=\"text/css\">","<![CDATA[\n",e,"]]>","</style>\n"].join("")),e},_setSVGObjects:function(e,t){var r=this._objects,o,n,a;for(n=0,a=r.length;n<a;n++)(o=r[n],!o.excludeFromExport)&&this._setSVGObject(e,o,t)},_setSVGObject:function(e,t,r){e.push(t.toSVG(r))},_setSVGBgOverlayImage:function(e,t,r){this[t]&&!this[t].excludeFromExport&&this[t].toSVG&&e.push(this[t].toSVG(r))},_setSVGBgOverlayColor:function(e,t){var r=this[t+"Color"],o=this.viewportTransform,i=this.width,n=this.height;if(r)if(r.toLive){var a=r.repeat,s=fabric.util.invertTransform(o),l=this[t+"Vpt"],c=l?fabric.util.matrixToSVG(s):"";e.push("<rect transform=\""+c+" translate(",i/2,",",n/2,")\""," x=\"",r.offsetX-i/2,"\" y=\"",r.offsetY-n/2,"\" ","width=\"","repeat-y"===a||"no-repeat"===a?r.source.width:i,"\" height=\"","repeat-x"===a||"no-repeat"===a?r.source.height:n,"\" fill=\"url(#SVGID_"+r.id+")\"","></rect>\n")}else e.push("<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ","fill=\"",r,"\"","></rect>\n")},sendToBack:function(e){if(!e)return this;var t=this._activeObject,o,n,a;if(e===t&&"activeSelection"===e.type)for(a=t._objects,o=a.length;o--;)n=a[o],r(this._objects,n),this._objects.unshift(n);else r(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t=this._activeObject,o,n,a;if(e===t&&"activeSelection"===e.type)for(a=t._objects,o=0;o<a.length;o++)n=a[o],r(this._objects,n),this._objects.push(n);else r(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var o=this._activeObject,n=0,a,s,l,c,d;if(e===o&&"activeSelection"===e.type)for(d=o._objects,a=0;a<d.length;a++)s=d[a],l=this._objects.indexOf(s),l>0+n&&(c=l-1,r(this._objects,s),this._objects.splice(c,0,s)),n++;else l=this._objects.indexOf(e),0!==l&&(c=this._findNewLowerIndex(e,l,t),r(this._objects,e),this._objects.splice(c,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,r){var o,n;if(r)for(o=t,n=t-1;0<=n;--n){var a=e.intersectsWithObject(this._objects[n])||e.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(e);if(a){o=n;break}}else o=t-1;return o},bringForward:function(e,t){if(!e)return this;var o=this._activeObject,n=0,a,s,l,c,d;if(e===o&&"activeSelection"===e.type)for(d=o._objects,a=d.length;a--;)s=d[a],l=this._objects.indexOf(s),l<this._objects.length-1-n&&(c=l+1,r(this._objects,s),this._objects.splice(c,0,s)),n++;else l=this._objects.indexOf(e),l!==this._objects.length-1&&(c=this._findNewUpperIndex(e,l,t),r(this._objects,e),this._objects.splice(c,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,r){var o,n,a;if(r)for(o=t,n=t+1,a=this._objects.length;n<a;++n){var s=e.intersectsWithObject(this._objects[n])||e.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(e);if(s){o=n;break}}else o=t+1;return o},moveTo:function(e,t){return r(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(e){e.dispose&&e.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:"{\"objects\": [], \"background\": \"white\"}",supports:function(e){var t=s();if(!t||!t.getContext)return null;var r=t.getContext("2d");if(!r)return null;return"setLineDash"===e?"undefined"!=typeof r.setLineDash:null}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var e=a(this.lowerCanvasEl);return e&&e.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){var t=a(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(e){return this.shadow=new fabric.Shadow(e),this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,fabric.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas,t=this.shadow,r=e.contextTop,o=e.getZoom();e&&e._isRetinaScaling()&&(o*=fabric.devicePixelRatio),r.shadowColor=t.color,r.shadowBlur=t.blur*o,r.shadowOffsetX=t.offsetX*o,r.shadowOffsetY=t.offsetY*o}},needsFullRender:function(){var e=new fabric.Color(this.color);return 1>e.getAlpha()||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}}),function(){var e=Math.pow;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:.4,initialize:function(e){this.canvas=e,this._points=[]},_drawSegment:function(e,t,r){var o=t.midPointFrom(r);return e.quadraticCurveTo(t.x,t.y,o.x,o.y),o},onMouseDown:function(e,t){this.canvas._isMainEvent(t.e)&&(this._prepareForDrawing(e),this._captureDrawingPath(e),this._render())},onMouseMove:function(e,t){if(this.canvas._isMainEvent(t.e)&&this._captureDrawingPath(e)&&1<this._points.length)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var r=this._points,o=r.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,r[o-2],r[o-1],!0),i.stroke(),i.restore()}},onMouseUp:function(e){return!this.canvas._isMainEvent(e.e)||(this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(e){var t=new fabric.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return!(1<this._points.length&&e.eq(this._points[this._points.length-1]))&&(this._points.push(e),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(e){var t=new fabric.Point(e.x,e.y);return this._addPoint(t)},_render:function(){var e=this.canvas.contextTop,t=this._points[0],r=this._points[1],o,n;if(this._saveAndTransform(e),e.beginPath(),2===this._points.length&&t.x===r.x&&t.y===r.y){var a=this.width/1e3;t=new fabric.Point(t.x,t.y),r=new fabric.Point(r.x,r.y),t.x-=a,r.x+=a}for(e.moveTo(t.x,t.y),o=1,n=this._points.length;o<n;o++)this._drawSegment(e,t,r),t=this._points[o],r=this._points[o+1];e.lineTo(t.x,t.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=[],r=this.width/1e3,o=new fabric.Point(e[0].x,e[0].y),n=new fabric.Point(e[1].x,e[1].y),a=e.length,s=1,l=0,c=2<a,d;for(c&&(s=e[2].x<n.x?-1:e[2].x===n.x?0:1,l=e[2].y<n.y?-1:e[2].y===n.y?0:1),t.push("M ",o.x-s*r," ",o.y-l*r," "),d=1;d<a;d++){if(!o.eq(n)){var g=o.midPointFrom(n);t.push("Q ",o.x," ",o.y," ",g.x," ",g.y," ")}o=e[d],d+1<e.length&&(n=e[d+1])}return c&&(s=o.x>e[d-2].x?1:o.x===e[d-2].x?0:-1,l=o.y>e[d-2].y?1:o.y===e[d-2].y?0:-1),t.push("L ",o.x+s*r," ",o.y+l*r),t},createPath:function(e){var t=new fabric.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},decimatePoints:function(t,r){if(2>=t.length)return t;var o=this.canvas.getZoom(),n=e(r/o,2),a=t.length-1,s=t[0],l=[s],c,d;for(c=1;c<a;c++)d=e(s.x-t[c].x,2)+e(s.y-t[c].y,2),d>=n&&(s=t[c],l.push(s));return 1===l.length&&l.push(new fabric.Point(l[0].x,l[0].y)),l},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===t)return void this.canvas.requestRenderAll();var r=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(r),this.canvas.requestRenderAll(),r.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:r})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),r=this.canvas.contextTop;this._saveAndTransform(r),this.dot(r,t),r.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e=this.canvas.contextTop,t=this.points,r,o;for(this._saveAndTransform(e),r=0,o=t.length;r<o;r++)this.dot(e,t[r]);e.restore()},onMouseMove:function(e){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,t,r;this.canvas.renderOnAddRemove=!1;var o=[];for(t=0,r=this.points.length;t<r;t++){var n=this.points[t],a=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&a.setShadow(this.shadow),o.push(a)}var s=new fabric.Group(o);s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},addPoint:function(e){var t=Math.max,r=new fabric.Point(e.x,e.y),o=fabric.util.getRandomInt(t(0,this.width-20),this.width+20)/2,i=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return r.radius=o,r.fill=i,this.points.push(r),r}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],r=0,o=this.sprayChunks.length,n;r<o;r++){n=this.sprayChunks[r];for(var a=0,s=n.length,l;a<s;a++)l=new fabric.Rect({width:n[a].width,height:n[a].width,left:n[a].x+1,top:n[a].y+1,originX:"center",originY:"center",fill:this.color}),t.push(l)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var c=new fabric.Group(t);this.shadow&&c.setShadow(this.shadow),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t={},r,o,n;for(o=0,n=e.length;o<n;o++)r=e[o].left+""+e[o].top,t[r]||(t[r]=e[o]);var a=[];for(r in t)a.push(t[r]);return a},render:function(e){var t=this.canvas.contextTop,r,o;for(t.fillStyle=this.color,this._saveAndTransform(t),(r=0,o=e.length);r<o;r++){var n=e[r];"undefined"!=typeof n.opacity&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width)}t.restore()},_render:function(){var e=this.canvas.contextTop,t,r;for(e.fillStyle=this.color,this._saveAndTransform(e),(t=0,r=this.sprayChunks.length);t<r;t++)this.render(this.sprayChunks[t]);e.restore()},addSprayChunk:function(e){var t=Math.max;this.sprayChunkPoints=[];var r=this.width/2,o,n,a,s;for(s=0;s<this.density;s++){o=fabric.util.getRandomInt(e.x-r,e.x+r),n=fabric.util.getRandomInt(e.y-r,e.y+r),a=this.dotWidthVariance?fabric.util.getRandomInt(t(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var l=new fabric.Point(o,n);l.width=a,this.randomOpacity&&(l.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(l)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=Math.PI,t=fabric.util.createCanvasElement(),r=t.getContext("2d");return t.width=t.height=25,r.fillStyle=this.color,r.beginPath(),r.arc(10,10,10,0,2*e,!1),r.closePath(),r.fill(),t},getPatternSrcFunction:function(){return(this.getPatternSrc+"").replace("this.color","\""+this.color+"\"")},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e),r=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-r.x,offsetY:-r.y}),t}}),function(){var e=Math.round,t=Math.ceil,r=Math.abs,o=Math.max,i=Math.floor,n=Math.atan2,a=fabric.util.getPointer,s=fabric.util.degreesToRadians,l=fabric.util.radiansToDegrees,c=n,d=r,g=fabric.StaticCanvas.supports("setLineDash"),u=.5;for(var p in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e=this.getActiveObjects(),t,r,o;if(0<e.length&&!this.preserveObjectStacking){r=[],o=[];for(var n=0,a=this._objects.length;n<a;n++)t=this._objects[n],-1===e.indexOf(t)?r.push(t):o.push(t);1<e.length&&(this._activeObject._objects=o),r.push.apply(r,o)}else r=this._objects;return r},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_resetCurrentTransform:function(){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,skewX:e.original.skewX,skewY:e.original.skewY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(e.target)?("center"!==e.originX&&("right"===e.originX?e.mouseXSign=-1:e.mouseXSign=1),"center"!==e.originY&&("bottom"===e.originY?e.mouseYSign=-1:e.mouseYSign=1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(t,e,r){var o=r||this.getPointer(t,!0),i;return i=e.group&&e.group===this._activeObject&&"activeSelection"===e.group.type?this._normalizePointer(e.group,o):{x:o.x,y:o.y},e.containsPoint(i)||e._findTargetCorner(o)},_normalizePointer:function(e,t){var r=e.calcTransformMatrix(),o=fabric.util.invertTransform(r),i=this.restorePointerVpt(t);return fabric.util.transformPoint(i,o)},isTargetTransparent:function(t,r,i){if(t.shouldCache()&&t._cacheCanvas&&t!==this._activeObject){var n=this._normalizePointer(t,{x:r,y:i}),a=o(t.cacheTranslationX+n.x*t.zoomX,0),s=o(t.cacheTranslationY+n.y*t.zoomY,0),l=fabric.util.isTransparent(t._cacheContext,e(a),e(s),this.targetFindTolerance);return l}var c=this.contextCache,d=t.selectionBackgroundColor,g=this.viewportTransform;t.selectionBackgroundColor="",this.clearContext(c),c.save(),c.transform(g[0],g[1],g[2],g[3],g[4],g[5]),t.render(c),c.restore(),t===this._activeObject&&t._renderControls(c,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),t.selectionBackgroundColor=d;var l=fabric.util.isTransparent(c,r,i,this.targetFindTolerance);return l},_isSelectionKeyPressed:function(t){var e=!1;return e="[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(e){return!0===t[e]}):t[this.selectionKey],e},_shouldClearSelection:function(t,e){var r=this.getActiveObjects(),o=this._activeObject;return!e||e&&o&&1<r.length&&-1===r.indexOf(e)&&o!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&o&&o!==e},_shouldCenterTransform:function(e){if(e){var r=this._currentTransform,t;return"scale"===r.action||"scaleX"===r.action||"scaleY"===r.action?t=this.centeredScaling||e.centeredScaling:"rotate"===r.action&&(t=this.centeredRotation||e.centeredRotation),t?!r.altKey:r.altKey}},_getOriginFromCorner:function(e,t){var r={x:e.originX,y:e.originY};return"ml"===t||"tl"===t||"bl"===t?r.x="right":("mr"===t||"tr"===t||"br"===t)&&(r.x="left"),"tl"===t||"mt"===t||"tr"===t?r.y="bottom":("bl"===t||"mb"===t||"br"===t)&&(r.y="top"),r},_getActionFromCorner:function(t,r,o){return r&&t?"mtr"===r?"rotate":"ml"===r||"mr"===r?o[this.altActionKey]?"skewY":"scaleX":"mt"===r||"mb"===r?o[this.altActionKey]?"skewX":"scaleY":"scale":"drag"},_setupCurrentTransform:function(t,e,r){if(e){var o=this.getPointer(t),i=e._findTargetCorner(this.getPointer(t,!0)),n=this._getActionFromCorner(r,i,t,e),a=this._getOriginFromCorner(e,i);this._currentTransform={target:e,action:n,corner:i,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:o.x-e.left,offsetY:o.y-e.top,originX:a.x,originY:a.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,theta:s(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey],original:fabric.util.saveObjectTransform(e)},this._currentTransform.original.originX=a.x,this._currentTransform.original.originY=a.y,this._resetCurrentTransform(),this._beforeTransform(t)}},_translateObject:function(e,t){var r=this._currentTransform,o=r.target,i=e-r.offsetX,n=t-r.offsetY,a=!o.get("lockMovementX")&&o.left!==i,s=!o.get("lockMovementY")&&o.top!==n;return a&&o.set("left",i),s&&o.set("top",n),a||s},_changeSkewTransformOrigin:function(e,r,t){var o="originX",i={0:"center"},n=r.target.skewX,a="left",s="right",l="mt"===r.corner||"ml"===r.corner?1:-1,c=1;e=0<e?1:-1,"y"===t&&(n=r.target.skewY,a="top",s="bottom",o="originY"),i[-1]=a,i[1]=s,r.target.flipX&&(c*=-1),r.target.flipY&&(c*=-1),0===n?(r.skewSign=-l*e*c,r[o]=i[-e]):(n=0<n?1:-1,r.skewSign=n,r[o]=i[n*l*c])},_skewObject:function(e,r,o){var i=this._currentTransform,t=i.target,n=!1,a=t.get("lockSkewingX"),s=t.get("lockSkewingY");if(a&&"x"===o||s&&"y"===o)return!1;var l=t.getCenterPoint(),c=t.toLocalPoint(new fabric.Point(e,r),"center","center")[o],d=t.toLocalPoint(new fabric.Point(i.lastX,i.lastY),"center","center")[o],g=t._getTransformedDimensions(),u,p;return this._changeSkewTransformOrigin(c-d,i,o),u=t.toLocalPoint(new fabric.Point(e,r),i.originX,i.originY)[o],p=t.translateToOriginPoint(l,i.originX,i.originY),n=this._setObjectSkew(u,i,o,g),i.lastX=e,i.lastY=r,t.setPositionByOrigin(p,i.originX,i.originY),n},_setObjectSkew:function(e,t,o,i){var n=Math.atan,a=t.target,s=!1,l=t.skewSign,c,d,g,u,p,h,f,m,_;return"x"===o?(u="y",p="Y",h="X",m=0,_=a.skewY):(u="x",p="X",h="Y",m=a.skewX,_=0),g=a._getTransformedDimensions(m,_),f=2*r(e)-g[o],2>=f?c=0:(c=l*n(f/a["scale"+h]/(g[u]/a["scale"+p])),c=fabric.util.radiansToDegrees(c)),s=a["skew"+h]!==c,a.set("skew"+h,c),0!==a["skew"+p]&&(d=a._getTransformedDimensions(),c=i[u]/d[u]*a["scale"+p],a.set("scale"+p,c)),s},_scaleObject:function(e,r,o){var i=this._currentTransform,t=i.target,n=t.lockScalingX,a=t.lockScalingY,s=t.lockScalingFlip;if(n&&a)return!1;var l=t.translateToOriginPoint(t.getCenterPoint(),i.originX,i.originY),c=t.toLocalPoint(new fabric.Point(e,r),i.originX,i.originY),d=t._getTransformedDimensions(),g=!1;return this._setLocalMouse(c,i),g=this._setObjectScale(c,i,n,a,o,s,d),t.setPositionByOrigin(l,i.originX,i.originY),g},_setObjectScale:function(e,t,r,o,i,n,a){var s=t.target,l=!1,c=!1,d=!1,g=e.x*s.scaleX/a.x,u=e.y*s.scaleY/a.y,p=s.scaleX!==g,h=s.scaleY!==u;if(t.newScaleX=g,t.newScaleY=u,fabric.Textbox&&"x"===i&&s instanceof fabric.Textbox){var f=s.width*(e.x/a.x);return!!(f>=s.getMinWidth())&&(d=f!==s.width,s.set("width",f),d)}return n&&0>=g&&g<s.scaleX&&(l=!0,e.x=0),n&&0>=u&&u<s.scaleY&&(c=!0,e.y=0),"equally"!==i||r||o?i?"x"!==i||s.get("lockUniScaling")?"y"===i&&!s.get("lockUniScaling")&&(c||o||s.set("scaleY",u)&&(d=h)):l||r||s.set("scaleX",g)&&(d=p):(l||r||s.set("scaleX",g)&&(d=d||p),c||o||s.set("scaleY",u)&&(d=d||h)):d=this._scaleObjectEqually(e,s,t,a),l||c||this._flipObject(t,i),d},_scaleObjectEqually:function(e,t,o,i){var n=e.y+e.x,a=i.y*o.original.scaleY/t.scaleY+i.x*o.original.scaleX/t.scaleX,s=0>e.x?-1:1,l=0>e.y?-1:1,c,d,g;return d=s*r(o.original.scaleX*n/a),g=l*r(o.original.scaleY*n/a),c=d!==t.scaleX||g!==t.scaleY,t.set("scaleX",d),t.set("scaleY",g),c},_flipObject:function(e,t){0>e.newScaleX&&"y"!==t&&("left"===e.originX?e.originX="right":"right"===e.originX&&(e.originX="left")),0>e.newScaleY&&"x"!==t&&("top"===e.originY?e.originY="bottom":"bottom"===e.originY&&(e.originY="top"))},_setLocalMouse:function(e,r){var t=r.target,o=this.getZoom(),i=t.padding/o;"right"===r.originX?e.x*=-1:"center"===r.originX&&(e.x*=2*r.mouseXSign,0>e.x&&(r.mouseXSign=-r.mouseXSign)),"bottom"===r.originY?e.y*=-1:"center"===r.originY&&(e.y*=2*r.mouseYSign,0>e.y&&(r.mouseYSign=-r.mouseYSign)),d(e.x)>i?0>e.x?e.x+=i:e.x-=i:e.x=0,d(e.y)>i?0>e.y?e.y+=i:e.y-=i:e.y=0},_rotateObject:function(e,o){var n=this._currentTransform,a=n.target,s=a.translateToOriginPoint(a.getCenterPoint(),n.originX,n.originY),s;if(a.lockRotation)return!1;var d=c(n.ey-s.y,n.ex-s.x),g=c(o-s.y,e-s.x),u=l(g-d+n.theta),p=!0;if(0<a.snapAngle){var h=a.snapAngle,f=a.snapThreshold||h,m=t(u/h)*h,_=i(u/h)*h;r(u-_)<f?u=_:r(u-m)<f&&(u=m)}return 0>u&&(u=360+u),u%=360,a.angle===u?p=!1:(a.angle=u,a.setPositionByOrigin(s,n.originX,n.originY)),p},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var t=this._groupSelector,r=t.left,o=t.top,i=d(r),n=d(o);if(this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(t.ex-(0<r?0:-r),t.ey-(0<o?0:-o),i,n)),this.selectionLineWidth&&this.selectionBorderColor)if(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!g){var a=t.ex+u-(0<r?0:i),s=t.ey+u-(0<o?0:n);e.beginPath(),fabric.util.drawDashedLine(e,a,s,a+i,s,this.selectionDashArray),fabric.util.drawDashedLine(e,a,s+n-1,a+i,s+n-1,this.selectionDashArray),fabric.util.drawDashedLine(e,a,s,a,s+n,this.selectionDashArray),fabric.util.drawDashedLine(e,a+i-1,s,a+i-1,s+n,this.selectionDashArray),e.closePath(),e.stroke()}else fabric.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(t.ex+u-(0<r?0:i),t.ey+u-(0<o?0:n),i,n)},findTarget:function(t,e){if(!this.skipTargetFind){var r=this.getPointer(t,!0),o=this._activeObject,i=this.getActiveObjects(),n,a;if(this.targets=[],1<i.length&&!e&&o===this._searchPossibleTargets([o],r))return o;if(1===i.length&&o._findTargetCorner(r))return o;if(1===i.length&&o===this._searchPossibleTargets([o],r)){if(!this.preserveObjectStacking)return o;n=o,a=this.targets,this.targets=[]}var s=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&s&&n&&s!==n&&(s=n,this.targets=a),s}},_checkTarget:function(e,t,r){if(t&&t.visible&&t.evented&&this.containsPoint(null,t,e))if((this.perPixelTargetFind||t.perPixelTargetFind)&&!t.isEditing){var o=this.isTargetTransparent(t,r.x,r.y);if(!o)return!0}else return!0},_searchPossibleTargets:function(e,t){for(var r=e.length,o,n;r--;){var a=e[r],s=a.group&&"activeSelection"!==a.group.type?this._normalizePointer(a.group,t):t;if(this._checkTarget(s,a,t)){o=e[r],o.subTargetCheck&&o instanceof fabric.Group&&(n=this._searchPossibleTargets(o._objects,t),n&&this.targets.push(n));break}}return o},restorePointerVpt:function(e){return fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var o=a(t),i=this.upperCanvasEl,n=i.getBoundingClientRect(),s=n.width||0,l=n.height||0,c;s&&l||("top"in n&&"bottom"in n&&(l=r(n.top-n.bottom)),"right"in n&&"left"in n&&(s=r(n.right-n.left))),this.calcOffset(),o.x-=this._offset.left,o.y-=this._offset.top,e||(o=this.restorePointerVpt(o));var d=this.getRetinaScaling();return 1!==d&&(o.x/=d,o.y/=d),c=0===s||0===l?{width:1,height:1}:{width:i.width/s,height:i.height/l},{x:o.x*c.width,y:o.y*c.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),t=this.lowerCanvasEl,r=this.upperCanvasEl;r?r.className="":(r=this._createCanvasElement(),this.upperCanvasEl=r),fabric.util.addClass(r,"upper-canvas "+e),this.wrapperEl.appendChild(r),this._copyCanvasStyle(t,r),this._applyCanvasStyle(r),this.contextTop=r.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,r=this.height||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:r+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=r,fabric.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),e===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(t,r){var e=!1,o=this.getActiveObjects(),i=[],n=[],a={e:r};t.forEach(function(t){-1===o.indexOf(t)&&(e=!0,t.fire("deselected",a),n.push(t))}),o.forEach(function(r){-1===t.indexOf(r)&&(e=!0,r.fire("selected",a),i.push(r))}),0<t.length&&0<o.length?(a.selected=i,a.deselected=n,a.updated=i[0]||n[0],a.target=this._activeObject,e&&this.fire("selection:updated",a)):0<o.length?(1===o.length&&(a.target=i[0],this.fire("object:selected",a)),a.selected=i,a.target=this._activeObject,this.fire("selection:created",a)):0<t.length&&(a.deselected=n,this.fire("selection:cleared",a))},setActiveObject:function(t,r){var e=this.getActiveObjects();return this._setActiveObject(t,r),this._fireSelectionEvents(e,r),this},_setActiveObject:function(t,r){return this._activeObject!==t&&!!this._discardActiveObject(r,t)&&!t.onSelect({e:r})&&(this._activeObject=t,!0)},_discardActiveObject:function(t,e){var r=this._activeObject;if(r){if(r.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects(),r=this.getActiveObject();return e.length&&this.fire("before:selection:cleared",{target:r,e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(e){fabric.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,r){var o=this._realizeGroupTransformOnObject(e),i=this.callSuper("_toObject",e,t,r);return this._unwindGroupTransformOnObject(e,o),i},_realizeGroupTransformOnObject:function(e){if(e.group&&"activeSelection"===e.group.type&&this._activeObject===e.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(r){t[r]=e[r]}),this._activeObject.realizeTransform(e),t}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,r){var o=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,r),this._unwindGroupTransformOnObject(t,o)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,e)}}),fabric.StaticCanvas)"prototype"!=p&&(fabric.Canvas[p]=fabric.StaticCanvas[p])}(),function(){var r=Math.round,o=Math.max;function t(t,e){return t.button&&t.button===e-1}var i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,a=fabric.util.removeListener,s={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(n,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(e,t){var r=this.upperCanvasEl,o=this._getEventPrefix();e(fabric.window,"resize",this._onResize),e(r,o+"down",this._onMouseDown),e(r,o+"move",this._onMouseMove,s),e(r,o+"out",this._onMouseOut),e(r,o+"enter",this._onMouseEnter),e(r,"wheel",this._onMouseWheel),e(r,"contextmenu",this._onContextMenu),e(r,"dblclick",this._onDoubleClick),e(r,"dragover",this._onDragOver),e(r,"dragenter",this._onDragEnter),e(r,"dragleave",this._onDragLeave),e(r,"drop",this._onDrop),this.enablePointerEvents||e(r,"touchstart",this._onTouchStart,s),"undefined"!=typeof eventjs&&t in eventjs&&(eventjs[t](r,"gesture",this._onGesture),eventjs[t](r,"drag",this._onDrag),eventjs[t](r,"orientation",this._onOrientationChange),eventjs[t](r,"shake",this._onShake),eventjs[t](r,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(a,"remove");var e=this._getEventPrefix();a(fabric.document,e+"up",this._onMouseUp),a(fabric.document,"touchend",this._onTouchEnd,s),a(fabric.document,e+"move",this._onMouseMove,s),a(fabric.document,"touchmove",this._onMouseMove,s)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t});var r=this;this._hoveredTargets.forEach(function(o){r.fire("mouse:out",{target:e,e:t}),o&&e.fire("mouseout",{e:t})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(e){e.isEditing&&e.hiddenTextarea.focus()})},_onMouseEnter:function(t){this.currentTransform||this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onDragOver:function(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},getPointerId:function(e){var t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1},_isMainEvent:function(e){return!(!0!==e.isPrimary)||!1!==e.isPrimary&&(!("touchend"!==e.type||0!==e.touches.length)||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(t){t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var e=this.upperCanvasEl,r=this._getEventPrefix();n(fabric.document,"touchend",this._onTouchEnd,s),n(fabric.document,"touchmove",this._onMouseMove,s),a(e,r+"down",this._onMouseDown)},_onMouseDown:function(t){this.__onMouseDown(t),this._resetTransformEventData();var e=this.upperCanvasEl,r=this._getEventPrefix();a(e,r+"move",this._onMouseMove,s),n(fabric.document,r+"up",this._onMouseUp),n(fabric.document,r+"move",this._onMouseMove,s)},_onTouchEnd:function(t){if(!(0<t.touches.length)){this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;var e=this._getEventPrefix();a(fabric.document,"touchend",this._onTouchEnd,s),a(fabric.document,"touchmove",this._onMouseMove,s);var r=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){n(r.upperCanvasEl,e+"down",r._onMouseDown),r._willAddMouseDown=0},400)}},_onMouseUp:function(t){this.__onMouseUp(t),this._resetTransformEventData();var e=this.upperCanvasEl,r=this._getEventPrefix();this._isMainEvent(t)&&(a(fabric.document,r+"up",this._onMouseUp),a(fabric.document,r+"move",this._onMouseMove,s),n(e,r+"move",this._onMouseMove,s))},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var t=this._activeObject;if(!!t!=!!e||t&&e&&t!==e)return!0;return!(t&&t.isEditing)&&!1},__onMouseUp:function(r){var e=this._currentTransform,o=this._groupSelector,i=!1,n=!o||0===o.left&&0===o.top,a;return this._cacheTransformEventData(r),a=this._target,this._handleEvent(r,"up:before"),t(r,3)?void(this.fireRightClick&&this._handleEvent(r,"up",3,n)):t(r,2)?(this.fireMiddleClick&&this._handleEvent(r,"up",2,n),void this._resetTransformEventData()):this.isDrawingMode&&this._isCurrentlyDrawing?void this._onMouseUpInDrawingMode(r):void(!this._isMainEvent(r)||(e&&(this._finalizeCurrentTransform(r),i=e.actionPerformed),!n&&(this._maybeGroupObjects(r),i||(i=this._shouldRender(a))),a&&(a.isMoving=!1),this._setCursorFromEvent(r,a),this._handleEvent(r,"up",1,n),this._groupSelector=null,this._currentTransform=null,a&&(a.__corner=0),i?this.requestRenderAll():!n&&this.renderTop()))},_simpleEventHandler:function(t,r){var e=this.findTarget(r),o=this.targets,n={e:r,target:e,subTargets:o};if(this.fire(t,n),e&&e.fire(t,n),!o)return e;for(var a=0;a<o.length;a++)o[a].fire(t,n);return e},_handleEvent:function(t,e,r,o){var n=this._target,a=this.targets||[],s={e:t,target:n,subTargets:a,button:r||1,isClick:o||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+e,s),n&&n.fire("mouse"+e,s);for(var l=0;l<a.length;l++)a[l].fire("mouse"+e,s)},_finalizeCurrentTransform:function(t){var e=this._currentTransform,r=e.target,o={e:t,target:r,transform:e},i;r._scaling&&(r._scaling=!1),r.setCoords(),(e.actionPerformed||this.stateful&&r.hasStateChanged())&&(e.actionPerformed&&(i=this._addEventOptions(o,e),this._fire(i,o)),this._fire("modified",o))},_addEventOptions:function(e,t){var r,o;switch(t.action){case"scaleX":r="scaled",o="x";break;case"scaleY":r="scaled",o="y";break;case"skewX":r="skewed",o="x";break;case"skewY":r="skewed",o="y";break;case"scale":r="scaled",o="equally";break;case"rotate":r="rotated";break;case"drag":r="moved";}return e.by=o,r},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this.clipTo&&this.contextTop.restore();var e=this.getPointer(t);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:t,pointer:e}),this._handleEvent(t,"up")},__onMouseDown:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"down:before");var e=this._target;if(t(r,3))return void(this.fireRightClick&&this._handleEvent(r,"down",3));if(t(r,2))return void(this.fireMiddleClick&&this._handleEvent(r,"down",2));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(r);if(this._isMainEvent(r)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var i=this._shouldRender(e),n=this._shouldGroup(r,e);if(this._shouldClearSelection(r,e)?this.discardActiveObject(r):n&&(this._handleGrouping(r,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:o.x,ey:o.y,top:0,left:0}),e){var a=e===this._activeObject;e.selectable&&this.setActiveObject(e,r),e===this._activeObject&&(e.__corner||!n)&&this._setupCurrentTransform(r,e,a)}this._handleEvent(r,"down"),(i||n)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(r){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:r,transform:e}),e.corner&&this.onBeforeScaleRotate(e.target)},__onMouseMove:function(t){this._handleEvent(t,"move:before"),this._cacheTransformEventData(t);var e,r;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(this._isMainEvent(t)){var o=this._groupSelector;o?(r=this._pointer,o.left=r.x-o.ex,o.top=r.y-o.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,r){var e=this._hoveredTarget,n=this._hoveredTargets,a=this.targets,s=o(n.length,a.length);this.fireSyntheticInOutEvents(t,r,{oldTarget:e,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var l=0;l<s;l++)this.fireSyntheticInOutEvents(a[l],r,{oldTarget:n[l],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(t,r){var e=this._draggedoverTarget,n=this._hoveredTargets,a=this.targets,s=o(n.length,a.length);this.fireSyntheticInOutEvents(t,r,{oldTarget:e,evtOut:"dragleave",evtIn:"dragenter"});for(var l=0;l<s;l++)this.fireSyntheticInOutEvents(a[l],r,{oldTarget:n[l],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=t},fireSyntheticInOutEvents:function(t,r,e){var o=e.oldTarget,i=o!==t,n=e.canvasEvtIn,a=e.canvasEvtOut,s,l,c,d;i&&(s={e:r,target:t,previousTarget:o},l={e:r,target:o,nextTarget:t}),d=t&&i,c=o&&i,c&&(a&&this.fire(a,l),o.fire(e.evtOut,l)),d&&(n&&this.fire(n,s),t.fire(e.evtIn,s))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var e=this.getPointer(t),r=this._currentTransform;r.reset=!1,r.target.isMoving=!0,r.shiftKey=t.shiftKey,r.altKey=t[this.centeredKey],this._beforeScaleTransform(t,r),this._performTransformAction(t,r,e),r.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,r){var o=r.x,i=r.y,n=e.action,a=!1,s={target:e.target,e:t,transform:e,pointer:r};"rotate"===n?(a=this._rotateObject(o,i))&&this._fire("rotating",s):"scale"===n?(a=this._onScale(t,e,o,i))&&this._fire("scaling",s):"scaleX"===n?(a=this._scaleObject(o,i,"x"))&&this._fire("scaling",s):"scaleY"===n?(a=this._scaleObject(o,i,"y"))&&this._fire("scaling",s):"skewX"===n?(a=this._skewObject(o,i,"x"))&&this._fire("skewing",s):"skewY"===n?(a=this._skewObject(o,i,"y"))&&this._fire("skewing",s):(a=this._translateObject(o,i),a&&(this._fire("moving",s),this.setCursor(s.target.moveCursor||this.moveCursor))),e.actionPerformed=e.actionPerformed||a},_fire:function(e,t){this.fire("object:"+e,t),t.target.fire(e,t)},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var r=this._shouldCenterTransform(e.target);(r&&("center"!==e.originX||"center"!==e.originY)||!r&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,r,o){return this._isUniscalePossible(t,e.target)?(e.currentAction="scale",this._scaleObject(r,o)):(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(r,o,"equally"))},_isUniscalePossible:function(t,e){return(t[this.uniScaleKey]||this.uniScaleTransform)&&!e.get("lockUniScaling")},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var r=e.hoverCursor||this.hoverCursor,o=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,i=(!o||!o.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));i?this.setCursor(this.getCornerCursor(i,e,t)):(e.subTargetCheck&&this.targets.concat().reverse().map(function(e){r=e.hoverCursor||r}),this.setCursor(r))},getCornerCursor:function(t,r,o){return this.actionIsDisabled(t,r,o)?this.notAllowedCursor:t in i?this._getRotatedCornerCursor(t,r,o):"mtr"===t&&r.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(t,r,o){return"mt"===t||"mb"===t?o[this.altActionKey]?r.lockSkewingX:r.lockScalingY:"ml"===t||"mr"===t?o[this.altActionKey]?r.lockSkewingY:r.lockScalingX:"mtr"===t?r.lockRotation:this._isUniscalePossible(o,r)?r.lockScalingX&&r.lockScalingY:r.lockScalingX||r.lockScalingY},_getRotatedCornerCursor:function(t,o,a){var e=r(o.angle%360/45);return 0>e&&(e+=8),e+=i[t],a[this.altActionKey]&&0==i[t]%2&&(e+=2),e%=8,this.cursorMap[e]}})}(),function(){var e=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var r=this._activeObject;return r&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(r!==e||"activeSelection"===r.type)&&!e.onSelect({e:t})},_handleGrouping:function(t,e){var r=this._activeObject;r.__corner||e===r&&(e=this.findTarget(t,!0),!e||!e.selectable)||(r&&"activeSelection"===r.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,r){var e=this._activeObject,o=e._objects.slice(0);e.contains(t)?(e.removeWithUpdate(t),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat(),1===e.size()&&this._setActiveObject(e.item(0),r)):(e.addWithUpdate(t),this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(o,r)},_createActiveSelection:function(t,r){var e=this.getActiveObjects(),o=this._createGroup(t);this._hoveredTarget=o,this._setActiveObject(o,r),this._fireSelectionEvents(e,r)},_createGroup:function(e){var t=this._objects,r=t.indexOf(this._activeObject)<t.indexOf(e),o=r?[this._activeObject,e]:[e,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(o,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects(t),r;1===e.length?this.setActiveObject(e[0],t):1<e.length&&(r=new fabric.ActiveSelection(e.reverse(),{canvas:this}),this.setActiveObject(r,t))},_collectObjects:function(r){for(var o=[],n=this._groupSelector.ex,a=this._groupSelector.ey,s=n+this._groupSelector.left,l=a+this._groupSelector.top,c=new fabric.Point(e(n,s),e(a,l)),d=new fabric.Point(t(n,s),t(a,l)),g=!this.selectionFullyContained,u=this._objects.length,p;u--&&!((p=this._objects[u],p&&p.selectable&&p.visible)&&(g&&p.intersectsWithRect(c,d)||p.isContainedWithinRect(c,d)||g&&p.containsPoint(c)||g&&p.containsPoint(d))&&(o.push(p),n===s&&a===l)););return 1<o.length&&(o=o.filter(function(e){return!e.onSelect({e:r})})),o},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",r=e.quality||1,o=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(o,e);return fabric.util.toDataURL(i,t,r)},toCanvasElement:function(e,t){e=e||1,t=t||{};var r=(t.width||this.width)*e,o=(t.height||this.height)*e,i=this.getZoom(),n=this.width,a=this.height,s=i*e,l=this.viewportTransform,c=(l[4]-(t.left||0))*e,d=(l[5]-(t.top||0))*e,g=this.interactive,u=this.enableRetinaScaling,p=fabric.util.createCanvasElement(),h=this.contextTop;return p.width=r,p.height=o,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=[s,0,0,s,c,d],this.width=r,this.height=o,this.calcViewportBoundaries(),this.renderCanvas(p.getContext("2d"),this._objects),this.viewportTransform=l,this.width=n,this.height=a,this.calcViewportBoundaries(),this.interactive=g,this.enableRetinaScaling=u,this.contextTop=h,p}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,t,r){return this.loadFromJSON(e,t,r)},loadFromJSON:function(e,t,r){if(e){var o="string"==typeof e?JSON.parse(e):fabric.util.object.clone(e),i=this,n=o.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete o.clipPath,this._enlivenObjects(o.objects,function(e){i.clear(),i._setBgOverlay(o,function(){n?i._enlivenObjects([n],function(r){i.clipPath=r[0],i.__setupCanvas.call(i,o,e,a,t)}):i.__setupCanvas.call(i,o,e,a,t)})},r),this}},__setupCanvas:function(e,t,r,o){var i=this;t.forEach(function(e,t){i.insertAt(e,t)}),this.renderOnAddRemove=r,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),o&&o()},_setBgOverlay:function(e,t){var r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay)return void(t&&t());var o=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,r,o),this.__setBgOverlay("overlayImage",e.overlayImage,r,o),this.__setBgOverlay("backgroundColor",e.background,r,o),this.__setBgOverlay("overlayColor",e.overlay,r,o)},__setBgOverlay:function(e,t,r,o){var i=this;return t?void("backgroundImage"===e||"overlayImage"===e?fabric.util.enlivenObjects([t],function(t){i[e]=t[0],r[e]=!0,o&&o()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){r[e]=!0,o&&o()})):(r[e]=!0,void(o&&o()))},_enlivenObjects:function(e,t,r){return e&&0!==e.length?void fabric.util.enlivenObjects(e,function(e){t&&t(e)},null,r):void(t&&t([]))},_toDataURL:function(e,t){this.clone(function(r){t(r.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,r){this.clone(function(o){r(o.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var r=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(r,function(){e&&e(t)})})},cloneWithoutData:function(e){var t=fabric.util.createCanvasElement();t.width=this.width,t.height=this.height;var r=new fabric.Canvas(t);r.clipTo=this.clipTo,this.backgroundImage?(r.setBackgroundImage(this.backgroundImage.src,function(){r.renderAll(),e&&e(r)}),r.backgroundImageOpacity=this.backgroundImageOpacity,r.backgroundImageStretch=this.backgroundImageStretch):e&&e(r)}}),function(e){'use strict';var t=Math.round,r=Math.ceil,o=Math.abs,i=e.fabric||(e.fabric={}),n=i.util.object.extend,a=i.util.object.clone,s=i.util.toFixed,l=i.util.string.capitalize,c=i.util.degreesToRadians,d=i.StaticCanvas.supports("setLineDash"),g=!i.isLikelyNode;i.Object||(i.Object=i.util.createClass(i.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:g,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=i.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var t=i.perfLimitSizeTotal,r=e.width,o=e.height,n=i.maxCacheSideLimit,a=i.minCacheSideLimit;if(r<=n&&o<=n&&r*o<=t)return r<a&&(e.width=a),o<a&&(e.height=a),e;var s=i.util.limitDimsByArea(r/o,t),l=i.util.capValue,c=l(a,s.x,n),d=l(a,s.y,n);return r>c&&(e.zoomX/=r/c,e.width=c,e.capped=!0),o>d&&(e.zoomY/=o/d,e.height=d,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.getTotalObjectScaling(),t=this._getTransformedDimensions(0,0),r=t.x*e.scaleX/this.scaleX,o=t.y*e.scaleY/this.scaleY;return{width:r+2,height:o+2,zoomX:e.scaleX,zoomY:e.scaleY,x:r,y:o}},_updateCacheCanvas:function(){var e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){var o=e._currentTransform.target,n=e._currentTransform.action;if(this===o&&n.slice&&"scale"===n.slice(0,5))return!1}var a=this._cacheCanvas,s=this._limitCacheSize(this._getCacheCanvasDimensions()),l=i.minCacheSideLimit,c=s.width,d=s.height,g=s.zoomX,u=s.zoomY,p=c!==this.cacheWidth||d!==this.cacheHeight,h=this.zoomX!==g||this.zoomY!==u,f=0,m=0,_=!1,y,x;if(p){var v=this._cacheCanvas.width,C=this._cacheCanvas.height,b=c>v||d>C;_=b||(c<.9*v||d<.9*C)&&v>l&&C>l,b&&!s.capped&&(c>l||d>l)&&(f=.1*c,m=.1*d)}return!!(p||h)&&(_?(a.width=r(c+f),a.height=r(d+m)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),y=s.x/2,x=s.y/2,this.cacheTranslationX=t(a.width/2-y)+y,this.cacheTranslationY=t(a.height/2-x)+x,this.cacheWidth=c,this.cacheHeight=d,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(g,u),this.zoomX=g,this.zoomY=u,!0)},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initClipping(e),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t;t=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},toObject:function(e){var t=i.Object.NUM_FRACTION_DIGITS,r={type:this.type,version:i.version,originX:this.originX,originY:this.originY,left:s(this.left,t),top:s(this.top,t),width:s(this.width,t),height:s(this.height,t),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:s(this.strokeWidth,t),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:s(this.strokeMiterLimit,t),scaleX:s(this.scaleX,t),scaleY:s(this.scaleY,t),angle:s(this.angle,t),flipX:this.flipX,flipY:this.flipY,opacity:s(this.opacity,t),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&this.clipTo+"",backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:s(this.skewX,t),skewY:s(this.skewY,t)};return this.clipPath&&(r.clipPath=this.clipPath.toObject(e),r.clipPath.inverted=this.clipPath.inverted,r.clipPath.absolutePositioned=this.clipPath.absolutePositioned),i.util.populateWithProperties(this,r,e),this.includeDefaultValues||(r=this._removeDefaultValues(r)),r},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var t=i.util.getKlass(e.type).prototype,r=t.stateProperties;return r.forEach(function(r){if("left"!==r&&"top"!==r){e[r]===t[r]&&delete e[r];var o="[object Array]"===Object.prototype.toString.call(e[r])&&"[object Array]"===Object.prototype.toString.call(t[r]);o&&0===e[r].length&&0===t[r].length&&delete e[r]}}),e},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){var e=i.util.qrDecompose(this.calcTransformMatrix());return{scaleX:o(e.scaleX),scaleY:o(e.scaleY)}},getTotalObjectScaling:function(){var e=this.getObjectScaling(),t=e.scaleX,r=e.scaleY;if(this.canvas){var o=this.canvas.getZoom(),i=this.canvas.getRetinaScaling();t*=o*i,r*=o*i}return{scaleX:t,scaleY:r}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,t){var r=this[e]!==t,o=!1;return("scaleX"===e||"scaleY"===e)&&(t=this._constrainScale(t)),"scaleX"===e&&0>t?(this.flipX=!this.flipX,t*=-1):"scaleY"===e&&0>t?(this.flipY=!this.flipY,t*=-1):"shadow"===e&&t&&!(t instanceof i.Shadow)?t=new i.Shadow(t):"dirty"==e&&this.group&&this.group.set("dirty",t),this[e]=t,r&&(o=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(e)?(this.dirty=!0,o&&this.group.set("dirty",!0)):o&&-1<this.stateProperties.indexOf(e)&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:i.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height&&0===this.strokeWidth||!this.visible},render:function(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.clipTo&&i.util.clipContext(this,e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&e.restore(),e.restore())},renderCache:function(e){e=e||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!!("stroke"===this.paintFirst&&this.hasFill()&&this.hasStroke()&&"object"==typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(e){var t=this.clipPath;if(e.save(),e.globalCompositeOperation=t.inverted?"destination-out":"destination-in",t.absolutePositioned){var r=i.util.invertTransform(this.calcTransformMatrix());e.transform(r[0],r[1],r[2],r[3],r[4],r[5])}t.transform(e),e.scale(1/t.zoomX,1/t.zoomY),e.drawImage(t._cacheCanvas,-t.cacheTranslationX,-t.cacheTranslationY),e.restore()},drawObject:function(e,t){var r=this.fill,o=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):(this._renderBackground(e),this._setStrokeStyles(e,this),this._setFillStyles(e,this)),this._render(e),this._drawClipPath(e),this.fill=r,this.stroke=o},_drawClipPath:function(e){var t=this.clipPath;t&&(t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(e))},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!e){var t=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-r/2,t,r)}return!0}return!1},_renderBackground:function(e){if(this.backgroundColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){t.stroke&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,e.strokeStyle=t.stroke.toLive?t.stroke.toLive(e,this):t.stroke)},_setFillStyles:function(e,t){t.fill&&(e.fillStyle=t.fill.toLive?t.fill.toLive(e,this):t.fill)},_setClippingProperties:function(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"},_setLineDash:function(e,t,r){t&&0!==t.length&&(1&t.length&&t.push.apply(t,t),d?e.setLineDash(t):r&&r(e))},_renderControls:function(e,t){var r=this.getViewportTransform(),o=this.calcTransformMatrix(),n,a,s;t=t||{},a="undefined"==typeof t.hasBorders?this.hasBorders:t.hasBorders,s="undefined"==typeof t.hasControls?this.hasControls:t.hasControls,o=i.util.multiplyTransformMatrices(r,o),n=i.util.qrDecompose(o),e.save(),e.translate(n.translateX,n.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),t.forActiveSelection?(e.rotate(c(n.angle)),a&&this.drawBordersInGroup(e,n,t)):(e.rotate(c(this.angle)),a&&this.drawBorders(e,t)),s&&this.drawControls(e,t),e.restore()},_setShadow:function(e){if(this.shadow){var t=this.shadow,r=this.canvas,o=r&&r.viewportTransform[0]||1,n=r&&r.viewportTransform[3]||1,a;a=t.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),r&&r._isRetinaScaling()&&(o*=i.devicePixelRatio,n*=i.devicePixelRatio),e.shadowColor=t.color,e.shadowBlur=t.blur*i.browserShadowBlurConstant*(o+n)*(a.scaleX+a.scaleY)/4,e.shadowOffsetX=t.offsetX*o*a.scaleX,e.shadowOffsetY=t.offsetY*n*a.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(e,r){if(!r||!r.toLive)return{offsetX:0,offsetY:0};var o=r.gradientTransform||r.patternTransform,t=-this.width/2+r.offsetX||0,i=-this.height/2+r.offsetY||0;return"percentage"===r.gradientUnits?e.transform(this.width,0,0,this.height,t,i):e.transform(1,0,0,1,t,i),o&&e.transform(o[0],o[1],o[2],o[3],o[4],o[5]),{offsetX:t,offsetY:i}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_render:function(){},_renderFill:function(e){this.fill&&(e.save(),this._applyPatternGradientTransform(e,this.fill),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform&&this.group){var t=this.getObjectScaling();e.scale(1/t.scaleX,1/t.scaleY)}else this.strokeUniform&&e.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(e,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&"percentage"===this.stroke.gradientUnits?this._applyPatternForTransformedGradient(e,this.stroke):this._applyPatternGradientTransform(e,this.stroke),e.stroke(),e.restore()}},_applyPatternForTransformedGradient:function(e,t){var r=this._limitCacheSize(this._getCacheCanvasDimensions()),o=i.util.createCanvasElement(),n=this.canvas.getRetinaScaling(),a=r.x/this.scaleX/n,s=r.y/this.scaleY/n,l;o.width=a,o.height=s,l=o.getContext("2d"),l.beginPath(),l.moveTo(0,0),l.lineTo(a,0),l.lineTo(a,s),l.lineTo(0,s),l.closePath(),l.translate(a/2,s/2),l.scale(r.zoomX/this.scaleX/n,r.zoomY/this.scaleY/n),this._applyPatternGradientTransform(l,t),l.fillStyle=t.toLive(e),l.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(n*this.scaleX/r.zoomX,n*this.scaleY/r.zoomY),e.strokeStyle=l.createPattern(o,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=i.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var t=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),t=i.util.transformPoint(t,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,t.x+=e.offsetLeft,t.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(t,"center","center")},clone:function(e,t){var r=this.toObject(t);this.constructor.fromObject?this.constructor.fromObject(r,e):i.Object._fromObject("Object",r,e)},cloneAsImage:function(e,t){var r=this.toCanvasElement(t);return e&&e(new i.Image(r)),this},toCanvasElement:function(e){e||(e={});var n=i.util,a=n.saveObjectTransform(this),s=this.group,l=this.shadow,c=o,d=(e.multiplier||1)*(e.enableRetinaScaling?i.devicePixelRatio:1);delete this.group,e.withoutTransform&&n.resetObjectTransform(this),e.withoutShadow&&(this.shadow=null);var g=i.util.createCanvasElement(),u=this.getBoundingRect(!0,!0),p=this.shadow,h={x:0,y:0},f,m,_,y;p&&(m=p.blur,f=p.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),h.x=2*t(c(p.offsetX)+m)*c(f.scaleX),h.y=2*t(c(p.offsetY)+m)*c(f.scaleY)),_=u.width+h.x,y=u.height+h.y,g.width=r(_),g.height=r(y);var x=new i.StaticCanvas(g,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===e.format&&(x.backgroundColor="#fff"),this.setPositionByOrigin(new i.Point(x.width/2,x.height/2),"center","center");var v=this.canvas;x.add(this);var C=x.toCanvasElement(d||1,e);return this.shadow=l,this.set("canvas",v),s&&(this.group=s),this.set(a).setCoords(),x._objects=[],x.dispose(),x=null,C},toDataURL:function(e){return e||(e={}),i.util.toDataURL(this.toCanvasElement(e),e.format||"png",e.quality||1)},isType:function(e){return this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},setGradient:function(e,t){t||(t={});var r={colorStops:[]};return r.type=t.type||(t.r1||t.r2?"radial":"linear"),r.coords={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},r.gradientUnits=t.gradientUnits||"pixels",(t.r1||t.r2)&&(r.coords.r1=t.r1,r.coords.r2=t.r2),r.gradientTransform=t.gradientTransform,i.Gradient.prototype.addColorStop.call(r,t.colorStops),this.set(e,i.Gradient.forObject(this,r))},setPatternFill:function(e,t){return this.set("fill",new i.Pattern(e,t))},setShadow:function(e){return this.set("shadow",e?new i.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},rotate:function(e){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var r=new i.Point(e.x,e.y),o=this._getLeftTopCoords();return this.angle&&(r=i.util.rotatePoint(r,o,c(-this.angle))),{x:r.x-o.x,y:r.y-o.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}}),i.util.createAccessors&&i.util.createAccessors(i.Object),n(i.Object.prototype,i.Observable),i.Object.NUM_FRACTION_DIGITS=2,i.Object._fromObject=function(e,t,r,o){var n=i[e];t=a(t,!0),i.util.enlivenPatterns([t.fill,t.stroke],function(e){"undefined"!=typeof e[0]&&(t.fill=e[0]),"undefined"!=typeof e[1]&&(t.stroke=e[1]),i.util.enlivenObjects([t.clipPath],function(e){t.clipPath=e[0];var i=o?new n(t[o],t):new n(t);r&&r(i)})})},i.Object.__uid=0)}("undefined"==typeof exports?this:exports),function(){var e=fabric.util.degreesToRadians,t={left:-.5,center:0,right:.5},r={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(e,o,i,n,a){var s=e.x,l=e.y,c,d,g;return"string"==typeof o?o=t[o]:o-=.5,"string"==typeof n?n=t[n]:n-=.5,c=n-o,"string"==typeof i?i=r[i]:i-=.5,"string"==typeof a?a=r[a]:a-=.5,d=a-i,(c||d)&&(g=this._getTransformedDimensions(),s=e.x+c*g.x,l=e.y+d*g.y),new fabric.Point(s,l)},translateToCenterPoint:function(t,r,o){var i=this.translateToGivenOrigin(t,r,o,"center","center");return this.angle?fabric.util.rotatePoint(i,t,e(this.angle)):i},translateToOriginPoint:function(t,r,o){var i=this.translateToGivenOrigin(t,"center","center",r,o);return this.angle?fabric.util.rotatePoint(i,t,e(this.angle)):i},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var r=this.getCenterPoint();return this.translateToOriginPoint(r,e,t)},toLocalPoint:function(t,r,o){var i=this.getCenterPoint(),n,a;return n="undefined"!=typeof r&&"undefined"!=typeof o?this.translateToGivenOrigin(i,"center","center",r,o):new fabric.Point(this.left,this.top),a=new fabric.Point(t.x,t.y),this.angle&&(a=fabric.util.rotatePoint(a,i,-e(this.angle))),a.subtractEquals(n)},setPositionByOrigin:function(e,t,r){var o=this.translateToCenterPoint(e,t,r),i=this.translateToOriginPoint(o,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(r){var o=e(this.angle),i=this.getScaledWidth(),n=fabric.util.cos(o)*i,a=fabric.util.sin(o)*i,s,l;s="string"==typeof this.originX?t[this.originX]:this.originX-.5,l="string"==typeof r?t[r]:r-.5,this.left+=n*(l-s),this.top+=a*(l-s),this.setCoords(),this.originX=r},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function e(e){return[new fabric.Point(e.tl.x,e.tl.y),new fabric.Point(e.tr.x,e.tr.y),new fabric.Point(e.br.x,e.br.y),new fabric.Point(e.bl.x,e.bl.y)]}var t=fabric.util.degreesToRadians,r=fabric.util.multiplyTransformMatrices,o=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,r){this.oCoords||this.setCoords();var o=t?this.aCoords:this.oCoords;return e(r?this.calcCoords(t):o)},intersectsWithRect:function(e,t,r,o){var i=this.getCoords(r,o),n=fabric.Intersection.intersectPolygonRectangle(i,e,t);return"Intersection"===n.status},intersectsWithObject:function(e,t,r){var o=fabric.Intersection.intersectPolygonPolygon(this.getCoords(t,r),e.getCoords(t,r));return"Intersection"===o.status||e.isContainedWithinObject(this,t,r)||this.isContainedWithinObject(e,t,r)},isContainedWithinObject:function(e,t,r){for(var o=this.getCoords(t,r),n=0,a=e._getImageLines(r?e.calcCoords(t):t?e.aCoords:e.oCoords);4>n;n++)if(!e.containsPoint(o[n],a))return!1;return!0},isContainedWithinRect:function(e,t,r,o){var i=this.getBoundingRect(r,o);return i.left>=e.x&&i.left+i.width<=t.x&&i.top>=e.y&&i.top+i.height<=t.y},containsPoint:function(e,t,r,o){var t=t||this._getImageLines(o?this.calcCoords(r):r?this.aCoords:this.oCoords),i=this._findCrossPoints(e,t);return 0!==i&&1==i%2},isOnScreen:function(e){if(!this.canvas)return!1;for(var t=this.canvas.vptCoords.tl,r=this.canvas.vptCoords.br,o=this.getCoords(!0,e),n=0,a;4>n;n++)if(a=o[n],a.x<=r.x&&a.x>=t.x&&a.y<=r.y&&a.y>=t.y)return!0;return!!this.intersectsWithRect(t,r,!0,e)||this._containsCenterOfCanvas(t,r,e)},_containsCenterOfCanvas:function(e,t,r){var o={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return!!this.containsPoint(o,null,!0,r)},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,r=this.canvas.vptCoords.br;return!!this.intersectsWithRect(t,r,!0,e)||this._containsCenterOfCanvas(t,r,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var r=0,o,i,n,a,s,l;for(var c in t)if((l=t[c],!(l.o.y<e.y&&l.d.y<e.y))&&!(l.o.y>=e.y&&l.d.y>=e.y)&&(l.o.x===l.d.x&&l.o.x>=e.x?s=l.o.x:(o=0,i=(l.d.y-l.o.y)/(l.d.x-l.o.x),n=e.y-o*e.x,a=l.o.y-i*l.o.x,s=-(n-a)/(o-i)),s>=e.x&&(r+=1),2===r))break;return r},getBoundingRect:function(e,t){var r=this.getCoords(e,t);return fabric.util.makeBoundingBoxFromPoints(r)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){if(Math.abs(e)<this.minScaleLimit)return 0>e?-this.minScaleLimit:this.minScaleLimit;return 0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var r=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/r)},scaleToHeight:function(e,t){var r=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/r)},calcCoords:function(e){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),a=r(n,i),s=this.getViewportTransform(),l=e?a:r(s,a),c=this._getTransformedDimensions(),d=c.x/2,g=c.y/2,u=o({x:-d,y:-g},l),p=o({x:d,y:-g},l),h=o({x:-d,y:g},l),f=o({x:d,y:g},l);if(!e){var m=this.padding,_=t(this.angle),y=fabric.util.cos(_),x=fabric.util.sin(_),v=y*m,C=x*m,b=v+C,S=v-C;m&&(u.x-=S,u.y-=b,p.x+=b,p.y-=S,h.x-=b,h.y+=S,f.x+=S,f.y+=b);var T=new fabric.Point((u.x+h.x)/2,(u.y+h.y)/2),O=new fabric.Point((p.x+u.x)/2,(p.y+u.y)/2),w=new fabric.Point((f.x+p.x)/2,(f.y+p.y)/2),P=new fabric.Point((f.x+h.x)/2,(f.y+h.y)/2),k=new fabric.Point(O.x+x*this.rotatingPointOffset,O.y-y*this.rotatingPointOffset)}var D={tl:u,tr:p,br:f,bl:h};return e||(D.ml=T,D.mt=O,D.mr=w,D.mb=P,D.mtr=k),D},setCoords:function(e,t){return this.oCoords=this.calcCoords(e),t||(this.aCoords=this.calcCoords(!0)),e||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){return fabric.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="";return!e&&this.group&&(t=this.group.transformMatrixKey(e)+"_"),t+this.top+"_"+this.left+"_"+this.scaleX+"_"+this.scaleY+"_"+this.skewX+"_"+this.skewY+"_"+this.angle+"_"+this.originX+"_"+this.originY+"_"+this.width+"_"+this.height+"_"+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){if(e)return this.calcOwnMatrix();var t=this.transformMatrixKey(),o=this.matrixCache||(this.matrixCache={});if(o.key===t)return o.value;var i=this.calcOwnMatrix();return this.group&&(i=r(this.group.calcTransformMatrix(),i)),o.key=t,o.value=i,i},calcOwnMatrix:function(){var e=this.transformMatrixKey(!0),t=this.ownMatrixCache||(this.ownMatrixCache={});if(t.key===e)return t.value;var r=this._calcTranslateMatrix();return this.translateX=r[4],this.translateY=r[5],t.key=e,t.value=fabric.util.composeMatrix(this),t.value},_calcDimensionsTransformMatrix:function(e,t,r){return fabric.util.calcDimensionsMatrix({skewX:e,skewY:t,scaleX:this.scaleX*(r&&this.flipX?-1:1),scaleY:this.scaleY*(r&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var e=this.strokeWidth,t=this.width+e,r=this.height+e;return{x:t,y:r}},_getTransformedDimensions:function(e,t){"undefined"==typeof e&&(e=this.skewX),"undefined"==typeof t&&(t=this.skewY);var r=this._getNonTransformedDimensions(),o=0===e&&0===t,i,n;if(this.strokeUniform?(i=this.width,n=this.height):(i=r.x,n=r.y),o)return this._finalizeDimensions(i*this.scaleX,n*this.scaleY);i/=2,n/=2;var a=[{x:-i,y:-n},{x:i,y:-n},{x:-i,y:n},{x:i,y:n}],s=fabric.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:e,skewY:t}),l=fabric.util.makeBoundingBoxFromPoints(a,s);return this._finalizeDimensions(l.width,l.height)},_finalizeDimensions:function(e,t){return this.strokeUniform?{x:e+this.strokeWidth,y:t+this.strokeWidth}:{x:e,y:t}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions(),r=fabric.util.transformPoint(t,e,!0);return r.scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}}),function(){function e(e,t){if(!t)return e+": none; ";if(t.toLive)return e+": url(#SVGID_"+t.id+"); ";var r=new fabric.Color(t),o=e+": "+r.toRgb()+"; ",i=r.getAlpha();return 1!==i&&(o+=e+"-opacity: "+i.toString()+"; "),o}var t=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(t){var r=this.fillRule?this.fillRule:"nonzero",o=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c="undefined"==typeof this.opacity?"1":this.opacity,d=this.visible?"":" visibility: hidden;",g=t?"":this.getSvgFilter(),u=e("fill",this.fill),p=e("stroke",this.stroke);return[p,"stroke-width: ",o,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",l,"; ",u,"fill-rule: ",r,"; ","opacity: ",c,";",g,d].join("")},getSvgSpanStyles:function(t,r){var o=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf("\"")?"'"+t.fontFamily+"'":t.fontFamily)+"; ":"",i=t.strokeWidth?"stroke-width: "+t.strokeWidth+"; ":"",o=o,n=t.fontSize?"font-size: "+t.fontSize+"px; ":"",a=t.fontStyle?"font-style: "+t.fontStyle+"; ":"",s=t.fontWeight?"font-weight: "+t.fontWeight+"; ":"",l=t.fill?e("fill",t.fill):"",c=t.stroke?e("stroke",t.stroke):"",d=this.getSvgTextDecoration(t),g=t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"";return d&&(d="text-decoration: "+d+"; "),[c,i,o,n,a,s,d,l,g,r?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(e){return["overline","underline","line-through"].filter(function(t){return e[t.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?"id=\""+this.id+"\" ":"",this.clipPath?"clip-path=\"url(#"+this.clipPath.clipPathId+")\" ":""].join("")},getSvgTransform:function(e,t){var r=e?this.calcTransformMatrix():this.calcOwnMatrix(),o="transform=\""+fabric.util.matrixToSVG(r);return o+(t||"")+this.getSvgTransformMatrix()+"\" "},getSvgTransformMatrix:function(){return this.transformMatrix?" "+fabric.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(e){if(this.backgroundColor){var r=fabric.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor)," x=\"",t(-this.width/2,r),"\" y=\"",t(-this.height/2,r),"\" width=\"",t(this.width,r),"\" height=\"",t(this.height,r),"\"></rect>\n")}},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})},toClipPathSVG:function(e){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})},_createBaseClipPathSVGMarkup:function(e,t){t=t||{};var r=t.reviver,o=t.additionalTransform||"",i=[this.getSvgTransform(!0,o),this.getSvgCommons()].join(""),n=e.indexOf("COMMON_PARTS");return e[n]=i,r?r(e.join("")):e.join("")},_createBaseSVGMarkup:function(e,t){t=t||{};var r=t.noStyle,o=t.reviver,i=r?"":"style=\""+this.getSvgStyles()+"\" ",n=t.withShadow?"style=\""+this.getSvgFilter()+"\" ":"",a=this.clipPath,s=this.strokeUniform?"vector-effect=\"non-scaling-stroke\" ":"",l=a&&a.absolutePositioned,c=this.stroke,d=this.fill,g=this.shadow,u=[],p=e.indexOf("COMMON_PARTS"),h=t.additionalTransform,f,m;return a&&(a.clipPathId="CLIPPATH_"+fabric.Object.__uid++,m="<clipPath id=\""+a.clipPathId+"\" >\n"+a.toClipPathSVG(o)+"</clipPath>\n"),l&&u.push("<g ",n,this.getSvgCommons()," >\n"),u.push("<g ",this.getSvgTransform(!1),l?"":n+this.getSvgCommons()," >\n"),f=[i,s,r?"":this.addPaintOrder()," ",h?"transform=\""+h+"\" ":""].join(""),e[p]=f,d&&d.toLive&&u.push(d.toSVG(this)),c&&c.toLive&&u.push(c.toSVG(this)),g&&u.push(g.toSVG(this)),a&&u.push(m),u.push(e.join("")),u.push("</g>\n"),l&&u.push("</g>\n"),o?o(u.join("")):u.join("")},addPaintOrder:function(){return"fill"===this.paintFirst?"":" paint-order=\""+this.paintFirst+"\" "}})}(),function(){function e(e,t,o){var i={};o.forEach(function(t){i[t]=e[t]}),r(e[t],i,!0)}function t(e,r,o){if(e===r)return!0;if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var n=0,a=e.length;n<a;n++)if(!t(e[n],r[n]))return!1;return!0}if(e&&"object"==typeof e){var s=Object.keys(e),l;if(!r||"object"!=typeof r||!o&&s.length!==Object.keys(r).length)return!1;for(var n=0,a=s.length;n<a;n++)if((l=s[n],"canvas"!==l)&&!t(e[l],r[l]))return!1;return!0}}var r=fabric.util.object.extend;fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(e){e=e||"stateProperties";var r="_"+e;return!!(Object.keys(this[r]).length<this[e].length)||!t(this[r],this,!0)},saveState:function(t){var r=t&&t.propertySet||"stateProperties",o="_"+r;return this[o]?(e(this,o,this[r]),t&&t.stateProperties&&e(this,o,t.stateProperties),this):this.setupState(t)},setupState:function(e){e=e||{};var t=e.propertySet||"stateProperties";return e.propertySet=t,this["_"+t]={},this.saveState(e),this}})}(),function(){var e=Math.PI,t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t=e.x,r=e.y,o,n;for(var a in this.__corner=0,this.oCoords)if(this.isControlVisible(a)&&("mtr"!=a||this.hasRotatingPoint)&&!(this.get("lockUniScaling")&&("mt"===a||"mr"===a||"mb"===a||"ml"===a))&&(n=this._getImageLines(this.oCoords[a].corner),o=this._findCrossPoints({x:t,y:r},n),0!==o&&1==o%2))return this.__corner=a,a;return!1},_setCornerCoords:function(){var e=this.oCoords,r=t(45-this.angle),o=.707106*this.cornerSize,i=o*fabric.util.cos(r),n=o*fabric.util.sin(r),a,s;for(var l in e)a=e[l].x,s=e[l].y,e[l].corner={tl:{x:a-n,y:s-i},tr:{x:a+i,y:s-n},bl:{x:a-i,y:s+n},br:{x:a+n,y:s+i}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var r=this.getCenterPoint(),o=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return e.translate(r.x,r.y),e.scale(1/i[0],1/i[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-o.x/2,-o.y/2,o.x,o.y),e.restore(),this},drawBorders:function(e,t){t=t||{};var r=this._calculateCurrentDimensions(),o=this.borderScaleFactor,i=r.x+o,n=r.y+o,a="undefined"==typeof t.hasRotatingPoint?this.hasRotatingPoint:t.hasRotatingPoint,s="undefined"==typeof t.hasControls?this.hasControls:t.hasControls,l="undefined"==typeof t.rotatingPointOffset?this.rotatingPointOffset:t.rotatingPointOffset;if(e.save(),e.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(e,t.borderDashArray||this.borderDashArray,null),e.strokeRect(-i/2,-n/2,i,n),a&&this.isControlVisible("mtr")&&s){var c=-n/2;e.beginPath(),e.moveTo(0,c),e.lineTo(0,c-l),e.stroke()}return e.restore(),this},drawBordersInGroup:function(e,t,r){r=r||{};var o={x:this.width,y:this.height},i=fabric.util.composeMatrix({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX}),n=fabric.util.transformPoint(o,i),a=this.strokeWidth,s=this.borderScaleFactor,l=n.x+a*(this.strokeUniform?this.canvas.getZoom():t.scaleX)+s,c=n.y+a*(this.strokeUniform?this.canvas.getZoom():t.scaleY)+s;return e.save(),this._setLineDash(e,r.borderDashArray||this.borderDashArray,null),e.strokeStyle=r.borderColor||this.borderColor,e.strokeRect(-l/2,-c/2,l,c),e.restore(),this},drawControls:function(e,t){t=t||{};var r=this._calculateCurrentDimensions(),o=r.x,i=r.y,n=t.cornerSize||this.cornerSize,a=-(o+n)/2,s=-(i+n)/2,l="undefined"==typeof t.transparentCorners?this.transparentCorners:t.transparentCorners,c="undefined"==typeof t.hasRotatingPoint?this.hasRotatingPoint:t.hasRotatingPoint,d=l?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,d,a,s,t),this._drawControl("tr",e,d,a+o,s,t),this._drawControl("bl",e,d,a,s+i,t),this._drawControl("br",e,d,a+o,s+i,t),this.get("lockUniScaling")||(this._drawControl("mt",e,d,a+o/2,s,t),this._drawControl("mb",e,d,a+o/2,s+i,t),this._drawControl("mr",e,d,a+o,s+i/2,t),this._drawControl("ml",e,d,a,s+i/2,t)),c&&this._drawControl("mtr",e,d,a+o/2,s-this.rotatingPointOffset,t),e.restore(),this},_drawControl:function(t,r,o,i,n,a){if(a=a||{},!!this.isControlVisible(t)){var s=this.cornerSize,l=!this.transparentCorners&&this.cornerStrokeColor;switch(a.cornerStyle||this.cornerStyle){case"circle":r.beginPath(),r.arc(i+s/2,n+s/2,s/2,0,2*e,!1),r[o](),l&&r.stroke();break;default:this.transparentCorners||r.clearRect(i,n,s,s),r[o+"Rect"](i,n,s,s),l&&r.strokeRect(i,n,s,s);}}},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,t){return this._getControlsVisibility()[e]=t,this},setControlsVisibility:function(e){for(var t in e||(e={}),e)this.setControlVisible(t,e[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var r=function(){},o=t.onComplete||r,i=t.onChange||r,n=this;return fabric.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),n.requestRenderAll(),i()},onComplete:function(){e.setCoords(),o()}}),this},fxCenterObjectV:function(e,t){t=t||{};var r=function(){},o=t.onComplete||r,i=t.onChange||r,n=this;return fabric.util.animate({startValue:e.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),n.requestRenderAll(),i()},onComplete:function(){e.setCoords(),o()}}),this},fxRemove:function(e,t){t=t||{};var r=function(){},o=t.onComplete||r,i=t.onChange||r,n=this;return fabric.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){e.set("opacity",t),n.requestRenderAll(),i()},onComplete:function(){n.remove(e),o()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var e=[],t,r;for(t in arguments[0])e.push(t);for(var o=0,n=e.length;o<n;o++)t=e[o],r=o!=n-1,this._animate(t,arguments[0][t],arguments[1],r)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,r,o){var i=this,n;t=t.toString(),r=r?fabric.util.object.clone(r):{},~e.indexOf(".")&&(n=e.split("."));var a=n?this.get(n[0])[n[1]]:this.get(e);"from"in r||(r.from=a),t=~t.indexOf("=")?a+parseFloat(t.replace("=","")):parseFloat(t),fabric.util.animate({startValue:r.from,endValue:t,byValue:r.by,easing:r.easing,duration:r.duration,abort:r.abort&&function(){return r.abort.call(i)},onChange:function(t,a,s){n?i[n[0]][n[1]]=t:i.set(e,t);o||r.onChange&&r.onChange(t,a,s)},onComplete:function(e,t,n){o||(i.setCoords(),r.onComplete&&r.onComplete(e,t,n))}})}}),function(e){'use strict';var r=Math.abs,o=Math.min;function t(e,t){var r=e.origin,i=e.axis1,n=e.axis2,a=e.dimension,s=t.nearest,l=t.center,c=t.farthest;return function(){switch(this.get(r)){case s:return o(this.get(i),this.get(n));case l:return o(this.get(i),this.get(n))+.5*this.get(a);case c:return Math.max(this.get(i),this.get(n));}}}var i=e.fabric||(e.fabric={}),n=i.util.object.extend,a=i.util.object.clone,s={x1:1,x2:1,y1:1,y2:1},l=i.StaticCanvas.supports("setLineDash");return i.Line?void i.warn("fabric.Line is already defined"):void(i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:i.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,t){e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=r(this.x2-this.x1),this.height=r(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this.callSuper("_set",e,t),"undefined"!=typeof s[e]&&this._setWidthHeight(),this},_getLeftToOriginX:t({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:t({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){if(e.beginPath(),!this.strokeDashArray||this.strokeDashArray&&l){var t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2)}e.lineWidth=this.strokeWidth;var r=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=r},_renderDashedStroke:function(e){var t=this.calcLinePoints();e.beginPath(),i.util.drawDashedLine(e,t.x1,t.y1,t.x2,t.y2,this.strokeDashArray),e.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return n(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,r=.5*(e*this.width),o=.5*(t*this.height),i=-.5*(e*this.width),n=-.5*(t*this.height);return{x1:r,x2:i,y1:o,y2:n}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS","x1=\"",e.x1,"\" y1=\"",e.y1,"\" x2=\"",e.x2,"\" y2=\"",e.y2,"\" />\n"]}}),i.Line.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),i.Line.fromElement=function(e,t,r){r=r||{};var o=i.parseAttributes(e,i.Line.ATTRIBUTE_NAMES),a=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];t(new i.Line(a,n(o,r)))},i.Line.fromObject=function(e,t){var r=a(e,!0);r.points=[e.x1,e.y1,e.x2,e.y2],i.Object._fromObject("Line",r,function(e){delete e.points,t&&t(e)},"points")})}("undefined"==typeof exports?this:exports),function(e){'use strict';function t(e){return"radius"in e&&0<=e.radius}var r=e.fabric||(e.fabric={}),o=Math.PI;return r.Circle?void r.warn("fabric.Circle is already defined."):void(r.Circle=r.util.createClass(r.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*o,cacheProperties:r.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,t){return this.callSuper("_set",e,t),"radius"===e&&this.setRadius(t),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e=(this.endAngle-this.startAngle)%(2*o),t;if(0==e)t=["<circle ","COMMON_PARTS","cx=\"0\" cy=\"0\" ","r=\"",this.radius,"\" />\n"];else{var i=r.util.cos(this.startAngle)*this.radius,n=r.util.sin(this.startAngle)*this.radius,a=r.util.cos(this.endAngle)*this.radius,s=r.util.sin(this.endAngle)*this.radius,l=e>o?"1":"0";t=["<path d=\"M "+i+" "+n," A "+this.radius+" "+this.radius," 0 ",+l+" 1"," "+a+" "+s,"\" ","COMMON_PARTS"," />\n"]}return t},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",2*e).set("height",2*e)}}),r.Circle.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),r.Circle.fromElement=function(e,o){var i=r.parseAttributes(e,r.Circle.ATTRIBUTE_NAMES);if(!t(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,o(new r.Circle(i))},r.Circle.fromObject=function(e,t){return r.Object._fromObject("Circle",e,t)})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={});return t.Triangle?void t.warn("fabric.Triangle is already defined"):void(t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(e){var t=this.width/2,r=this.height/2;e.beginPath(),e.moveTo(-t,r),e.lineTo(0,-r),e.lineTo(t,r),e.closePath(),this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var r=this.width/2,o=this.height/2;e.beginPath(),t.util.drawDashedLine(e,-r,o,0,-o,this.strokeDashArray),t.util.drawDashedLine(e,0,-o,r,o,this.strokeDashArray),t.util.drawDashedLine(e,r,o,-r,o,this.strokeDashArray),e.closePath()},_toSVG:function(){var e=this.width/2,t=this.height/2,r=[-e+" "+t,"0 "+-t,e+" "+t].join(",");return["<polygon ","COMMON_PARTS","points=\"",r,"\" />"]}}),t.Triangle.fromObject=function(e,r){return t.Object._fromObject("Triangle",e,r)})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=2*Math.PI;return t.Ellipse?void t.warn("fabric.Ellipse is already defined."):void(t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this.set("rx",e&&e.rx||0),this.set("ry",e&&e.ry||0)},_set:function(e,t){return this.callSuper("_set",e,t),"rx"===e?(this.rx=t,this.set("width",2*t)):"ry"===e?(this.ry=t,this.set("height",2*t)):void 0,this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<ellipse ","COMMON_PARTS","cx=\"0\" cy=\"0\" ","rx=\"",this.rx,"\" ry=\"",this.ry,"\" />\n"]},_render:function(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,r,!1),e.restore(),this._renderPaintInOrder(e)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),t.Ellipse.fromElement=function(e,r){var o=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);o.left=(o.left||0)-o.rx,o.top=(o.top||0)-o.ry,r(new t.Ellipse(o))},t.Ellipse.fromObject=function(e,r){return t.Object._fromObject("Ellipse",e,r)})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.min,r=e.fabric||(e.fabric={}),o=r.util.object.extend;return r.Rect?void r.warn("fabric.Rect is already defined"):void(r.Rect=r.util.createClass(r.Object,{stateProperties:r.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:r.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e){var r=this.rx?t(this.rx,this.width/2):0,o=this.ry?t(this.ry,this.height/2):0,i=this.width,n=this.height,a=-this.width/2,s=-this.height/2,l=0!==r||0!==o,c=1-.5522847498;e.beginPath(),e.moveTo(a+r,s),e.lineTo(a+i-r,s),l&&e.bezierCurveTo(a+i-c*r,s,a+i,s+c*o,a+i,s+o),e.lineTo(a+i,s+n-o),l&&e.bezierCurveTo(a+i,s+n-c*o,a+i-c*r,s+n,a+i-r,s+n),e.lineTo(a+r,s+n),l&&e.bezierCurveTo(a+c*r,s+n,a,s+n-c*o,a,s+n-o),e.lineTo(a,s+o),l&&e.bezierCurveTo(a,s+c*o,a+c*r,s,a+r,s),e.closePath(),this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var t=-this.width/2,o=-this.height/2,i=this.width,n=this.height;e.beginPath(),r.util.drawDashedLine(e,t,o,t+i,o,this.strokeDashArray),r.util.drawDashedLine(e,t+i,o,t+i,o+n,this.strokeDashArray),r.util.drawDashedLine(e,t+i,o+n,t,o+n,this.strokeDashArray),r.util.drawDashedLine(e,t,o+n,t,o,this.strokeDashArray),e.closePath()},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){var e=-this.width/2,t=-this.height/2;return["<rect ","COMMON_PARTS","x=\"",e,"\" y=\"",t,"\" rx=\"",this.rx,"\" ry=\"",this.ry,"\" width=\"",this.width,"\" height=\"",this.height,"\" />\n"]}}),r.Rect.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(["x","y","rx","ry","width","height"]),r.Rect.fromElement=function(e,t,i){if(!e)return t(null);i=i||{};var n=r.parseAttributes(e,r.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0,n.height=n.height||0,n.width=n.width||0;var a=new r.Rect(o(i?r.util.object.clone(i):{},n));a.visible=a.visible&&0<a.width&&0<a.height,t(a)},r.Rect.fromObject=function(e,t){return r.Object._fromObject("Rect",e,t)})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.util.object.extend,o=t.util.array.min,i=t.util.array.max,n=t.util.toFixed;return t.Polyline?void t.warn("fabric.Polyline is already defined"):void(t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(e,t){t=t||{},this.points=e||[],this.callSuper("initialize",t),this._setPositionDimensions(t)},_setPositionDimensions:function(e){var t=this._calcDimensions(e),r;this.width=t.width,this.height=t.height,e.fromSVG||(r=this.translateToGivenOrigin({x:t.left-this.strokeWidth/2,y:t.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),"undefined"==typeof e.left&&(this.left=e.fromSVG?t.left:r.x),"undefined"==typeof e.top&&(this.top=e.fromSVG?t.top:r.y),this.pathOffset={x:t.left+this.width/2,y:t.top+this.height/2}},_calcDimensions:function(){var e=this.points,t=o(e,"x")||0,r=o(e,"y")||0,n=i(e,"x")||0,a=i(e,"y")||0;return{left:t,top:r,width:n-t,height:a-r}},toObject:function(e){return r(this.callSuper("toObject",e),{points:this.points.concat()})},_toSVG:function(){for(var e=[],r=this.pathOffset.x,o=this.pathOffset.y,a=t.Object.NUM_FRACTION_DIGITS,s=0,l=this.points.length;s<l;s++)e.push(n(this.points[s].x-r,a),",",n(this.points[s].y-o,a)," ");return["<"+this.type+" ","COMMON_PARTS","points=\"",e.join(""),"\" />\n"]},commonRender:function(e){var t=this.points.length,r=this.pathOffset.x,o=this.pathOffset.y,n;if(!t||isNaN(this.points[t-1].y))return!1;e.beginPath(),e.moveTo(this.points[0].x-r,this.points[0].y-o);for(var a=0;a<t;a++)n=this.points[a],e.lineTo(n.x-r,n.y-o);return!0},_render:function(e){this.commonRender(e)&&this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var r,o;e.beginPath();for(var n=0,a=this.points.length;n<a;n++)r=this.points[n],o=this.points[n+1]||r,t.util.drawDashedLine(e,r.x,r.y,o.x,o.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(e){return function(o,i,n){if(!o)return i(null);n||(n={});var a=t.parsePointsAttribute(o.getAttribute("points")),s=t.parseAttributes(o,t[e].ATTRIBUTE_NAMES);s.fromSVG=!0,i(new t[e](a,r(s,n)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(e,r){return t.Object._fromObject("Polyline",e,r,"points")})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={});return t.Polygon?void t.warn("fabric.Polygon is already defined"):void(t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_render:function(e){this.commonRender(e)&&(e.closePath(),this._renderPaintInOrder(e))},_renderDashedStroke:function(e){this.callSuper("_renderDashedStroke",e),e.closePath()}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(e,r){return t.Object._fromObject("Polygon",e,r,"points")})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.util.array.min,o=t.util.array.max,i=t.util.object.extend,n=Object.prototype.toString,a=t.util.drawArc,s=t.util.toFixed,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};return t.Path?void t.warn("fabric.Path is already defined"):void(t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(e,r){r=r||{},this.callSuper("initialize",r),e||(e=[]);var o="[object Array]"===n.call(e);this.path=o?e:e.match&&e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);this.path&&(!o&&(this.path=this._parsePath()),t.Polyline.prototype._setPositionDimensions.call(this,r))},_renderPathCommands:function(e){var r=null,o=0,n=0,s=0,c=0,d=0,g=0,u=-this.pathOffset.x,l=-this.pathOffset.y,t,p,h;e.beginPath();for(var f=0,m=this.path.length;f<m;++f){switch(t=this.path[f],t[0]){case"l":s+=t[1],c+=t[2],e.lineTo(s+u,c+l);break;case"L":s=t[1],c=t[2],e.lineTo(s+u,c+l);break;case"h":s+=t[1],e.lineTo(s+u,c+l);break;case"H":s=t[1],e.lineTo(s+u,c+l);break;case"v":c+=t[1],e.lineTo(s+u,c+l);break;case"V":c=t[1],e.lineTo(s+u,c+l);break;case"m":s+=t[1],c+=t[2],o=s,n=c,e.moveTo(s+u,c+l);break;case"M":s=t[1],c=t[2],o=s,n=c,e.moveTo(s+u,c+l);break;case"c":p=s+t[5],h=c+t[6],d=s+t[3],g=c+t[4],e.bezierCurveTo(s+t[1]+u,c+t[2]+l,d+u,g+l,p+u,h+l),s=p,c=h;break;case"C":s=t[5],c=t[6],d=t[3],g=t[4],e.bezierCurveTo(t[1]+u,t[2]+l,d+u,g+l,s+u,c+l);break;case"s":p=s+t[3],h=c+t[4],null===r[0].match(/[CcSs]/)?(d=s,g=c):(d=2*s-d,g=2*c-g),e.bezierCurveTo(d+u,g+l,s+t[1]+u,c+t[2]+l,p+u,h+l),d=s+t[1],g=c+t[2],s=p,c=h;break;case"S":p=t[3],h=t[4],null===r[0].match(/[CcSs]/)?(d=s,g=c):(d=2*s-d,g=2*c-g),e.bezierCurveTo(d+u,g+l,t[1]+u,t[2]+l,p+u,h+l),s=p,c=h,d=t[1],g=t[2];break;case"q":p=s+t[3],h=c+t[4],d=s+t[1],g=c+t[2],e.quadraticCurveTo(d+u,g+l,p+u,h+l),s=p,c=h;break;case"Q":p=t[3],h=t[4],e.quadraticCurveTo(t[1]+u,t[2]+l,p+u,h+l),s=p,c=h,d=t[1],g=t[2];break;case"t":p=s+t[1],h=c+t[2],null===r[0].match(/[QqTt]/)?(d=s,g=c):(d=2*s-d,g=2*c-g),e.quadraticCurveTo(d+u,g+l,p+u,h+l),s=p,c=h;break;case"T":p=t[1],h=t[2],null===r[0].match(/[QqTt]/)?(d=s,g=c):(d=2*s-d,g=2*c-g),e.quadraticCurveTo(d+u,g+l,p+u,h+l),s=p,c=h;break;case"a":a(e,s+u,c+l,[t[1],t[2],t[3],t[4],t[5],t[6]+s+u,t[7]+c+l]),s+=t[6],c+=t[7];break;case"A":a(e,s+u,c+l,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+l]),s=t[6],c=t[7];break;case"z":case"Z":s=o,c=n,e.closePath();}r=t}},_render:function(e){this._renderPathCommands(e),this._renderPaintInOrder(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+"): { \"top\": "+this.top+", \"left\": "+this.left+" }>"},toObject:function(e){return i(this.callSuper("toObject",e),{path:this.path.map(function(e){return e.slice()})})},toDatalessObject:function(e){var t=this.toObject(["sourcePath"].concat(e));return t.sourcePath&&delete t.path,t},_toSVG:function(){var e=this.path.map(function(e){return e.join(" ")}).join(" ");return["<path ","COMMON_PARTS","d=\"",e,"\" stroke-linecap=\"round\" ","/>\n"]},_getOffsetTransform:function(){var e=t.Object.NUM_FRACTION_DIGITS;return" translate("+s(-this.pathOffset.x,e)+", "+s(-this.pathOffset.y,e)+")"},toClipPathSVG:function(e){var t=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},toSVG:function(e){var t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},complexity:function(){return this.path.length},_parsePath:function(){for(var e=[],r=[],o=t.rePathCommand,n=0,a=this.path.length,s,d,g,u,p;n<a;n++){for(s=this.path[n],u=s.slice(1).trim(),r.length=0;g=o.exec(u);)r.push(g[0]);p=[s.charAt(0)];for(var h=0,f=r.length;h<f;h++)d=parseFloat(r[h]),isNaN(d)||p.push(d);var m=p[0],_=l[m.toLowerCase()],y=c[m]||m;if(p.length-1>_)for(var x=1,v=p.length;x<v;x+=_)e.push([m].concat(p.slice(x,x+_))),m=y;else e.push(p)}return e},_calcDimensions:function(){for(var e=[],n=[],a=null,s=0,l=0,c=0,d=0,g=0,u=0,p=0,h=this.path.length,f,m,_,v;p<h;++p){switch(f=this.path[p],f[0]){case"l":c+=f[1],d+=f[2],v=[];break;case"L":c=f[1],d=f[2],v=[];break;case"h":c+=f[1],v=[];break;case"H":c=f[1],v=[];break;case"v":d+=f[1],v=[];break;case"V":d=f[1],v=[];break;case"m":c+=f[1],d+=f[2],s=c,l=d,v=[];break;case"M":c=f[1],d=f[2],s=c,l=d,v=[];break;case"c":m=c+f[5],_=d+f[6],g=c+f[3],u=d+f[4],v=t.util.getBoundsOfCurve(c,d,c+f[1],d+f[2],g,u,m,_),c=m,d=_;break;case"C":g=f[3],u=f[4],v=t.util.getBoundsOfCurve(c,d,f[1],f[2],g,u,f[5],f[6]),c=f[5],d=f[6];break;case"s":m=c+f[3],_=d+f[4],null===a[0].match(/[CcSs]/)?(g=c,u=d):(g=2*c-g,u=2*d-u),v=t.util.getBoundsOfCurve(c,d,g,u,c+f[1],d+f[2],m,_),g=c+f[1],u=d+f[2],c=m,d=_;break;case"S":m=f[3],_=f[4],null===a[0].match(/[CcSs]/)?(g=c,u=d):(g=2*c-g,u=2*d-u),v=t.util.getBoundsOfCurve(c,d,g,u,f[1],f[2],m,_),c=m,d=_,g=f[1],u=f[2];break;case"q":m=c+f[3],_=d+f[4],g=c+f[1],u=d+f[2],v=t.util.getBoundsOfCurve(c,d,g,u,g,u,m,_),c=m,d=_;break;case"Q":g=f[1],u=f[2],v=t.util.getBoundsOfCurve(c,d,g,u,g,u,f[3],f[4]),c=f[3],d=f[4];break;case"t":m=c+f[1],_=d+f[2],null===a[0].match(/[QqTt]/)?(g=c,u=d):(g=2*c-g,u=2*d-u),v=t.util.getBoundsOfCurve(c,d,g,u,g,u,m,_),c=m,d=_;break;case"T":m=f[1],_=f[2],null===a[0].match(/[QqTt]/)?(g=c,u=d):(g=2*c-g,u=2*d-u),v=t.util.getBoundsOfCurve(c,d,g,u,g,u,m,_),c=m,d=_;break;case"a":v=t.util.getBoundsOfArc(c,d,f[1],f[2],f[3],f[4],f[5],f[6]+c,f[7]+d),c+=f[6],d+=f[7];break;case"A":v=t.util.getBoundsOfArc(c,d,f[1],f[2],f[3],f[4],f[5],f[6],f[7]),c=f[6],d=f[7];break;case"z":case"Z":c=s,d=l;}a=f,v.forEach(function(t){e.push(t.x),n.push(t.y)}),e.push(c),n.push(d)}var C=r(e)||0,b=r(n)||0,S=o(e)||0,T=o(n)||0;return{left:C,top:b,width:S-C,height:T-b}}}),t.Path.fromObject=function(e,r){if("string"==typeof e.sourcePath){var o=e.sourcePath;t.loadSVGFromURL(o,function(t){var o=t[0];o.setOptions(e),r&&r(o)})}else t.Object._fromObject("Path",e,r,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,r,o){var n=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);n.fromSVG=!0,r(new t.Path(n.d,i(n,o)))})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.util.array.min,o=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,t,r){t=t||{},this._objects=[],r&&this.callSuper("initialize",t),this._objects=e||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(!r){var n=t&&t.centerPoint;t.originX!==void 0&&(this.originX=t.originX),t.originY!==void 0&&(this.originY=t.originY),n||this._calcBounds(),this._updateObjectsCoords(n),delete t.centerPoint,this.callSuper("initialize",t)}else this._updateObjectsACoords();this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0,!0)},_updateObjectsCoords:function(e){for(var e=e||this.getCenterPoint(),t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],e)},_updateObjectCoords:function(e,t){var r=e.left,o=e.top;e.set({left:r-t.x,top:o-t.y}),e.group=this,e.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),e&&(this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,r){var o=this._objects.length;if(this.useSetOnGroup)for(;o--;)this._objects[o].setOnGroup(e,r);if("canvas"===e)for(;o--;)this._objects[o]._set(e,r);t.Object.prototype._set.call(this,e,r)},toObject:function(e){var r=this.includeDefaultValues,o=this._objects.map(function(t){var o=t.includeDefaultValues;t.includeDefaultValues=r;var i=t.toObject(e);return t.includeDefaultValues=o,i}),i=t.Object.prototype.toObject.call(this,e);return i.objects=o,i},toDatalessObject:function(e){var r=this.sourcePath,o;if(r)o=r;else{var i=this.includeDefaultValues;o=this._objects.map(function(t){var r=t.includeDefaultValues;t.includeDefaultValues=i;var o=t.toDatalessObject(e);return t.includeDefaultValues=r,o})}var n=t.Object.prototype.toDatalessObject.call(this,e);return n.objects=o,n},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=t.Object.prototype.shouldCache.call(this);if(e)for(var r=0,o=this._objects.length;r<o;r++)if(this._objects[r].willDrawShadow())return this.ownCaching=!1,!1;return e},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var e=0,r=this._objects.length;e<r;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var t=0,r=this._objects.length;t<r;t++)this._objects[t].render(e);this._drawClipPath(e)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var t=0,r=this._objects.length;t<r;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-n/2,o,n)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(e){var r=e.calcTransformMatrix(),o=t.util.qrDecompose(r),i=new t.Point(o.translateX,o.translateY);return e.flipX=!1,e.flipY=!1,e.set("scaleX",o.scaleX),e.set("scaleY",o.scaleY),e.skewX=o.skewX,e.skewY=o.skewY,e.angle=o.angle,e.setPositionByOrigin(i,"center","center"),e},_restoreObjectState:function(e){return this.realizeTransform(e),e.setCoords(),delete e.group,this},destroy:function(){return this._objects.forEach(function(e){e.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var e=this._objects,r=this.canvas;this._objects=[];var o=this.toObject();delete o.objects;var i=new t.ActiveSelection([]);return i.set(o),i.type="activeSelection",r.remove(this),e.forEach(function(e){e.group=i,e.dirty=!0,r.add(e)}),i.canvas=r,i._objects=e,r._activeObject=i,i.setCoords(),i}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(e){e.setCoords(!0,!0)}),this},_calcBounds:function(e){for(var t=[],r=[],n=["tr","br","bl","tl"],a=0,s=this._objects.length,l=n.length,c,d,g;a<s;++a)for(c=this._objects[a],c.setCoords(!0),g=0;g<l;g++)d=n[g],t.push(c.oCoords[d].x),r.push(c.oCoords[d].y);this._getBounds(t,r,e)},_getBounds:function(e,i,n){var a=new t.Point(r(e),r(i)),s=new t.Point(o(e),o(i)),l=a.y||0,c=a.x||0,d=s.x-a.x||0,g=s.y-a.y||0;this.width=d,this.height=g,n||this.setPositionByOrigin({x:c,y:l},"left","top")},_toSVG:function(e){for(var t=["<g ","COMMON_PARTS"," >\n"],r=0,o=this._objects.length;r<o;r++)t.push("\t\t",this._objects[r].toSVG(e));return t.push("</g>\n"),t},getSvgStyles:function(){var e="undefined"!=typeof this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")},toClipPathSVG:function(e){for(var t=[],r=0,o=this._objects.length;r<o;r++)t.push("\t",this._objects[r].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}}),t.Group.fromObject=function(e,r){var o=e.objects,i=t.util.object.clone(e,!0);return delete i.objects,"string"==typeof o?void t.loadSVGFromURL(o,function(n){var a=t.util.groupSVGElements(n,e,o);a.set(i),r&&r(a)}):void t.util.enlivenObjects(o,function(o){t.util.enlivenObjects([e.clipPath],function(i){var n=t.util.object.clone(e,!0);n.clipPath=i[0],delete n.objects,r&&r(new t.Group(o,n,!0))})})})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(e,r){r=r||{},this._objects=e||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;r.originX&&(this.originX=r.originX),r.originY&&(this.originY=r.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,r),this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var r=t.Object.prototype.toObject.call(this),o=new t.Group([]);if(delete r.type,o.set(r),e.forEach(function(e){e.canvas.remove(e),e.group=o}),o._objects=e,!this.canvas)return o;var i=this.canvas;return i.add(o),i._activeObject=o,o.setCoords(),o},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(e,t,r){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",e,t),r=r||{},"undefined"==typeof r.hasControls&&(r.hasControls=!1),"undefined"==typeof r.hasRotatingPoint&&(r.hasRotatingPoint=!1),r.forActiveSelection=!0;for(var o=0,n=this._objects.length;o<n;o++)this._objects[o]._renderControls(e,r);e.restore()}}),t.ActiveSelection.fromObject=function(e,r){t.util.enlivenObjects(e.objects,function(o){delete e.objects,r&&r(new t.ActiveSelection(o,e,!0))})})}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.max,r=Math.min,o=fabric.util.object.extend;return e.fabric||(e.fabric={}),e.fabric.Image?void fabric.warn("fabric.Image is already defined."):void(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(e,t){t||(t={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",t),this._initElement(e,t)},getElement:function(){return this._element||{}},setElement:function(e,t){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=e,this._originalElement=e,this._initConfig(t),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(e){var t=fabric.filterBackend;t&&t.evictCachesForKey&&t.evictCachesForKey(e)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(e){fabric.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this))},setCrossOrigin:function(e){return this.crossOrigin=e,this._element.crossOrigin=e,this},getOriginalSize:function(){var e=this.getElement();return{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}},_stroke:function(e){if(this.stroke&&0!==this.strokeWidth){var t=this.width/2,r=this.height/2;e.beginPath(),e.moveTo(-t,-r),e.lineTo(t,-r),e.lineTo(t,r),e.lineTo(-t,r),e.lineTo(-t,-r),e.closePath()}},_renderDashedStroke:function(e){var t=-this.width/2,r=-this.height/2,o=this.width,i=this.height;e.save(),this._setStrokeStyles(e,this),e.beginPath(),fabric.util.drawDashedLine(e,t,r,t+o,r,this.strokeDashArray),fabric.util.drawDashedLine(e,t+o,r,t+o,r+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t+o,r+i,t,r+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t,r+i,t,r,this.strokeDashArray),e.closePath(),e.restore()},toObject:function(e){var t=[];this.filters.forEach(function(e){e&&t.push(e.toObject())});var r=o(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(e)),{src:this.getSrc(),filters:t});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var e=[],t=[],r=-this.width/2,o=-this.height/2,i="",n;if(this.hasCrop()){var a=fabric.Object.__uid++;e.push("<clipPath id=\"imageCrop_"+a+"\">\n","\t<rect x=\""+r+"\" y=\""+o+"\" width=\""+this.width+"\" height=\""+this.height+"\" />\n","</clipPath>\n"),i=" clip-path=\"url(#imageCrop_"+a+")\" "}if(t.push("\t<image ","COMMON_PARTS","xlink:href=\"",this.getSvgSrc(!0),"\" x=\"",r-this.cropX,"\" y=\"",o-this.cropY,"\" width=\"",this._element.width||this._element.naturalWidth,"\" height=\"",this._element.height||this._element.height,"\"",i,"></image>\n"),this.stroke||this.strokeDashArray){var s=this.fill;this.fill=null,n=["\t<rect ","x=\"",r,"\" y=\"",o,"\" width=\"",this.width,"\" height=\"",this.height,"\" style=\"",this.getSvgStyles(),"\"/>\n"],this.fill=s}return e="fill"===this.paintFirst?e.concat(t,n):e.concat(n,t),e},getSrc:function(e){var t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src"):t.src:this.src||""},setSrc:function(e,t,r){return fabric.util.loadImage(e,function(e){this.setElement(e,r),this._setWidthHeight(),t&&t(this)},this,r&&r.crossOrigin),this},toString:function(){return"#<fabric.Image: { src: \""+this.getSrc()+"\" }>"},applyResizeFilters:function(){var e=this.resizeFilter,t=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),o=r.scaleX,i=r.scaleY,n=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||o>t&&i>t)return this._element=n,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=o,void(this._lastScaleY=i);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var a=fabric.util.createCanvasElement(),s=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=n.width,c=n.height;a.width=l,a.height=c,this._element=a,this._lastScaleX=e.scaleX=o,this._lastScaleY=e.scaleY=i,fabric.filterBackend.applyFilters([e],n,l,c,this._element,s),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height},applyFilters:function(e){if(e=e||this.filters||[],e=e.filter(function(e){return e&&!e.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===e.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,r=t.naturalWidth||t.width,o=t.naturalHeight||t.height;if(this._element===this._originalElement){var i=fabric.util.createCanvasElement();i.width=r,i.height=o,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,o),this._lastScaleX=1,this._lastScaleY=1;return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(e,this._originalElement,r,o,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(e){!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(e){var o=this._element,i=this.width,n=this.height,a=r(o.naturalWidth||o.width,i*this._filterScalingX),s=r(o.naturalHeight||o.height,n*this._filterScalingY),l=t(0,this.cropX*this._filterScalingX),c=t(0,this.cropY*this._filterScalingY);o&&e.drawImage(o,l,c,a,s,-i/2,-n/2,i,n)},_needsResize:function(){var e=this.getTotalObjectScaling();return e.scaleX!==this._lastScaleX||e.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(e,t){this.setElement(fabric.util.getById(e),t),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(e,t){e&&e.length?fabric.util.enlivenObjects(e,function(e){t&&t(e)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){e||(e={});var t=this.getElement();this.width=e.width||t.naturalWidth||t.width||0,this.height=e.height||t.naturalHeight||t.height||0},parsePreserveAspectRatioAttribute:function(){var e=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),t=this._element.width,r=this._element.height,o=1,i=1,n=0,a=0,s=0,l=0,c=this.width,d=this.height,g={width:c,height:d},u;return e&&("none"!==e.alignX||"none"!==e.alignY)?("meet"===e.meetOrSlice&&(o=i=fabric.util.findScaleToFit(this._element,g),u=(c-t*o)/2,"Min"===e.alignX&&(n=-u),"Max"===e.alignX&&(n=u),u=(d-r*i)/2,"Min"===e.alignY&&(a=-u),"Max"===e.alignY&&(a=u)),"slice"===e.meetOrSlice&&(o=i=fabric.util.findScaleToCover(this._element,g),u=t-c/o,"Mid"===e.alignX&&(s=u/2),"Max"===e.alignX&&(s=u),u=r-d/i,"Mid"===e.alignY&&(l=u/2),"Max"===e.alignY&&(l=u),t=c/o,r=d/i)):(o=c/t,i=d/r),{width:t,height:r,scaleX:o,scaleY:i,offsetLeft:n,offsetTop:a,cropX:s,cropY:l}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(e,t){var r=fabric.util.object.clone(e);fabric.util.loadImage(r.src,function(e,o){return o?void(t&&t(null,o)):void fabric.Image.prototype._initFilters.call(r,r.filters,function(o){r.filters=o||[],fabric.Image.prototype._initFilters.call(r,[r.resizeFilter],function(o){r.resizeFilter=o[0],fabric.util.enlivenObjects([r.clipPath],function(o){r.clipPath=o[0];var i=new fabric.Image(e,r);t(i)})})})},null,r.crossOrigin)},fabric.Image.fromURL=function(e,t,r){fabric.util.loadImage(e,function(e){t&&t(new fabric.Image(e,r))},null,r&&r.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin"]),fabric.Image.fromElement=function(e,t,r){var i=fabric.parseAttributes(e,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(i["xlink:href"],t,o(r?fabric.util.object.clone(r):{},i))})}("undefined"==typeof exports?this:exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=Math.round,t=this.angle%360;return 0<t?90*e((t-1)/90):90*e(t/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(e){e=e||{};var t=function(){},r=e.onComplete||t,o=e.onChange||t,i=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){i.rotate(e),o()},onComplete:function(){i.setCoords(),r()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){'use strict';function e(e,t){var r=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(r,"precision "+t+" float;\nvoid main(){}"),e.compileShader(r),!!e.getShaderParameter(r,e.COMPILE_STATUS)}function t(e){e&&e.tileSize&&(this.tileSize=e.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}fabric.isWebglSupported=function(t){if(fabric.isLikelyNode)return!1;t=t||fabric.WebglFilterBackend.prototype.tileSize;var r=document.createElement("canvas"),o=r.getContext("webgl")||r.getContext("experimental-webgl"),n=!1;if(o){fabric.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),n=fabric.maxTextureSize>=t;for(var a=["highp","mediump","lowp"],s=0;3>s;s++)if(e(o,a[s])){fabric.webGlPrecision=a[s];break}}return this.isSupported=n,n},fabric.WebglFilterBackend=t;t.prototype={tileSize:2048,resources:{},setupGLContext:function(e,t){this.dispose(),this.createWebGLCanvas(e,t),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(e,t)},chooseFastestCopyGLTo2DMethod:function(e,t){var r="undefined"!=typeof window.performance,o;try{new ImageData(1,1),o=!0}catch(t){o=!1}var i="undefined"!=typeof ArrayBuffer,n="undefined"!=typeof Uint8ClampedArray;if(r&&o&&i&&n){var a=fabric.util.createCanvasElement(),s=new ArrayBuffer(4*(e*t));if(fabric.forceGLPutImageData)return this.imageBuffer=s,void(this.copyGLTo2D=copyGLTo2DPutImageData);var l={imageBuffer:s,destinationWidth:e,destinationHeight:t,targetCanvas:a},c,d,g;a.width=e,a.height=t,c=window.performance.now(),copyGLTo2DDrawImage.call(l,this.gl,l),d=window.performance.now()-c,c=window.performance.now(),copyGLTo2DPutImageData.call(l,this.gl,l),g=window.performance.now()-c,d>g?(this.imageBuffer=s,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(e,t){var r=fabric.util.createCanvasElement();r.width=e,r.height=t;var o={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=r.getContext("webgl",o);i||(i=r.getContext("experimental-webgl",o));i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)},applyFilters:function(e,t,r,o,i,n){var a=this.gl,s;n&&(s=this.getCachedTexture(n,t));var l={originalWidth:t.width||t.originalWidth,originalHeight:t.height||t.originalHeight,sourceWidth:r,sourceHeight:o,destinationWidth:r,destinationHeight:o,context:a,sourceTexture:this.createTexture(a,r,o,!s&&t),targetTexture:this.createTexture(a,r,o),originalTexture:s||this.createTexture(a,r,o,!s&&t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},c=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,c),e.forEach(function(e){e&&e.applyTo(l)}),resizeCanvasIfNeeded(l),this.copyGLTo2D(a,l),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(l.sourceTexture),a.deleteTexture(l.targetTexture),a.deleteFramebuffer(c),i.getContext("2d").setTransform(1,0,0,1,0,0),l},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(e,t,r,o){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),i},getCachedTexture:function(e,t){if(this.textureCache[e])return this.textureCache[e];var r=this.createTexture(this.gl,t.width,t.height,t);return this.textureCache[e]=r,r},evictCachesForKey:function(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var e=this.gl,t={renderer:"",vendor:""};if(!e)return t;var r=e.getExtension("WEBGL_debug_renderer_info");if(r){var o=e.getParameter(r.UNMASKED_RENDERER_WEBGL),i=e.getParameter(r.UNMASKED_VENDOR_WEBGL);o&&(t.renderer=o.toLowerCase()),i&&(t.vendor=i.toLowerCase())}return this.gpuInfo=t,t}}}();function resizeCanvasIfNeeded(e){var t=e.targetCanvas,r=t.width,o=t.height,i=e.destinationWidth,n=e.destinationHeight;(r!==i||o!==n)&&(t.width=i,t.height=n)}function copyGLTo2DDrawImage(e,t){var r=e.canvas,o=t.targetCanvas,i=o.getContext("2d");i.translate(0,o.height),i.scale(1,-1);var n=r.height-o.height;i.drawImage(r,0,n,o.width,o.height,0,0,o.width,o.height)}function copyGLTo2DPutImageData(e,t){var r=t.targetCanvas,o=r.getContext("2d"),i=t.destinationWidth,n=t.destinationHeight,a=4*(i*n),s=new Uint8Array(this.imageBuffer,0,a),l=new Uint8ClampedArray(this.imageBuffer,0,a);e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,s);var c=new ImageData(l,i,n);o.putImageData(c,0,0)}(function(){'use strict';function e(){}var t=function(){};fabric.Canvas2dFilterBackend=e;e.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(e,t,r,o,i){var n=i.getContext("2d");n.drawImage(t,0,0,r,o);var a=n.getImageData(0,0,r,o),s=n.getImageData(0,0,r,o),l={sourceWidth:r,sourceHeight:o,imageData:a,originalEl:t,originalImageData:s,canvasEl:i,ctx:n,filterBackend:this};return e.forEach(function(e){e.applyTo(l)}),(l.imageData.width!==r||l.imageData.height!==o)&&(i.width=l.imageData.width,i.height=l.imageData.height),n.putImageData(l.imageData,0,0),l}}})(),fabric.Image=fabric.Image||{},fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,r){t=t||this.fragmentSource,r=r||this.vertexSource,"highp"!==fabric.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var o=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(o));var i=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(i));var n=e.createProgram();if(e.attachShader(n,o),e.attachShader(n,i),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error("Shader link error for \"${this.type}\" "+e.getProgramInfoLog(n));var a=this.getAttributeLocations(e,n),s=this.getUniformLocations(e,n)||{};return s.uStepW=e.getUniformLocation(n,"uStepW"),s.uStepH=e.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:a,uniformLocations:s}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,r){var o=t.aPosition,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t=e.context,r,o;1<e.passes?(r=e.destinationWidth,o=e.destinationHeight,(e.sourceWidth!==r||e.sourceHeight!==o)&&(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,r,o)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=fabric.Image.filters[this.type].prototype;if(e){if(Array.isArray(t[e])){for(var r=t[e].length;r--;)if(this[e][r]!==t[e][r])return!1;return!0}return t[e]===this[e]}return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,r=this.retrieveShader(e);0===e.pass&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(r.program),this.sendAttributeData(t,r.attributeLocations,e.aPosition),t.uniform1f(r.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(r.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,r.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,r){e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(e,t){var r=new fabric.Image.filters[e.type](e);return t&&t(r),r},function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.Image.filters,o=t.util.createClass;r.ColorMatrix=o(r.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var t=e.imageData,o=t.data,n=o.length,s=this.matrix,l=this.colorsOnly,c,d,u,p,h;for(h=0;h<n;h+=4)c=o[h],d=o[h+1],u=o[h+2],l?(o[h]=c*s[0]+d*s[1]+u*s[2]+255*s[4],o[h+1]=c*s[5]+d*s[6]+u*s[7]+255*s[9],o[h+2]=c*s[10]+d*s[11]+u*s[12]+255*s[14]):(p=o[h+3],o[h]=c*s[0]+d*s[1]+u*s[2]+p*s[3]+255*s[4],o[h+1]=c*s[5]+d*s[6]+u*s[7]+p*s[8]+255*s[9],o[h+2]=c*s[10]+d*s[11]+u*s[12]+p*s[13]+255*s[14],o[h+3]=c*s[15]+d*s[16]+u*s[17]+p*s[18]+255*s[19])},getUniformLocations:function(e,t){return{uColorMatrix:e.getUniformLocation(t,"uColorMatrix"),uConstants:e.getUniformLocation(t,"uConstants")}},sendUniformData:function(e,t){var r=this.matrix,o=[r[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]],i=[r[4],r[9],r[14],r[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,o),e.uniform4fv(t.uConstants,i)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.round,r=e.fabric||(e.fabric={}),o=r.Image.filters,i=r.util.createClass;o.Brightness=i(o.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(0!==this.brightness){var r=e.imageData,o=r.data,n=o.length,a=t(255*this.brightness),s;for(s=0;s<n;s+=4)o[s]+=a,o[s+1]=o[s+1]+a,o[s+2]=o[s+2]+a}},getUniformLocations:function(e,t){return{uBrightness:e.getUniformLocation(t,"uBrightness")}},sendUniformData:function(e,t){e.uniform1f(t.uBrightness,this.brightness)}}),r.Image.filters.Brightness.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.sqrt,r=e.fabric||(e.fabric={}),o=r.util.object.extend,i=r.Image.filters,n=r.util.createClass;i.Convolute=n(i.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(e){var r=t(this.matrix.length),o=this.type+"_"+r+"_"+(this.opaque?1:0),i=this.fragmentSource[o];return e.programCache.hasOwnProperty(o)||(e.programCache[o]=this.createProgram(e.context,i)),e.programCache[o]},applyTo2d:function(e){var o=e.imageData,i=o.data,n=this.matrix,s=Math.round(t(n.length)),l=Math.floor(s/2),c=o.width,d=o.height,u=e.ctx.createImageData(c,d),p=u.data,h=this.opaque?1:0,f,m,_,v,C,S,T,O,w,P,k,D,j;for(k=0;k<d;k++)for(P=0;P<c;P++){for(C=4*(k*c+P),f=0,m=0,_=0,v=0,j=0;j<s;j++)for(D=0;D<s;D++)(T=k+j-l,S=P+D-l,!(0>T||T>=d||0>S||S>=c))&&(O=4*(T*c+S),w=n[j*s+D],f+=i[O]*w,m+=i[O+1]*w,_+=i[O+2]*w,h||(v+=i[O+3]*w));p[C]=f,p[C+1]=m,p[C+2]=_,p[C+3]=h?i[C+3]:v}e.imageData=u},getUniformLocations:function(e,t){return{uMatrix:e.getUniformLocation(t,"uMatrix"),uOpaque:e.getUniformLocation(t,"uOpaque"),uHalfSize:e.getUniformLocation(t,"uHalfSize"),uSize:e.getUniformLocation(t,"uSize")}},sendUniformData:function(e,t){e.uniform1fv(t.uMatrix,this.matrix)},toObject:function(){return o(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),r.Image.filters.Convolute.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.max,r=Math.min,o=e.fabric||(e.fabric={}),i=o.Image.filters,n=o.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(e){var o=e.imageData,n=o.data,a=n.length,s=this.mode,l,c;for(l=0;l<a;l+=4)"average"===s?c=(n[l]+n[l+1]+n[l+2])/3:"lightness"===s?c=(r(n[l],n[l+1],n[l+2])+t(n[l],n[l+1],n[l+2]))/2:"luminosity"===s&&(c=.21*n[l]+.72*n[l+1]+.07*n[l+2]),n[l]=c,n[l+1]=c,n[l+2]=c},retrieveShader:function(e){var t=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(t)){var r=this.fragmentSource[this.mode];e.programCache[t]=this.createProgram(e.context,r)}return e.programCache[t]},getUniformLocations:function(e,t){return{uMode:e.getUniformLocation(t,"uMode")}},sendUniformData:function(e,t){e.uniform1i(t.uMode,1)},isNeutralState:function(){return!1}}),o.Image.filters.Grayscale.fromObject=o.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.Image.filters,o=t.util.createClass;r.Invert=o(r.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(e){var t=e.imageData,r=t.data,o=r.length,n;for(n=0;n<o;n+=4)r[n]=255-r[n],r[n+1]=255-r[n+1],r[n+2]=255-r[n+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,t){return{uInvert:e.getUniformLocation(t,"uInvert")}},sendUniformData:function(e,t){e.uniform1i(t.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.util.object.extend,o=t.Image.filters,i=t.util.createClass;o.Noise=i(o.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(e){if(0!==this.noise){var t=e.imageData,r=t.data,o=r.length,n=this.noise,a,s;for(a=0,o=r.length;a<o;a+=4)s=(.5-Math.random())*n,r[a]+=s,r[a+1]+=s,r[a+2]+=s}},getUniformLocations:function(e,t){return{uNoise:e.getUniformLocation(t,"uNoise"),uSeed:e.getUniformLocation(t,"uSeed")}},sendUniformData:function(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())},toObject:function(){return r(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.min,r=e.fabric||(e.fabric={}),o=r.Image.filters,i=r.util.createClass;o.Pixelate=i(o.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(e){var o=e.imageData,n=o.data,s=o.height,l=o.width,c,d,u,p,h,f,m,_,y,x,v;for(d=0;d<s;d+=this.blocksize)for(u=0;u<l;u+=this.blocksize)for(c=4*d*l+4*u,p=n[c],h=n[c+1],f=n[c+2],m=n[c+3],x=t(d+this.blocksize,s),v=t(u+this.blocksize,l),_=d;_<x;_++)for(y=u;y<v;y++)c=4*_*l+4*y,n[c]=p,n[c+1]=h,n[c+2]=f,n[c+3]=m},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(e,t){return{uBlocksize:e.getUniformLocation(t,"uBlocksize"),uStepW:e.getUniformLocation(t,"uStepW"),uStepH:e.getUniformLocation(t,"uStepH")}},sendUniformData:function(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}),r.Image.filters.Pixelate.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.util.object.extend,o=t.Image.filters,i=t.util.createClass;o.RemoveColor=i(o.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(e){var o=e.imageData,n=o.data,a=255*this.distance,s=new t.Color(this.color).getSource(),l=[s[0]-a,s[1]-a,s[2]-a],c=[s[0]+a,s[1]+a,s[2]+a],d,u,p,h;for(d=0;d<n.length;d+=4)u=n[d],p=n[d+1],h=n[d+2],u>l[0]&&p>l[1]&&h>l[2]&&u<c[0]&&p<c[1]&&h<c[2]&&(n[d+3]=0)},getUniformLocations:function(e,t){return{uLow:e.getUniformLocation(t,"uLow"),uHigh:e.getUniformLocation(t,"uHigh")}},sendUniformData:function(e,r){var o=new t.Color(this.color).getSource(),i=parseFloat(this.distance),n=[0+o[0]/255-i,0+o[1]/255-i,0+o[2]/255-i,1],a=[o[0]/255+i,o[1]/255+i,o[2]/255+i,1];e.uniform4fv(r.uLow,n),e.uniform4fv(r.uHigh,a)},toObject:function(){return r(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.Image.filters,o=t.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in i)r[n]=o(r.ColorMatrix,{type:n,matrix:i[n],mainParameter:!1,colorsOnly:!0}),t.Image.filters[n].fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.abs,o=Math.max,n=Math.min,a=e.fabric,s=a.Image.filters,l=a.util.createClass;s.BlendColor=l(s.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var t=this.type+"_"+this.mode,r;return e.programCache.hasOwnProperty(t)||(r=this.buildSource(this.mode),e.programCache[t]=this.createProgram(e.context,r)),e.programCache[t]},applyTo2d:function(e){var s=e.imageData,l=s.data,c=l.length,d=1-this.alpha,u,p,h,f,m,_,y;y=new a.Color(this.color).getSource(),u=y[0]*this.alpha,p=y[1]*this.alpha,h=y[2]*this.alpha;for(var x=0;x<c;x+=4)switch(f=l[x],m=l[x+1],_=l[x+2],this.mode){case"multiply":l[x]=f*u/255,l[x+1]=m*p/255,l[x+2]=_*h/255;break;case"screen":l[x]=255-(255-f)*(255-u)/255,l[x+1]=255-(255-m)*(255-p)/255,l[x+2]=255-(255-_)*(255-h)/255;break;case"add":l[x]=f+u,l[x+1]=m+p,l[x+2]=_+h;break;case"diff":case"difference":l[x]=t(f-u),l[x+1]=t(m-p),l[x+2]=t(_-h);break;case"subtract":l[x]=f-u,l[x+1]=m-p,l[x+2]=_-h;break;case"darken":l[x]=n(f,u),l[x+1]=n(m,p),l[x+2]=n(_,h);break;case"lighten":l[x]=o(f,u),l[x+1]=o(m,p),l[x+2]=o(_,h);break;case"overlay":l[x]=128>u?2*f*u/255:255-2*(255-f)*(255-u)/255,l[x+1]=128>p?2*m*p/255:255-2*(255-m)*(255-p)/255,l[x+2]=128>h?2*_*h/255:255-2*(255-_)*(255-h)/255;break;case"exclusion":l[x]=u+f-2*u*f/255,l[x+1]=p+m-2*p*m/255,l[x+2]=h+_-2*h*_/255;break;case"tint":l[x]=u+f*d,l[x+1]=p+m*d,l[x+2]=h+_*d;}},getUniformLocations:function(e,t){return{uColor:e.getUniformLocation(t,"uColor")}},sendUniformData:function(e,t){var r=new a.Color(this.color).getSource();r[0]=this.alpha*r[0]/255,r[1]=this.alpha*r[1]/255,r[2]=this.alpha*r[2]/255,r[3]=this.alpha,e.uniform4fv(t.uColor,r)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendColor.fromObject=a.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric,r=t.Image.filters,o=t.util.createClass;r.BlendImage=o(r.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(e){var t=this.type+"_"+this.mode,r=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(t)||(e.programCache[t]=this.createProgram(e.context,r)),e.programCache[t]},applyToWebGL:function(e){var t=e.context,r=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,r,t.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(t,t.TEXTURE1)},createTexture:function(e,t){return e.getCachedTexture(t.cacheKey,t._element)},calculateMatrix:function(){var e=this.image,t=e._element.width,r=e._element.height;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/r,1]},applyTo2d:function(e){var o=e.imageData,n=e.filterBackend.resources,s=o.data,l=s.length,c=o.width,d=o.height,u=this.image,p,h,f,m,_,y,x,v,C,S,T;n.blendImage||(n.blendImage=t.util.createCanvasElement()),C=n.blendImage,S=C.getContext("2d"),C.width!==c||C.height!==d?(C.width=c,C.height=d):S.clearRect(0,0,c,d),S.setTransform(u.scaleX,0,0,u.scaleY,u.left,u.top),S.drawImage(u._element,0,0,c,d),T=S.getImageData(0,0,c,d).data;for(var O=0;O<l;O+=4)switch(_=s[O],y=s[O+1],x=s[O+2],v=s[O+3],p=T[O],h=T[O+1],f=T[O+2],m=T[O+3],this.mode){case"multiply":s[O]=_*p/255,s[O+1]=y*h/255,s[O+2]=x*f/255,s[O+3]=v*m/255;break;case"mask":s[O+3]=m;}},getUniformLocations:function(e,t){return{uTransformMatrix:e.getUniformLocation(t,"uTransformMatrix"),uImage:e.getUniformLocation(t,"uImage")}},sendUniformData:function(e,t){var r=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,r)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(e,r){t.Image.fromObject(e.image,function(o){var i=t.util.object.clone(e);i.image=o,r(new t.Image.filters.BlendImage(i))})}}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.round,r=Math.ceil,o=e.fabric||(e.fabric={}),n=Math.pow,s=Math.floor,l=Math.sqrt,c=Math.abs,d=t,g=Math.sin,u=r,p=o.Image.filters,h=o.util.createClass;p.Resize=h(p.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(e,t){return{uDelta:e.getUniformLocation(t,"uDelta"),uTaps:e.getUniformLocation(t,"uTaps")}},sendUniformData:function(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)},retrieveShader:function(e){var t=this.getFilterWindow(),r=this.type+"_"+t;if(!e.programCache.hasOwnProperty(r)){var o=this.generateShader(t);e.programCache[r]=this.createProgram(e.context,o)}return e.programCache[r]},getFilterWindow:function(){var e=this.tempScale;return r(this.lanczosLobes/e)},getTaps:function(){for(var e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,r=this.getFilterWindow(),o=Array(r),n=1;n<=r;n++)o[n-1]=e(n*t);return o},generateShader:function(e){for(var t=Array(e),r=this.fragmentSourceTOP,o=1,e;o<=e;o++)t[o-1]=o+".0 * uDelta";return r+="uniform float uTaps["+e+"];\n",r+="void main() {\n",r+="  vec4 color = texture2D(uTexture, vTexCoord);\n",r+="  float sum = 1.0;\n",t.forEach(function(e,t){r+="  color += texture2D(uTexture, vTexCoord + "+e+") * uTaps["+t+"];\n",r+="  color += texture2D(uTexture, vTexCoord - "+e+") * uTaps["+t+"];\n",r+="  sum += 2.0 * uTaps["+t+"];\n"}),r+="  gl_FragColor = color / sum;\n",r+="}",r},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(e){e.webgl?(e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=t(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=t(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceHeight=e.destinationHeight):this.applyTo2d(e)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(e){return function(t){if(t>=e||t<=-e)return 0;if(1.1920929e-7>t&&-1.1920929e-7<t)return 1;t*=Math.PI;var r=t/e;return g(t)/t*g(r)/r}},applyTo2d:function(e){var t=e.imageData,r=this.scaleX,o=this.scaleY;this.rcpScaleX=1/r,this.rcpScaleY=1/o;var i=t.width,n=t.height,a=d(i*r),s=d(n*o),l;"sliceHack"===this.resizeType?l=this.sliceByTwo(e,i,n,a,s):"hermite"===this.resizeType?l=this.hermiteFastResize(e,i,n,a,s):"bilinear"===this.resizeType?l=this.bilinearFiltering(e,i,n,a,s):"lanczos"===this.resizeType&&(l=this.lanczosResize(e,i,n,a,s)),e.imageData=l},sliceByTwo:function(e,t,r,i,n){var a=e.imageData,l=.5,c=!1,d=!1,g=t*l,u=r*l,p=o.filterBackend.resources,h=0,f=0,m=t,_=0,y,x;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),y=p.sliceByTwo,(y.width<1.5*t||y.height<r)&&(y.width=1.5*t,y.height=r),x=y.getContext("2d"),x.clearRect(0,0,1.5*t,r),x.putImageData(a,0,0),i=s(i),n=s(n);!c||!d;)t=g,r=u,i<s(g*l)?g=s(g*l):(g=i,c=!0),n<s(u*l)?u=s(u*l):(u=n,d=!0),x.drawImage(y,h,f,t,r,m,_,g,u),h=m,f=_,_+=u;return x.getImageData(h,f,i,n)},lanczosResize:function(e,t,r,o,d){function g(e){var w,P,k,D,E,A,F,I,L,R,M;for(T.x=(e+.5)*_,O.x=s(T.x),w=0;w<d;w++){for(T.y=(w+.5)*y,O.y=s(T.y),E=0,A=0,F=0,I=0,L=0,P=O.x-C;P<=O.x+C;P++)if(!(0>P||P>=t)){R=s(1e3*c(P-T.x)),S[R]||(S[R]={});for(var B=O.y-b;B<=O.y+b;B++)0>B||B>=r||(M=s(1e3*c(B-T.y)),S[R][M]||(S[R][M]=m(l(n(R*x,2)+n(M*v,2))/1e3)),k=S[R][M],0<k&&(D=4*(B*t+P),E+=k,A+=k*p[D],F+=k*p[D+1],I+=k*p[D+2],L+=k*p[D+3]))}D=4*(w*o+e),f[D]=A/E,f[D+1]=F/E,f[D+2]=I/E,f[D+3]=L/E}return++e<o?g(e):h}var p=e.imageData.data,h=e.ctx.createImageData(o,d),f=h.data,m=this.lanczosCreate(this.lanczosLobes),_=this.rcpScaleX,y=this.rcpScaleY,x=2/this.rcpScaleX,v=2/this.rcpScaleY,C=u(_*this.lanczosLobes/2),b=u(y*this.lanczosLobes/2),S={},T={},O={};return g(0)},bilinearFiltering:function(e,t,r,o,n){var l=0,g=this.rcpScaleX,u=this.rcpScaleY,p=4*(t-1),h=e.imageData,f=h.data,m=e.ctx.createImageData(o,n),_=m.data,v,C,S,T,O,w,P,k,D,E,A,F,I;for(P=0;P<n;P++)for(k=0;k<o;k++)for(O=s(g*k),w=s(u*P),D=g*k-O,E=u*P-w,I=4*(w*t+O),A=0;4>A;A++)v=f[I+A],C=f[I+4+A],S=f[I+p+A],T=f[I+p+4+A],F=v*(1-D)*(1-E)+C*D*(1-E)+S*E*(1-D)+T*D*E,_[l++]=F;return m},hermiteFastResize:function(e,t,r,o,n){for(var a=this.rcpScaleX,d=this.rcpScaleY,g=u(a/2),p=u(d/2),h=e.imageData,f=h.data,m=e.ctx.createImageData(o,n),_=m.data,y=0;y<n;y++)for(var x=0;x<o;x++){for(var v=4*(x+y*o),C=0,b=0,S=0,T=0,O=0,P=0,k=0,D=(y+.5)*d,E=s(y*d);E<(y+1)*d;E++)for(var A=c(D-(E+.5))/p,F=(x+.5)*a,I=s(x*a);I<(x+1)*a;I++){var L=c(F-(I+.5))/g,R=l(A*A+L*L);1<R&&-1>R||(C=2*R*R*R-3*R*R+1,0<C&&(L=4*(I+E*t),k+=C*f[L+3],S+=C,255>f[L+3]&&(C=C*f[L+3]/250),T+=C*f[L],O+=C*f[L+1],P+=C*f[L+2],b+=C))}_[v]=T/b,_[v+1]=O/b,_[v+2]=P/b,_[v+3]=k/S}return m},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),o.Image.filters.Resize.fromObject=o.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.floor,r=e.fabric||(e.fabric={}),o=r.Image.filters,i=r.util.createClass;o.Contrast=i(o.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(0!==this.contrast){var r=e.imageData,o=r.data,n=o.length,a=t(255*this.contrast),s=259*(a+255)/(255*(259-a)),l,n;for(l=0;l<n;l+=4)o[l]=s*(o[l]-128)+128,o[l+1]=s*(o[l+1]-128)+128,o[l+2]=s*(o[l+2]-128)+128}},getUniformLocations:function(e,t){return{uContrast:e.getUniformLocation(t,"uContrast")}},sendUniformData:function(e,t){e.uniform1f(t.uContrast,this.contrast)}}),r.Image.filters.Contrast.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.max,r=e.fabric||(e.fabric={}),o=r.Image.filters,i=r.util.createClass;o.Saturation=i(o.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(0!==this.saturation){var r=e.imageData,o=r.data,n=o.length,a=-this.saturation,s,l;for(s=0;s<n;s+=4)l=t(o[s],o[s+1],o[s+2]),o[s]+=l===o[s]?0:(l-o[s])*a,o[s+1]+=l===o[s+1]?0:(l-o[s+1])*a,o[s+2]+=l===o[s+2]?0:(l-o[s+2])*a}},getUniformLocations:function(e,t){return{uSaturation:e.getUniformLocation(t,"uSaturation")}},sendUniformData:function(e,t){e.uniform1f(t.uSaturation,-this.saturation)}}),r.Image.filters.Saturation.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.abs,r=e.fabric||(e.fabric={}),o=r.Image.filters,i=r.util.createClass;o.Blur=i(o.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var o=e.filterBackend.resources,n=e.imageData.width,a=e.imageData.height,s,l;o.blurLayer1||(o.blurLayer1=r.util.createCanvasElement(),o.blurLayer2=r.util.createCanvasElement()),s=o.blurLayer1,l=o.blurLayer2,(s.width!==n||s.height!==a)&&(l.width=s.width=n,l.height=s.height=a);var c=s.getContext("2d"),d=l.getContext("2d"),g=.5*(.06*this.blur),u,p,h,f;for(c.putImageData(e.imageData,0,0),d.clearRect(0,0,n,a),f=-15;15>=f;f++)u=(Math.random()-.5)/4,p=f/15,h=g*p*n+u,d.globalAlpha=1-t(p),d.drawImage(s,h,u),c.drawImage(l,0,0),d.globalAlpha=1,d.clearRect(0,0,l.width,l.height);for(f=-15;15>=f;f++)u=(Math.random()-.5)/4,p=f/15,h=g*p*a+u,d.globalAlpha=1-t(p),d.drawImage(s,u,h),c.drawImage(l,0,0),d.globalAlpha=1,d.clearRect(0,0,l.width,l.height);e.ctx.drawImage(s,0,0);var m=e.ctx.getImageData(0,0,s.width,s.height);return c.globalAlpha=1,c.clearRect(0,0,s.width,s.height),m},getUniformLocations:function(e,t){return{delta:e.getUniformLocation(t,"uDelta")}},sendUniformData:function(e,t){var r=this.chooseRightDelta();e.uniform2fv(t.delta,r)},chooseRightDelta:function(){var e=1,t=[0,0],r;return this.horizontal?1<this.aspectRatio&&(e=1/this.aspectRatio):1>this.aspectRatio&&(e=this.aspectRatio),r=.12*(e*this.blur),this.horizontal?t[0]=r:t[1]=r,t}}),o.Blur.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=Math.pow,r=e.fabric||(e.fabric={}),o=r.Image.filters,i=r.util.createClass;o.Gamma=i(o.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],o.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var r=e.imageData,o=r.data,n=this.gamma,a=o.length,s=1/n[0],l=1/n[1],c=1/n[2],d;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),d=0,a=256;d<a;d++)this.rVals[d]=255*t(d/255,s),this.gVals[d]=255*t(d/255,l),this.bVals[d]=255*t(d/255,c);for(d=0,a=o.length;d<a;d+=4)o[d]=this.rVals[o[d]],o[d+1]=this.gVals[o[d+1]],o[d+2]=this.bVals[o[d+2]]},getUniformLocations:function(e,t){return{uGamma:e.getUniformLocation(t,"uGamma")}},sendUniformData:function(e,t){e.uniform3fv(t.uGamma,this.gamma)}}),r.Image.filters.Gamma.fromObject=r.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.Image.filters,o=t.util.createClass;r.Composed=o(r.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach(function(t){t.applyTo(e)})},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(e){return!e.isNeutralState()})}}),t.Image.filters.Composed.fromObject=function(e,r){var o=e.subFilters||[],i=o.map(function(e){return new t.Image.filters[e.type](e)}),n=new t.Image.filters.Composed({subFilters:i});return r&&r(n),n}}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.Image.filters,o=t.util.createClass;r.HueRotation=o(r.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,r=t.util.cos(e),o=t.util.sin(e),i=1/3,n=Math.sqrt(i)*o,a=1-r;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=r+a/3,this.matrix[1]=i*a-n,this.matrix[2]=i*a+n,this.matrix[5]=i*a+n,this.matrix[6]=r+i*a,this.matrix[7]=i*a-n,this.matrix[10]=i*a-n,this.matrix[11]=i*a+n,this.matrix[12]=r+i*a},isNeutralState:function(e){return this.calculateMatrix(),r.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),r.BaseFilter.prototype.applyTo.call(this,e)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),function(e){'use strict';var t=e.fabric||(e.fabric={}),r=t.util.object.clone;return t.Text?void t.warn("fabric.Text is already defined"):void(t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:t.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,t){this.styles=t?t.styles||{}:{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",t),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e=0,t=this._textLines.length,r,o,n,a,s,l,c;e<t;e++)if(!("justify"!==this.textAlign&&(e===t-1||this.isEndOfWrapping(e)))&&(a=0,s=this._textLines[e],o=this.getLineWidth(e),o<this.width&&(c=this.textLines[e].match(this._reSpacesAndTabs)))){n=c.length,r=(this.width-o)/n;for(var d=0,g=s.length;d<=g;d++)l=this.__charBounds[e][d],this._reSpaceAndTab.test(s[d])?(l.width+=r,l.kernedWidth+=r,l.left+=a,a+=r):l.left+=a}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+"): { \"text\": \""+this.text+"\", \"fontFamily\": \""+this.fontFamily+"\" }>"},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e},_render:function(e){this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){"stroke"===this.paintFirst?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,t,r){e.textBaseline="alphabetic",e.font=this._getFontDeclaration(t,r)},calcTextWidth:function(){for(var e=this.getLineWidth(0),t=1,r=this._textLines.length,o;t<r;t++)o=this.getLineWidth(t),o>e&&(e=o);return e},_renderTextLine:function(e,t,r,o,i,n){this._renderChars(e,t,r,o,i,n)},_renderTextLinesBackground:function(e){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var t=0,r=e.fillStyle,o=this._getLeftOffset(),n=this._getTopOffset(),a=0,s=0,l=0,c=this._textLines.length,d,g,u,p,h,f;l<void 0;l++){if(d=this.getHeightOfLine(l),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",l)){t+=d;continue}u=this._textLines[l],g=this._getLineLeftOffset(l),s=0,a=0,p=this.getValueOfPropertyAt(l,0,"textBackgroundColor");for(var m=0,_=u.length;m<_;m++)h=this.__charBounds[l][m],f=this.getValueOfPropertyAt(l,m,"textBackgroundColor"),f===p?s+=h.kernedWidth:(e.fillStyle=p,p&&e.fillRect(o+g+a,n+t,s,d/this.lineHeight),a=h.left,s=h.width,p=f);f&&(e.fillStyle=f,e.fillRect(o+g+a,n+t,s,d/this.lineHeight)),t+=d}e.fillStyle=r,this._removeShadow(e)}},getFontCache:function(e){var r=e.fontFamily.toLowerCase();t.charWidthsCache[r]||(t.charWidthsCache[r]={});var o=t.charWidthsCache[r],i=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return o[i]||(o[i]={}),o[i]},_applyCharStyles:function(e,t,r,o,i){this._setFillStyles(t,i),this._setStrokeStyles(t,i),t.font=this._getFontDeclaration(i)},_measureChar:function(e,t,r,o){var i=this.getFontCache(t),n=this._getFontDeclaration(t),a=this._getFontDeclaration(o),s=r+e,l=n===a,c=t.fontSize/this.CACHE_FONT_SIZE,d,g,u,p;if(r&&void 0!==i[r]&&(u=i[r]),void 0!==i[e]&&(p=d=i[e]),l&&void 0!==i[s]&&(g=i[s],p=g-u),void 0===d||void 0===u||void 0===g){var h=this.getMeasuringContext();this._setTextStyles(h,t,!0)}return void 0===d&&(p=d=h.measureText(e).width,i[e]=d),void 0===u&&l&&r&&(u=h.measureText(r).width,i[r]=u),l&&void 0===g&&(g=h.measureText(s).width,i[s]=g,p=g-u),{width:d*c,kernedWidth:p*c}},getHeightOfChar:function(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")},measureLine:function(e){var t=this._measureLine(e);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),0>t.width&&(t.width=0),t},_measureLine:function(e){var t=0,r=this._textLines[e],o=Array(r.length),n,a,s,l;for(this.__charBounds[e]=o,n=0;n<r.length;n++)a=r[n],l=this._getGraphemeBox(a,e,n,s),o[n]=l,t+=l.kernedWidth,s=a;return o[n]={left:l?l.left+l.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:t,numOfSpaces:0}},_getGraphemeBox:function(e,t,r,o,i){var n=this.getCompleteStyleDeclaration(t,r),a=o?this.getCompleteStyleDeclaration(t,r-1):{},s=this._measureChar(e,n,o,a),l=s.kernedWidth,c=s.width,d;0!==this.charSpacing&&(d=this._getWidthOfCharSpacing(),c+=d,l+=d);var g={width:c,left:0,height:n.fontSize,kernedWidth:l,deltaY:n.deltaY};if(0<r&&!i){var u=this.__charBounds[t][r-1];g.left=u.left+u.width+s.kernedWidth-s.width}return g},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var t=this._textLines[e],r=this.getHeightOfChar(e,0),o=1,n=t.length;o<n;o++)r=Math.max(this.getHeightOfChar(e,o),r);return this.__lineHeights[e]=r*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e=0,t=0,r=this._textLines.length,o;t<r;t++)o=this.getHeightOfLine(t),e+=t==r-1?o/this.lineHeight:o;return e},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var r=-this.width/2+t.offsetX||0,o=-this.height/2+t.offsetY||0;return e.transform(1,0,0,1,r,o),{offsetX:r,offsetY:o}},_renderTextCommon:function(e,t){e.save();for(var r=0,o=this._getLeftOffset(),n=this._getTopOffset(),a=this._applyPatternGradientTransform(e,"fillText"===t?this.fill:this.stroke),s=0,l=this._textLines.length;s<l;s++){var c=this.getHeightOfLine(s),d=c/this.lineHeight,g=this._getLineLeftOffset(s);this._renderTextLine(t,e,this._textLines[s],o+g-a.offsetX,n+r+d-a.offsetY,s),r+=c}e.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(!this.stroke||0===this.strokeWidth)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,t,r,o,n,a){var s=this.getHeightOfLine(a),l=-1!==this.textAlign.indexOf("justify"),c="",d=0,g=!l&&0===this.charSpacing&&this.isEmptyStyles(a),u,p,h,f;if(t.save(),n-=s*this._fontSizeFraction/this.lineHeight,g)return this._renderChar(e,t,a,0,this.textLines[a],o,n,s),void t.restore();for(var m=0,_=r.length-1;m<=_;m++)f=m==_||this.charSpacing,c+=r[m],h=this.__charBounds[a][m],0===d?(o+=h.kernedWidth-h.width,d+=h.width):d+=h.kernedWidth,l&&!f&&this._reSpaceAndTab.test(r[m])&&(f=!0),f||(u=u||this.getCompleteStyleDeclaration(a,m),p=this.getCompleteStyleDeclaration(a,m+1),f=this._hasStyleChanged(u,p)),f&&(this._renderChar(e,t,a,m,c,o,n,s),c="",u=p,o+=d,d=0);t.restore()},_renderChar:function(e,t,r,o,i,n,a){var s=this._getStyleDeclaration(r,o),l=this.getCompleteStyleDeclaration(r,o),c="fillText"===e&&l.fill,d="strokeText"===e&&l.stroke&&l.strokeWidth;(d||c)&&(s&&t.save(),this._applyCharStyles(e,t,r,o,l),s&&s.textBackgroundColor&&this._removeShadow(t),s&&s.deltaY&&(a+=s.deltaY),c&&t.fillText(i,n,a),d&&t.strokeText(i,n,a),s&&t.restore())},setSuperscript:function(e,t){return this._setScript(e,t,this.superscript)},setSubscript:function(e,t){return this._setScript(e,t,this.subscript)},_setScript:function(e,t,r){var o=this.get2DCursorLocation(e,!0),i=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"fontSize"),n=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"deltaY"),a={fontSize:i*r.size,deltaY:n+i*r.baseline};return this.setSelectionStyles(a,e,t),this},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth||e.fontSize!==t.fontSize||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(e,t){return this._hasStyleChanged(e,t)||e.overline!==t.overline||e.underline!==t.underline||e.linethrough!==t.linethrough},_getLineLeftOffset:function(e){var t=this.getLineWidth(e);return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:"justify-center"===this.textAlign&&this.isEndOfWrapping(e)?(this.width-t)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(e)?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){if(this.__lineWidths[e])return this.__lineWidths[e];var t=this._textLines[e],r,o;return""===t?r=0:(o=this.measureLine(e),r=o.width),this.__lineWidths[e]=r,r},_getWidthOfCharSpacing:function(){return 0===this.charSpacing?0:this.fontSize*this.charSpacing/1e3},getValueOfPropertyAt:function(e,t,r){var o=this._getStyleDeclaration(e,t);return o&&"undefined"!=typeof o[r]?o[r]:this[r]},_renderTextDecoration:function(e,t){if(this[t]||this.styleHas(t)){for(var r=this._getLeftOffset(),o=this._getTopOffset(),n=this._getWidthOfCharSpacing(),a=0,s=this._textLines.length,l,c,d,g,u,p,h,f,m,_,y,x,v,C,b,S;a<void 0;a++){if(l=this.getHeightOfLine(a),!this[t]&&!this.styleHas(t,a)){o+=l;continue}h=this._textLines[a],C=l/this.lineHeight,g=this._getLineLeftOffset(a),_=0,y=0,f=this.getValueOfPropertyAt(a,0,t),S=this.getValueOfPropertyAt(a,0,"fill"),m=o+C*(1-this._fontSizeFraction),c=this.getHeightOfChar(a,0),u=this.getValueOfPropertyAt(a,0,"deltaY");for(var T=0,O=h.length;T<O;T++)x=this.__charBounds[a][T],v=this.getValueOfPropertyAt(a,T,t),b=this.getValueOfPropertyAt(a,T,"fill"),d=this.getHeightOfChar(a,T),p=this.getValueOfPropertyAt(a,T,"deltaY"),(v!==f||b!==S||d!==c||p!==u)&&0<y?(e.fillStyle=S,f&&S&&e.fillRect(r+g+_,m+this.offsets[t]*c+u,y,this.fontSize/15),_=x.left,y=x.width,f=v,S=b,c=d,u=p):y+=x.kernedWidth;e.fillStyle=b,v&&b&&e.fillRect(r+g+_,m+this.offsets[t]*c+u,y-n,this.fontSize/15),o+=l}this._removeShadow(e)}},_getFontDeclaration:function(e,r){var o=e||this,i=this.fontFamily,n=-1<t.Text.genericFonts.indexOf(i.toLowerCase()),a=i===void 0||-1<i.indexOf("'")||-1<i.indexOf(",")||-1<i.indexOf("\"")||n?o.fontFamily:"\""+o.fontFamily+"\"";return[t.isLikelyNode?o.fontWeight:o.fontStyle,t.isLikelyNode?o.fontStyle:o.fontWeight,r?this.CACHE_FONT_SIZE+"px":o.fontSize+"px",a].join(" ")},render:function(e){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e))},_splitTextIntoLines:function(e){for(var r=e.split(this._reNewline),o=Array(r.length),n=["\n"],a=[],s=0;s<r.length;s++)o[s]=t.util.string.graphemeSplit(r[s]),a=a.concat(o[s],n);return a.pop(),{_unwrappedLines:o,lines:r,graphemeText:a,graphemeLines:o}},toObject:function(e){var t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(e),o=this.callSuper("toObject",t);return o.styles=r(this.styles,!0),o},set:function(e,t){this.callSuper("set",e,t);var r=!1;if("object"==typeof e)for(var o in e)r=r||-1!==this._dimensionAffectingProps.indexOf(o);else r=-1!==this._dimensionAffectingProps.indexOf(e);return r&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor"]),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,o,i){if(!e)return o(null);var n=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES),a=n.textAnchor||"left";if(i=t.util.object.extend(i?r(i):{},n),i.top=i.top||0,i.left=i.left||0,n.textDecoration){var s=n.textDecoration;-1!==s.indexOf("underline")&&(i.underline=!0),-1!==s.indexOf("overline")&&(i.overline=!0),-1!==s.indexOf("line-through")&&(i.linethrough=!0),delete i.textDecoration}"dx"in n&&(i.left+=n.dx),"dy"in n&&(i.top+=n.dy),"fontSize"in i||(i.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in e?l=e.textContent:"firstChild"in e&&null!==e.firstChild&&"data"in e.firstChild&&null!==e.firstChild.data&&(l=e.firstChild.data),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var c=i.strokeWidth;i.strokeWidth=0;var d=new t.Text(l,i),g=d.getScaledHeight()/d.height,u=(d.height+d.strokeWidth)*d.lineHeight-d.height,p=d.getScaledHeight()+u*g,h=0;"center"===a&&(h=d.getScaledWidth()/2),"right"===a&&(h=d.getScaledWidth()),d.set({left:d.left-h,top:d.top-(p-d.fontSize*(.07+d._fontSizeFraction))/d.lineHeight,strokeWidth:"undefined"==typeof c?1:c}),o(d)},t.Text.fromObject=function(e,r){return t.Object._fromObject("Text",e,r,"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text))}("undefined"==typeof exports?this:exports),function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if("undefined"!=typeof e&&!this.styles[e])return!0;var t="undefined"==typeof e?this.styles:{line:this.styles[e]};for(var r in t)for(var o in t[r])for(var i in t[r][o])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||""===e)return!1;if("undefined"!=typeof t&&!this.styles[t])return!1;var r="undefined"==typeof t?this.styles:{0:this.styles[t]};for(var o in r)for(var i in r[o])if("undefined"!=typeof r[o][i][e])return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||""===e)return!1;var t=this.styles,r=0,o=!0,n=0,a,s,l;for(var c in t){for(var d in a=0,t[c]){var l=t[c][d],g=l.hasOwnProperty(e);r++,g?(s?l[e]!==s&&(o=!1):s=l[e],l[e]===this[e]&&delete l[e]):o=!1,0===Object.keys(l).length?delete t[c][d]:a++}0===a&&delete t[c]}for(var u=0;u<this._textLines.length;u++)n+=this._textLines[u].length;o&&r===n&&(this[e]=s,this.removeStyle(e))},removeStyle:function(e){if(this.styles&&e&&""!==e){var t=this.styles,r,o,i;for(o in t){for(i in r=t[o],r)delete r[i][e],0===Object.keys(r[i]).length&&delete r[i];0===Object.keys(r).length&&delete t[o]}}},_extendStyles:function(e,t){var r=this.get2DCursorLocation(e);this._getLineStyle(r.lineIndex)||this._setLineStyle(r.lineIndex),this._getStyleDeclaration(r.lineIndex,r.charIndex)||this._setStyleDeclaration(r.lineIndex,r.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(r.lineIndex,r.charIndex),t)},get2DCursorLocation:function(e,t){"undefined"==typeof e&&(e=this.selectionStart);for(var r=t?this._unwrappedTextLines:this._textLines,o=r.length,n=0;n<o;n++){if(e<=r[n].length)return{lineIndex:n,charIndex:e};e-=r[n].length+this.missingNewlineOffset(n)}return{lineIndex:n-1,charIndex:r[n-1].length<e?r[n-1].length:e}},getSelectionStyles:function(e,t,r){"undefined"==typeof e&&(e=this.selectionStart||0),"undefined"==typeof t&&(t=this.selectionEnd||e);for(var o=[],n=e;n<t;n++)o.push(this.getStyleAtPosition(n,r));return o},getStyleAtPosition:function(e,t){var r=this.get2DCursorLocation(e),o=t?this.getCompleteStyleDeclaration(r.lineIndex,r.charIndex):this._getStyleDeclaration(r.lineIndex,r.charIndex);return o||{}},setSelectionStyles:function(e,t,r){"undefined"==typeof t&&(t=this.selectionStart||0),"undefined"==typeof r&&(r=this.selectionEnd||t);for(var o=t;o<r;o++)this._extendStyles(o,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var r=this.styles&&this.styles[e];return r?r[t]:null},getCompleteStyleDeclaration:function(e,t){for(var r=this._getStyleDeclaration(e,t)||{},o={},n=0,a;n<this._styleProperties.length;n++)a=this._styleProperties[n],o[a]="undefined"==typeof r[a]?this[a]:r[a];return o},_setStyleDeclaration:function(e,t,r){this.styles[e][t]=r},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}})}(),function(){function e(e){e.textDecoration&&(-1<e.textDecoration.indexOf("underline")&&(e.underline=!0),-1<e.textDecoration.indexOf("line-through")&&(e.linethrough=!0),-1<e.textDecoration.indexOf("overline")&&(e.overline=!0),delete e.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,t){this.callSuper("initialize",e,t),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,r=this.canvas.viewportTransform;t.save(),t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),e||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this._getCursorBoundaries(),t=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,t):this.renderSelection(e,t),t.restore()}},_clearTextArea:function(e){var t=this.width+4,r=this.height+4;e.clearRect(-t/2,-r/2,t,r)},_getCursorBoundaries:function(e){"undefined"==typeof e&&(e=this.selectionStart);var t=this._getLeftOffset(),r=this._getTopOffset(),o=this._getCursorBoundariesOffsets(e);return{left:t,top:r,leftOffset:o.left,topOffset:o.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var t=0,r=0,o=this.get2DCursorLocation(e),n,a,s,l;s=o.charIndex,a=o.lineIndex;for(var c=0;c<a;c++)t+=this.getHeightOfLine(c);n=this._getLineLeftOffset(a);var d=this.__charBounds[a][s];return d&&(r=d.left),0!==this.charSpacing&&s===this._textLines[a].length&&(r-=this._getWidthOfCharSpacing()),l={top:t,left:n+(0<r?r:0)},this.cursorOffsetCache=l,this.cursorOffsetCache},renderCursor:function(e,t){var r=this.get2DCursorLocation(),o=r.lineIndex,i=0<r.charIndex?r.charIndex-1:0,n=this.getValueOfPropertyAt(o,i,"fontSize"),a=this.scaleX*this.canvas.getZoom(),s=this.cursorWidth/a,l=e.topOffset,c=this.getValueOfPropertyAt(o,i,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(o)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,t),t.fillStyle=this.getValueOfPropertyAt(o,i,"fill"),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-s/2,l+e.top+c,s,n)},renderSelection:function(e,t){for(var r=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,o=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,n=-1!==this.textAlign.indexOf("justify"),a=this.get2DCursorLocation(r),s=this.get2DCursorLocation(o),l=a.lineIndex,c=s.lineIndex,d=0>a.charIndex?0:a.charIndex,g=0>s.charIndex?0:s.charIndex,u=l;u<=c;u++){var p=this._getLineLeftOffset(u)||0,h=this.getHeightOfLine(u),f=0,m=0,_=0;if(u===l&&(m=this.__charBounds[l][d].left),u>=l&&u<c)_=n&&!this.isEndOfWrapping(u)?this.width:this.getLineWidth(u)||5;else if(u===c)if(0===g)_=this.__charBounds[c][g].left;else{var y=this._getWidthOfCharSpacing();_=this.__charBounds[c][g-1].left+this.__charBounds[c][g-1].width-y}f=h,(1>this.lineHeight||u===c&&1<this.lineHeight)&&(h/=this.lineHeight),this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",t.fillRect(e.left+p+m,e.top+e.topOffset+h,_-m,1)):(t.fillStyle=this.selectionColor,t.fillRect(e.left+p+m,e.top+e.topOffset,_-m,h)),e.topOffset+=f}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),t=0<e.charIndex?e.charIndex-1:0;return{l:e.lineIndex,c:t}}}),fabric.IText.fromObject=function(t,r){if(e(t),t.styles)for(var o in t.styles)for(var i in t.styles[o])e(t.styles[o][i]);fabric.Object._fromObject("IText",t,r,"text")}}(),function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var t=e.canvas;t&&(!t._hasITextHandlers&&(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],fabric.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,t,r,o){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",t,{duration:r,onComplete:function(){i.isAborted||e[o]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var t=this,r=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){t._tick()},r)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,t=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&t&&t.clearContext(t.contextTop||t.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var t=0,r=e-1;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)t++,r--;for(;/\S/.test(this._text[r])&&-1<r;)t++,r--;return e-t},findWordBoundaryRight:function(e){var t=0,r=e;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)t++,r++;for(;/\S/.test(this._text[r])&&r<this._text.length;)t++,r++;return e+t},findLineBoundaryLeft:function(e){for(var t=0,r=e-1;!/\n/.test(this._text[r])&&-1<r;)t++,r--;return e-t},findLineBoundaryRight:function(e){for(var t=0,r=e;!/\n/.test(this._text[r])&&r<this._text.length;)t++,r++;return e+t},searchWordBoundary:function(e,t){for(var r=this._text,o=this._reSpace.test(r[e])?e-1:e,i=r[o],n=fabric.reNonWord;!n.test(i)&&0<o&&o<r.length;)o+=t,i=r[o];return n.test(i)&&(o+=1===t?0:1),o},selectWord:function(e){e=e||this.selectionStart;var t=this.searchWordBoundary(e,-1),r=this.searchWordBoundary(e,1);this.selectionStart=t,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var t=this.findLineBoundaryLeft(e),r=this.findLineBoundaryRight(e);return this.selectionStart=t,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){if(!this.isEditing&&this.editable)return(this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),!this.canvas)?this:(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this)},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.selected=!1,e.isEditing&&e.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(e.e),r=this.selectionStart,o=this.selectionEnd;(t!==this.__selectionStartOnMouseDown||r===o)&&(r===t||o===t)||(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==r||this.selectionEnd!==o)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,t,r){var o=r.slice(0,e),i=fabric.util.string.graphemeSplit(o).length;if(e===t)return{selectionStart:i,selectionEnd:i};var n=r.slice(e,t),a=fabric.util.string.graphemeSplit(n).length;return{selectionStart:i,selectionEnd:i+a}},fromGraphemeToStringSelection:function(e,t,r){var o=r.slice(0,e),i=o.join("").length;if(e===t)return{selectionStart:i,selectionEnd:i};var n=r.slice(e,t),a=n.join("").length;return{selectionStart:i,selectionEnd:i+a}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),r=this.get2DCursorLocation(e),o=r.lineIndex,i=r.charIndex,n=this.getValueOfPropertyAt(o,i,"fontSize")*this.lineHeight,a=t.leftOffset,s=this.calcTransformMatrix(),l={x:t.left+a,y:t.top+t.topOffset+n},c=this.canvas.getRetinaScaling(),d=this.canvas.upperCanvasEl,g=d.width/c,u=d.height/c,h=g-n,f=u-n,m=d.clientWidth/g,_=d.clientHeight/u;return l=fabric.util.transformPoint(l,s),l=fabric.util.transformPoint(l,this.canvas.viewportTransform),l.x*=m,l.y*=_,0>l.x&&(l.x=0),l.x>h&&(l.x=h),0>l.y&&(l.y=0),l.y>f&&(l.y=f),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,t=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,t){var r=this.get2DCursorLocation(e,!0),o=this.get2DCursorLocation(t,!0),n=r.lineIndex,a=r.charIndex,s=o.lineIndex,l=o.charIndex,c,d;if(n!==s){if(this.styles[n])for(c=a;c<this._unwrappedTextLines[n].length;c++)delete this.styles[n][c];if(this.styles[s])for(c=l;c<this._unwrappedTextLines[s].length;c++)d=this.styles[s][c],d&&(this.styles[n]||(this.styles[n]={}),this.styles[n][a+c-l]=d);for(c=n+1;c<=s;c++)delete this.styles[c];this.shiftLineStyles(s,n-s)}else if(this.styles[n]){d=this.styles[n];var g,u;for(c=a;c<l;c++)delete d[c];for(u in this.styles[n])g=parseInt(u,10),g>=l&&(d[g-(l-a)]=d[u],delete d[u])}},shiftLineStyles:function(t,r){var o=e(this.styles);for(var i in this.styles){var n=parseInt(i,10);n>t&&(this.styles[n+r]=o[n],!o[n-r]&&delete this.styles[n])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(t,r,o,i){var n={},a=!1,s=this._unwrappedTextLines[t].length===r,l;for(var c in o||(o=1),this.shiftLineStyles(t,o),this.styles[t]&&(l=this.styles[t][0===r?r:r-1]),this.styles[t]){var d=parseInt(c,10);d>=r&&(a=!0,n[d-r]=this.styles[t][c],!(s&&0===r)&&delete this.styles[t][c])}var g=!1;for(a&&!s&&(this.styles[t+o]=n,g=!0),g&&o--;0<o;)i&&i[o-1]?this.styles[t+o]={0:e(i[o-1])}:l?this.styles[t+o]={0:e(l)}:delete this.styles[t+o],o--;this._forceClearCache=!0},insertCharStyleObject:function(t,r,o,i){this.styles||(this.styles={});var n=this.styles[t],a=n?e(n):{};for(var s in o||(o=1),a){var l=parseInt(s,10);l>=r&&(n[l+o]=a[l],!a[l-o]&&delete n[l])}if(this._forceClearCache=!0,i){for(;o--;)Object.keys(i[o]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][r+o]=e(i[o]));return}if(n)for(var c=n[r?r-1:1];c&&o--;)this.styles[t][r+o]=e(c)},insertNewStyleBlock:function(e,t,r){for(var o=this.get2DCursorLocation(t,!0),n=[0],a=0,s=0;s<e.length;s++)"\n"===e[s]?(a++,n[a]=0):n[a]++;0<n[0]&&(this.insertCharStyleObject(o.lineIndex,o.charIndex,n[0],r),r=r&&r.slice(n[0]+1)),a&&this.insertNewlineStyleObject(o.lineIndex,o.charIndex+n[0],a);for(var s=1;s<a;s++)0<n[s]?this.insertCharStyleObject(o.lineIndex+s,0,n[s],r):r&&(this.styles[o.lineIndex+s][0]=r[0]),r=r&&r.slice(n[s]+1);0<n[s]&&this.insertCharStyleObject(o.lineIndex+s,0,n[s],r)},setSelectionStartEndWithShift:function(e,t,r){r<=e?(t===e?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=r):r>e&&r<t?"right"===this._selectionDirection?this.selectionEnd=r:this.selectionStart=r:(t===e?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=r)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:0>this.selectionStart&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:0>this.selectionEnd&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(this.canvas){this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){this.canvas&&this.editable&&(!e.e.button||1===e.e.button)&&(this.__isMousedown=!0,this.selected&&this.setCursorByClick(e.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(e){this.canvas&&this.editable&&(!e.e.button||1===e.e.button)&&(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!(!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&1!==e.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),r=this.selectionStart,o=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(r,o,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(t){for(var e=this.getLocalPointer(t),r=0,o=0,n=0,a=0,s=0,l=0,c=this._textLines.length,d,g;l<c&&n<=e.y;l++)n+=this.getHeightOfLine(l)*this.scaleY,s=l,0<l&&(a+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));d=this._getLineLeftOffset(s),o=d*this.scaleX,g=this._textLines[s];for(var u=0,p=g.length;u<p&&(r=o,o+=this.__charBounds[s][u].kernedWidth*this.scaleX,o<=e.x);u++)a++;return this._getNewSelectionStartFromOffset(e,r,o,a,p)},_getNewSelectionStartFromOffset:function(e,t,r,o,i){var n=e.x-t,a=r-e.x,s=a>n||0>a?0:1,l=o+s;return this.flipX&&(l=i-l),l>this._text.length&&(l=this._text.length),l}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+e.fontSize+";",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing&&!this.inCompositionMode){if(t.keyCode in this.keysMap)this[this.keysMap[t.keyCode]](t);else if(t.keyCode in this.ctrlKeysMapDown&&(t.ctrlKey||t.metaKey))this[this.ctrlKeysMapDown[t.keyCode]](t);else return;t.stopImmediatePropagation(),t.preventDefault(),33<=t.keyCode&&40>=t.keyCode?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(t){if(!this.isEditing||this._copyDone||this.inCompositionMode)return void(this._copyDone=!1);if(t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey))this[this.ctrlKeysMapUp[t.keyCode]](t);else return;t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(t){var e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!!this.isEditing){var r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,o=this._text.length,i=r.length,n=i-o,a=this.selectionStart,s=this.selectionEnd,l=a!==s,c,d,g,u,p;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var h=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),f=a>h.selectionStart;l?(c=this._text.slice(a,s),n+=s-a):i<o&&(f?c=this._text.slice(s+n,s):c=this._text.slice(a,a-n));var g;d=r.slice(h.selectionEnd-n,h.selectionEnd),c&&c.length&&(d.length&&(g=this.getSelectionStyles(a,a+1,!0),g=d.map(function(){return g[0]})),l?(u=a,p=s):f?(u=s-c.length,p=s):(u=s,p=s+c.length),this.removeStyleFromTo(u,p)),d.length&&(e&&d.join("")===fabric.copiedText&&!fabric.disableStyleCopyPaste&&(g=fabric.copiedTextStyle),this.insertNewStyleBlock(d,a,g)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart===this.selectionEnd||(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=fabric.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(e,t){var r=this._getLineLeftOffset(e),o;return 0<t&&(o=this.__charBounds[e][t-1],r+=o.left+o.width),r},getDownCursorOffset:function(t,e){var r=this._getSelectionForOffset(t,e),o=this.get2DCursorLocation(r),i=o.lineIndex;if(i===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-r;var n=o.charIndex,a=this._getWidthBeforeCursor(i,n),s=this._getIndexOnLine(i+1,a),l=this._textLines[i].slice(n);return l.length+s+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var r=this._getSelectionForOffset(t,e),o=this.get2DCursorLocation(r),i=o.lineIndex;if(0===i||t.metaKey||33===t.keyCode)return-r;var n=o.charIndex,a=this._getWidthBeforeCursor(i,n),s=this._getIndexOnLine(i-1,a),l=this._textLines[i].slice(0,n),c=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+s-l.length+(1-c)},_getIndexOnLine:function(e,t){for(var r=Math.abs,o=this._textLines[e],i=this._getLineLeftOffset(e),n=i,a=0,s=0,l=o.length,c,d;s<l;s++)if(c=this.__charBounds[e][s].width,n+=c,n>t){d=!0;var g=n-c,u=n,p=r(g-t),h=r(u-t);a=h<p?s:s-1;break}return d||(a=o.length-1),a},moveCursorDown:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,r){var e=this["get"+t+"CursorOffset"](r,"right"===this._selectionDirection);r.shiftKey?this.moveCursorWithShift(e):this.moveCursorWithoutShift(e),0!==e&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t="left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==e},moveCursorWithoutShift:function(e){return 0>e?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,r){var o;if(t.altKey)o=this["findWordBoundary"+r](this[e]);else if(t.metaKey||35===t.keyCode||36===t.keyCode)o=this["findLineBoundary"+r](this[e]);else return this[e]+="Left"===r?-1:1,!0;return void 0!==typeof o&&this[e]!==o?(this[e]=o,!0):void 0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){if("right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd)return this._moveLeft(t,"selectionEnd");return 0===this.selectionStart?void 0:(this._selectionDirection="left",this._moveLeft(t,"selectionStart"))},moveCursorRight:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,r){var e="moveCursor"+t+"With";this._currentCursorOpacity=1,e+=r.shiftKey?"Shift":"outShift",this[e](r)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){if("left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd)return this._moveRight(t,"selectionStart");return this.selectionEnd===this._text.length?void 0:(this._selectionDirection="right",this._moveRight(t,"selectionEnd"))},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(e,t){"undefined"==typeof t&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,r,o){"undefined"==typeof o&&(o=r),o>r&&this.removeStyleFromTo(r,o);var i=fabric.util.string.graphemeSplit(e);this.insertNewStyleBlock(i,r,t),this._text=[].concat(this._text.slice(0,r),i,this._text.slice(o)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var e=fabric.util.toFixed;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var e=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(e.textTop,e.textLeft);return this._wrapSVGTextAndBg(t)},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(e){var t=this.getSvgTextDecoration(this);return[e.textBgRects.join(""),"\t\t<text xml:space=\"preserve\" ",this.fontFamily?"font-family=\""+this.fontFamily.replace(/"/g,"'")+"\" ":"",this.fontSize?"font-size=\""+this.fontSize+"\" ":"",this.fontStyle?"font-style=\""+this.fontStyle+"\" ":"",this.fontWeight?"font-weight=\""+this.fontWeight+"\" ":"",t?"text-decoration=\""+t+"\" ":"","style=\"",this.getSvgStyles(!0),"\"",this.addPaintOrder()," >",e.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,t){var r=[],o=[],n=e,a;this._setSVGBg(o);for(var s=0,l=this._textLines.length;s<l;s++)a=this._getLineLeftOffset(s),(this.textBackgroundColor||this.styleHas("textBackgroundColor",s))&&this._setSVGTextLineBg(o,s,t+a,n),this._setSVGTextLineText(r,s,t+a,n),n+=this.getHeightOfLine(s);return{textSpans:r,textBgRects:o}},_createTextCharSpan:function(t,r,o,i){var n=t!==t.trim()||t.match(/  +/g),a=this.getSvgSpanStyles(r,n),s=a?"style=\""+a+"\"":"",l=r.deltaY,c="",d=fabric.Object.NUM_FRACTION_DIGITS;return l&&(c=" dy=\""+e(l,d)+"\" "),["<tspan x=\"",e(o,d),"\" y=\"",e(i,d),"\" ",c,s,">",fabric.util.string.escapeXml(t),"</tspan>"].join("")},_setSVGTextLineText:function(e,t,r,o){var n=this.getHeightOfLine(t),a=-1!==this.textAlign.indexOf("justify"),s="",l=0,c=this._textLines[t],d,g,u,p,h;o+=n*(1-this._fontSizeFraction)/this.lineHeight;for(var f=0,m=c.length-1;f<=m;f++)h=f==m||this.charSpacing,s+=c[f],u=this.__charBounds[t][f],0===l?(r+=u.kernedWidth-u.width,l+=u.width):l+=u.kernedWidth,a&&!h&&this._reSpaceAndTab.test(c[f])&&(h=!0),h||(d=d||this.getCompleteStyleDeclaration(t,f),g=this.getCompleteStyleDeclaration(t,f+1),h=this._hasStyleChangedForSvg(d,g)),h&&(p=this._getStyleDeclaration(t,f)||{},e.push(this._createTextCharSpan(s,p,r,o)),s="",d=g,r+=l,l=0)},_pushTextBgRect:function(t,r,o,i,n,a){var s=fabric.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(r)," x=\"",e(o,s),"\" y=\"",e(i,s),"\" width=\"",e(n,s),"\" height=\"",e(a,s),"\"></rect>\n")},_setSVGTextLineBg:function(e,t,r,o){for(var i=this._textLines[t],n=this.getHeightOfLine(t)/this.lineHeight,a=0,s=0,l=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),c=0,d=i.length,g,u;c<d;c++)g=this.__charBounds[t][c],u=this.getValueOfPropertyAt(t,c,"textBackgroundColor"),u===l?a+=g.kernedWidth:(l&&this._pushTextBgRect(e,l,r+s,o,a,n),s=g.left,a=g.width,l=u);u&&this._pushTextBgRect(e,u,r+s,o,a,n)},_getFillAttributes:function(e){var t=e&&"string"==typeof e?new fabric.Color(e):"";return t&&t.getSource()&&1!==t.getAlpha()?"opacity=\""+t.getAlpha()+"\" fill=\""+t.setAlpha(1).toRgb()+"\"":"fill=\""+e+"\""},_getSVGLineTopOffset:function(e){for(var t=0,r=0,o=0;o<e;o++)t+=this.getHeightOfLine(o);return r=this.getHeightOfLine(o),{lineTop:t,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(e){var t=fabric.Object.prototype.getSvgStyles.call(this,e);return t+" white-space: pre;"}})}(),function(e){'use strict';var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(e){for(var t=0,r=0,o=0,n={},a=0;a<e.graphemeLines.length;a++)"\n"===e.graphemeText[o]&&0<a?(r=0,o++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[o])&&0<a&&(r++,o++),n[a]={line:t,offset:r},o+=e.graphemeLines[a].length,r+=e.graphemeLines[a].length;return n},styleHas:function(e,r){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[r];o&&(r=o.line)}return t.Text.prototype.styleHas.call(this,e,r)},isEmptyStyles:function(e){if(!this.styles)return!0;var t=0,r=e+1,o=!1,i=this._styleMap[e],n=this._styleMap[e+1],a,s;for(var l in i&&(e=i.line,t=i.offset),n&&(r=n.line,o=r===e,a=n.offset),s="undefined"==typeof e?this.styles:{line:this.styles[e]},s)for(var c in s[l])if(c>=t&&(!o||c<a))for(var d in s[l][c])return!1;return!0},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[e];if(!r)return null;e=r.line,t=r.offset+t}return this.callSuper("_getStyleDeclaration",e,t)},_setStyleDeclaration:function(e,t,r){var o=this._styleMap[e];e=o.line,t=o.offset+t,this.styles[e][t]=r},_deleteStyleDeclaration:function(e,t){var r=this._styleMap[e];e=r.line,t=r.offset+t,delete this.styles[e][t]},_getLineStyle:function(e){var t=this._styleMap[e];return!!this.styles[t.line]},_setLineStyle:function(e){var t=this._styleMap[e];this.styles[t.line]={}},_wrapText:function(e,t){var r=[],o;for(this.isWrapping=!0,o=0;o<e.length;o++)r=r.concat(this._wrapLine(e[o],o,t));return this.isWrapping=!1,r},_measureWord:function(e,t,r){var o=0,n;r=r||0;for(var a=0,s=e.length,l;a<s;a++)l=this._getGraphemeBox(e[a],t,a+r,n,!0),o+=l.kernedWidth,n=e[a];return o},_wrapLine:function(e,r,o,n){var a=0,s=this.splitByGrapheme,l=[],c=[],d=s?t.util.string.graphemeSplit(e):e.split(this._wordJoiners),g="",u=0,p=s?"":" ",h=0,f=0,m=0,_=!0,y=s?0:this._getWidthOfCharSpacing(),n=n||0;0===d.length&&d.push([]),o-=n;for(var x=0;x<d.length;x++)g=s?d[x]:t.util.string.graphemeSplit(d[x]),h=this._measureWord(g,r,u),u+=g.length,a+=f+h-y,a>=o&&!_?(l.push(c),c=[],a=h,_=!0):a+=y,_||s||c.push(p),c=c.concat(g),f=this._measureWord([p],r,u),u++,_=!1,h>m&&(m=h);return x&&l.push(c),m+n>this.dynamicMinWidth&&(this.dynamicMinWidth=m-y+n),l},isEndOfWrapping:function(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line},missingNewlineOffset:function(e){return this.splitByGrapheme?this.isEndOfWrapping(e)?1:0:1},_splitTextIntoLines:function(e){for(var r=t.Text.prototype._splitTextIntoLines.call(this,e),o=this._wrapText(r.lines,this.width),n=Array(o.length),a=0;a<o.length;a++)n[a]=o[a].join("");return r.lines=n,r.graphemeLines=o,r},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var e={};for(var t in this._styleMap)this._textLines[t]&&(e[this._styleMap[t].line]=1);for(var t in this.styles)e[t]||delete this.styles[t]},toObject:function(e){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(e))}}),t.Textbox.fromObject=function(e,r){return t.Object._fromObject("Textbox",e,r,"text")}}("undefined"==typeof exports?this:exports),function(){var e=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(r,o,i,n,a,s,l){var c=o.target,t=r.x*c.scaleX/l.x,d=r.y*c.scaleY/l.y,g;if("x"===a&&c instanceof fabric.Textbox){var u=c._getTransformedDimensions().x,p=c.width*(r.x/u);if(o.newScaleX=t,o.newScaleY=d,p>=c.getMinWidth())return g=p!==c.width,c.set("width",p),g}else return e.call(fabric.Canvas.prototype,r,o,i,n,a,s,l)},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var e in this._styleMap)this._textLines[e]||delete this.styles[this._styleMap[e].line]}})}();